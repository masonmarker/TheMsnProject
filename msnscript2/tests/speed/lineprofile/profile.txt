Timer unit: 1e-06 s

Total time: 9.67e-05 s
File: C:\Users\mason\OneDrive\Desktop\TheMsnProject\msnscript2\tests\speed\lineprofile\msnint2.py
Function: interpret_msnscript_1 at line 7128

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  7128                                               @profile
  7129                                               def interpret_msnscript_1(self, line):
  7130                                           
  7131         1          0.3      0.3      0.3          element = ''
  7132         1          0.3      0.3      0.3          variable = ''
  7133                                           
  7134         9          4.6      0.5      4.8          for i in range(0, len(line)):
  7135         9          2.7      0.3      2.8              c = line[i]
  7136         9          2.9      0.3      3.0              if c != ' ':
  7137         7          2.2      0.3      2.3                  if c == '+' and line[i + 1] == '=':
  7138                                                               variable = element
  7139                                                               element = ''
  7140                                                               for j in range(i + 2, len(line)):
  7141                                                                   element += line[j]
  7142                                           
  7143                                                               # if element is a number
  7144                                                               if isinstance(element, float) or isinstance(element, int):
  7145                                                                   self.vars[variable].value += self.interpret(element)
  7146                                                               # if element is a string
  7147                                                               elif isinstance(element, str):
  7148                                                                   try:
  7149                                                                       self.vars[variable].value += self.interpret(
  7150                                                                           element)
  7151                                                                   except:
  7152                                                                       self.vars[variable].value += self.interpret(
  7153                                                                           element)
  7154                                                               return self.vars[variable].value
  7155         7          1.8      0.3      1.9                  elif c == '-' and line[i + 1] == '=':
  7156                                                               variable = element
  7157                                                               element = ''
  7158                                                               for j in range(i + 2, len(line)):
  7159                                                                   element += line[j]
  7160                                                               self.vars[variable].value -= self.interpret(element)
  7161                                                               return self.vars[variable].value
  7162         7          1.8      0.3      1.9                  elif c == '*' and line[i + 1] == '=':
  7163                                                               variable = element
  7164                                                               element = ''
  7165                                                               for j in range(i + 2, len(line)):
  7166                                                                   element += line[j]
  7167                                                               self.vars[variable].value *= self.interpret(element)
  7168                                                               return self.vars[variable].value
  7169         7          2.5      0.4      2.6                  elif c == '/' and line[i + 1] == '=':
  7170                                                               variable = element
  7171                                                               element = ''
  7172                                                               for j in range(i + 2, len(line)):
  7173                                                                   element += line[j]
  7174                                                               self.vars[variable].value /= self.interpret(element)
  7175                                                               return self.vars[variable].value
  7176         7          2.1      0.3      2.2                  elif c == '=':
  7177         1          0.2      0.2      0.2                      variable = element
  7178         1          0.2      0.2      0.2                      element = ''
  7179         1          0.2      0.2      0.2                      string = False
  7180         1          0.2      0.2      0.2                      array = False
  7181         3          1.5      0.5      1.6                      for j in range(i+1, len(line)):
  7182         2          0.6      0.3      0.6                          if line[j] == '"':
  7183                                                                       string = True
  7184         2          0.6      0.3      0.6                          if line[j] == '[':
  7185                                                                       array = True
  7186         2          1.0      0.5      1.0                          element += line[j]
  7187         2          2.9      1.5      3.0                      self.vars[variable] = Var(
  7188         1         57.7     57.7     59.7                          variable, self.interpret(element))
  7189         1          0.6      0.6      0.6                      return self.vars[variable].value
  7190                                           
  7191         6          1.9      0.3      2.0                  elif "{" in element and "}" in element:
  7192                                                               if ":" not in element:
  7193                                                                   expression = element.replace("{", '').replace("}", '')
  7194                                                                   willrun = self.boolean(expression)
  7195                                           
  7196                                                                   if willrun:
  7197                                                                       line = line[line.index("}") + 1:]
  7198                                                                       self.interpret(line)
  7199                                                               else:
  7200                                                                   times = self.loop(element)
  7201                                                                   first = times[0]
  7202                                                                   last = times[1]
  7203                                                                   optvar = times[2]
  7204                                                                   try:
  7205                                                                       first = self.vars[first].value
  7206                                                                   except:
  7207                                                                       None
  7208                                                                   try:
  7209                                                                       last = self.vars[last].value
  7210                                                                   except:
  7211                                                                       None
  7212                                                                   first = int(first)
  7213                                                                   last = int(last)
  7214                                                                   self.vars[optvar] = Var(optvar, first)
  7215                                                                   if first <= last:
  7216                                                                       for i in range(first, last):
  7217                                                                           if optvar in self.vars:
  7218                                                                               self.vars[optvar].value = i
  7219                                                                           self.interpret_msnscript_1(
  7220                                                                               line.replace(' ', '').replace(element, ''))
  7221                                                                   else:
  7222                                                                       for i in range(last, first):
  7223                                                                           if optvar != '':
  7224                                                                               self.vars[optvar].value = i
  7225                                                                           self.interpret_msnscript_1(
  7226                                                                               line.replace(' ', '').replace(element, ''))
  7227                                                               break
  7228         6          1.7      0.3      1.8                  elif c == "&":
  7229                                                               None
  7230                                           
  7231                                                           else:
  7232         6          6.2      1.0      6.4                      element += c

Total time: 0.0006354 s
File: C:\Users\mason\OneDrive\Desktop\TheMsnProject\msnscript2\tests\speed\lineprofile\msnint2.py
Function: interpret at line 443

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   443                                               @profile
   444                                               def interpret(self, line, block={}, keep_space=False):
   445                                           
   446                                                   # acquiring globals
   447                                                   global total_ints
   448                                                   global lock
   449                                                   global auxlock
   450                                                   global auto_lock
   451                                                   global pointer_lock
   452                                                   global python_alias
   453                                                   global inst_tree
   454                                           
   455                                                   # accounting
   456         7          3.7      0.5      0.6          total_ints += 1
   457         7          3.8      0.5      0.6          lines_ran.append(line)
   458                                           
   459                                                   # determine the location of this instruction
   460                                                   # in the inst_tree depending on lines_ran
   461                                                   # and the current line
   462         7          4.3      0.6      0.7          inst_tree[total_ints] = [self.current_line, line]
   463                                           
   464                                                   # interpreter is breaking
   465         7          2.3      0.3      0.4          if self.breaking:
   466                                                       return self.breaking_return
   467                                           
   468                                                   # strip line for interpretation
   469         7          1.6      0.2      0.3          try:
   470         7          2.2      0.3      0.3              if not keep_space:
   471         7          3.7      0.5      0.6                  line = line.strip()
   472                                                   except:
   473                                                       return
   474         7          3.3      0.5      0.5          l = len(line)
   475                                           
   476                                                   # whether the line should immediately continue or not
   477         7          2.1      0.3      0.3          cont = False
   478         7          2.5      0.4      0.4          if line == '':
   479                                                       return
   480                                           
   481                                                   # the below conditions interpret a line based on initial appearances
   482                                                   # beneath these conditions will the Interpreter then parse the arguments from the line as a method call
   483                                           
   484                                                   # method-specific line reached
   485         7          4.4      0.6      0.7          if line.startswith('--'):
   486                                                       line = line[2:]
   487                                                       try:
   488                                                           if not self.methods[self.loggedmethod[-1]].ended:
   489                                                               self.methods[self.loggedmethod[-1]].add_body(line)
   490                                                       except:
   491                                                           None
   492                                                       return
   493                                           
   494                                                   # new variable setting and modification syntax as of 12/20/2022
   495                                                   # iterates to the first '=' sign, capturing the variable name in the
   496                                                   # process (as it should)
   497                                                   # msn1 fallback
   498         7          3.2      0.5      0.5          if line[0] == '@':
   499         1         80.5     80.5     12.7              return self.interpret_msnscript_1(line[1:])
   500                                           
   501                                                   # python fallback mode specification,
   502                                                   # both <<>> and
   503         6          3.2      0.5      0.5          if line.startswith('<<'):
   504                                           
   505                                                       # parse all text in the line for text surrounded by |
   506                                                       funccalls = []
   507                                                       infunc = False
   508                                                       func = ''
   509                                                       for i in range(line.rindex('>>')):
   510                                                           if line[i] == '|' and not infunc:
   511                                                               infunc = True
   512                                                           elif line[i] == '|' and infunc:
   513                                                               infunc = False
   514                                                               funccalls.append(func)
   515                                                               func = ''
   516                                                           elif infunc:
   517                                                               func += line[i]
   518                                                       for function in funccalls:
   519                                                           ret = self.interpret(function)
   520                                                           if isinstance(ret, str):
   521                                                               line = line.replace(
   522                                                                   f'|{function}|', f'"{str(ret)}"')
   523                                                           else:
   524                                                               line = line.replace(f'|{function}|', str(ret))
   525                                                       line = line[2:-2]
   526                                                       try:
   527                                                           return eval(line)
   528                                                       except:
   529                                                           return line
   530                                           
   531                                                   # embedded MSN2 interpretation macro
   532         6          3.8      0.6      0.6          if line.startswith('<2>'):
   533                                                       # parse all text in the line for text surrounded by %
   534                                                       funccalls = []
   535                                                       infunc = False
   536                                                       func = ''
   537                                                       for i in range(3, line.rindex('<2>')):
   538                                                           if line[i] == '%' and not infunc:
   539                                                               infunc = True
   540                                                           elif line[i] == '%' and infunc:
   541                                                               infunc = False
   542                                                               funccalls.append(func)
   543                                                               func = ''
   544                                                           elif infunc:
   545                                                               func += line[i]
   546                                           
   547                                                       # for each msn2 evaluation
   548                                                       for function in funccalls:
   549                                                           ret = self.interpret(function)
   550                                                           if isinstance(ret, str):
   551                                                               line = line.replace(
   552                                                                   f'%{function}%', f'"{str(ret)}"')
   553                                                           else:
   554                                                               line = line.replace(f'%{function}%', str(ret))
   555                                                       line = line[3:-3]
   556                                                       try:
   557                                                           return self.interpret(line)
   558                                                       except:
   559                                                           try:
   560                                                               return eval(line, {}, {})
   561                                                           except:
   562                                                               return line
   563                                           
   564                                                   # user defined syntax
   565         6          2.6      0.4      0.4          for key in syntax:
   566                                                       if line.startswith(key):
   567                                                           return self.run_syntax(key, line)
   568                                           
   569                                                   # user defined macro
   570         6          1.9      0.3      0.3          for token in macros:
   571                                                       if line.startswith(token):
   572                                           
   573                                                           # if the macro returns a value instead of executing a function
   574                                                           if len(macros[token]) == 4:
   575                                                               return macros[token][3]
   576                                           
   577                                                           # variable name
   578                                                           varname = macros[token][1]
   579                                           
   580                                                           # function to execute
   581                                                           function = macros[token][2]
   582                                           
   583                                                           val = line[len(token):]
   584                                           
   585                                                           # store extended for user defined syntax
   586                                                           self.vars[varname] = Var(varname, val)
   587                                           
   588                                                           # execute function
   589                                                           return self.interpret(function)
   590                                           
   591                                                   # user defined postmacro
   592         6          2.2      0.4      0.3          for token in postmacros:
   593                                                       if line.endswith(token):
   594                                                           # if the macro returns a value instead of executing a function
   595                                                           if len(postmacros[token]) == 4:
   596                                                               return postmacros[token][3]
   597                                                           varname = postmacros[token][1]
   598                                                           function = postmacros[token][2]
   599                                                           val = line[0:len(line) - len(token)]
   600                                                           self.vars[varname] = Var(varname, val)
   601                                                           return self.interpret(function)
   602                                           
   603                                                   # variable replacement, generally unsafe
   604         6          1.9      0.3      0.3          if line[0] == '*':
   605                                                       line = self.replace_vars(line[1:])
   606                                                       return self.interpret(line)
   607                                           
   608                                                   # invoking user defined enclosing syntax
   609         6          2.2      0.4      0.3          for key in enclosed:
   610                                                       start = enclosed[key][0]
   611                                                       end = enclosed[key][1]
   612                                                       if line.startswith(start) and line.endswith(end):
   613                                                           if len(enclosed[key]) == 5:
   614                                                               return enclosed[key][4]
   615                                                           varname = enclosed[key][2]
   616                                                           block = enclosed[key][3]
   617                                                           val = line[len(start):len(line) - len(end)]
   618                                                           self.vars[varname] = Var(varname, val)
   619                                                           return self.interpret(block)
   620                                           
   621                                                   # checks for active Interpreter redirect request
   622         6          2.0      0.3      0.3          if self.redirecting and not 'stopredirect()' in line.replace(' ', ''):
   623                                                       _block = self.redirect[1]
   624                                                       self.redirect_inside.append([_block, line])
   625                                                       return self.redirect
   626                                           
   627                                                   # try base literal
   628         6          1.4      0.2      0.2          try:
   629         6          3.3      0.6      0.5              if not line.startswith('--'):
   630                                           
   631                                                           # try evaluating the line
   632         6        101.4     16.9     16.0                  _ret = eval(line, {}, {})
   633                                           
   634                                                           # eval cannot be a python class, because names of variables
   635                                                           # could result in python classes
   636                                                           # should also not be a built in function
   637         3          2.9      1.0      0.5                  if not isinstance(_ret, type) and not isinstance(_ret, type(eval)):
   638         3          0.7      0.2      0.1                      return _ret
   639         3          0.8      0.3      0.1          except:
   640         3          2.4      0.8      0.4              None
   641                                           
   642         3          0.8      0.3      0.1          func = ''
   643         3          0.8      0.3      0.1          objfunc = ''
   644         3          0.8      0.3      0.1          obj = ''
   645         3          0.8      0.3      0.1          s = 0
   646         3          1.2      0.4      0.2          sp = 0
   647        35         13.3      0.4      2.1          for i in range(l):
   648        35          8.7      0.2      1.4              if cont:
   649                                                           continue
   650        35          7.7      0.2      1.2              try:
   651        35         10.6      0.3      1.7                  c = line[i]
   652                                                       except:
   653                                                           break
   654        35         11.3      0.3      1.8              if c == ' ' and s == 0:
   655                                                           sp += 1
   656                                                           continue
   657                                           
   658        35          8.7      0.2      1.4              if c == '.':
   659         3          1.2      0.4      0.2                  obj = func
   660         3          1.0      0.3      0.2                  func = ''
   661         3          0.9      0.3      0.1                  objfunc = ''
   662         3          0.7      0.2      0.1                  continue
   663                                           
   664                                                       # function to attempt to pull an integer out of the function
   665                                                       # if it is an integer, then it is a loop that runs func times
   666                                           
   667        32         10.9      0.3      1.7              def get_int(func):
   668                                                           try:
   669                                                               return int(func)
   670                                                           except:
   671                                                               return None
   672                                           
   673                                                       # basic method creation
   674        32          9.1      0.3      1.4              if c == '~':
   675                                                           returnvariable = ''
   676                                                           self.loggedmethod.append('')
   677                                                           for j in range(i + 1, len(line)):
   678                                                               if line[j] != ' ':
   679                                                                   if line[j] == '(':
   680                                                                       args = self.method_args(line, j)
   681                                                                       for k in range(args[1], len(line)):
   682                                                                           if line[k] != ' ':
   683                                                                               if line[k] == '-' and line[k + 1] == '>':
   684                                                                                   for l in range(k + 2, len(line)):
   685                                                                                       if line[l] != ' ':
   686                                                                                           returnvariable += line[l]
   687                                                                       break
   688                                                                   self.loggedmethod[-1] += line[j]
   689                                                           if self.loggedmethod[-1] not in self.methods.keys():
   690                                                               self.methods[self.loggedmethod[-1]
   691                                                                            ] = self.Method(self.loggedmethod[-1], self)
   692                                                           else:
   693                                                               break
   694                                                           for arg in args[0]:
   695                                                               if arg != '':
   696                                                                   self.vars[arg] = None
   697                                                                   self.methods[self.loggedmethod[-1]].add_arg(arg)
   698                                                           self.methods[self.loggedmethod[-1]].add_return(returnvariable)
   699                                                           return self.loggedmethod[-1]
   700                                           
   701                                                       # interpreting a function
   702        32          8.0      0.2      1.3              elif c == '(':
   703                                           
   704         3          0.7      0.2      0.1                  mergedargs = ''
   705         3          0.8      0.3      0.1                  p = 1
   706         3          1.2      0.4      0.2                  l = len(line)
   707         5          3.4      0.7      0.5                  for j in range(i + 1, l - 1):
   708         2          0.8      0.4      0.1                      c2 = line[j]
   709         2          0.8      0.4      0.1                      if p == 0:
   710                                                                   break
   711         2          0.7      0.4      0.1                      if c2 == '(':
   712                                                                   p += 1
   713         2          0.8      0.4      0.1                      if c2 == ')':
   714                                                                   p -= 1
   715         2          0.6      0.3      0.1                      mergedargs += c2
   716         3         57.6     19.2      9.1                  args = self.get_args(mergedargs)
   717         3          1.4      0.5      0.2                  f = len(func)
   718                                           
   719                                                           # clean function for handling
   720         3          1.6      0.5      0.3                  func = func.strip()
   721         3          1.8      0.6      0.3                  objfunc = objfunc.strip()
   722                                           
   723                                                           # class attribute / method access
   724         3          1.8      0.6      0.3                  if obj in self.vars:
   725         3          0.8      0.3      0.1                      vname = obj
   726         3          0.7      0.2      0.1                      try:
   727         3          4.2      1.4      0.7                          var = self.get_var(vname)
   728                                                               except:
   729                                                                   var = self.vars[vname]
   730         3          0.8      0.3      0.1                      try:
   731         3          1.4      0.5      0.2                          object = self.vars[obj].value
   732                                                               except:
   733                                                                   object = self.vars[obj]
   734                                           
   735         3          1.1      0.4      0.2                      try:
   736                                                                   # if the object is a class
   737         3          4.5      1.5      0.7                          if objfunc in object:
   738                                           
   739                                                                       # if the object is a self.Method
   740                                                                       if type(object[objfunc]) == self.Method:
   741                                           
   742                                                                           # get the Method object
   743                                                                           method = object[objfunc]
   744                                           
   745                                                                           # get the number of arguments to the method
   746                                                                           num_args = len(method.args)
   747                                           
   748                                                                           # args to pass to the function
   749                                                                           to_pass = [vname]
   750                                           
   751                                                                           # if there is no argument
   752                                                                           if args[0][0] != '':
   753                                           
   754                                                                               # for each parsed argument
   755                                                                               for k in range(num_args):
   756                                                                                   try:
   757                                                                                       to_pass.append(self.parse(
   758                                                                                           k, line, f, sp, args)[2])
   759                                                                                   except:
   760                                                                                       None
   761                                                                           # create return variable
   762                                                                           ret_name = method.returns[0]
   763                                           
   764                                                                           # if the return variable doesn't exist
   765                                                                           if ret_name not in self.vars:
   766                                                                               self.vars[ret_name] = Var(ret_name, None)
   767                                           
   768                                                                           # # insert vname into args[0]
   769                                                                           args.insert(0, [vname])
   770                                           
   771                                                                           # execute method
   772                                                                           # if objfunc == 'wait_for_field':
   773                                                                           #     print(to_pass, args)
   774                                                                           try:
   775                                                                               method.run(to_pass, self, args)
   776                                                                           # catch IndexError
   777                                                                           except IndexError:
   778                                                                               self.raise_incorrect_args(str(len(method.args)), str(
   779                                                                                   self.arg_count(args) - 1), line, lines_ran, method)
   780                                           
   781                                                                           try:
   782                                                                               return eval(str(self.vars[method.returns[0]].value), {}, {})
   783                                                                           except:
   784                                                                               try:
   785                                                                                   return str(self.vars[method.returns[0]].value)
   786                                                                               except:
   787                                                                                   return str(self.vars[method.returns[0]])
   788                                           
   789                                                                       # otherwise if we're accessing an attribute
   790                                           
   791                                                                       # no arguments given
   792                                                                       if args[0][0] == '':
   793                                                                           return object[objfunc]
   794                                           
   795                                                                       # parameter provided, wants to set attribute
   796                                                                       param = self.parse(0, line, f, sp, args)[2]
   797                                           
   798                                                                       self.vars[obj].value[objfunc] = param
   799                                                                       return param
   800         3          0.7      0.2      0.1                      except:
   801         3          0.9      0.3      0.1                          None
   802                                           
   803                                                               # continuously accesses a key
   804         3          1.3      0.4      0.2                      if '->' in objfunc:
   805                                                                   keys = objfunc.split('->')
   806                                           
   807                                                                   # no arguments given
   808                                                                   if args[0][0] == '':
   809                                                                       # get the value on this object at the keys
   810                                                                       for key in keys:
   811                                                                           try:
   812                                                                               object = object[eval(key, {}, {})]
   813                                                                           except:
   814                                                                               object = object[key]
   815                                           
   816                                                                   # argument given to set
   817                                                                   else:
   818                                                                       to_set = self.parse(0, line, f, sp, args)[2]
   819                                                                       for key in keys[:-1]:
   820                                                                           object = object[key]
   821                                                                       object[keys[-1]] = to_set
   822                                                                       return to_set
   823                                                                   return object
   824                                           
   825                                                               # methods available to all types
   826         3          1.1      0.4      0.2                      if objfunc == 'copy':
   827                                                                   return object.copy()
   828                                           
   829         3          1.1      0.4      0.2                      if objfunc == 'print':
   830                                           
   831                                                                   # if no arguments
   832         1          0.7      0.7      0.1                          if args[0][0] == '':
   833         1         11.5     11.5      1.8                              print(object)
   834         1          0.4      0.4      0.1                              return object
   835                                           
   836                                                                   # if one argument
   837                                                                   elif len(args) == 1:
   838                                           
   839                                                                       # what to print
   840                                                                       to_print = f"{self.parse(0, line, f, sp, args)[2]}{object}"
   841                                           
   842                                                                       # print the object
   843                                                                       print(to_print)
   844                                                                       return to_print
   845                                           
   846                                                                   # if two arguments
   847                                                                   elif len(args) == 2:
   848                                           
   849                                                                       # what to print
   850                                                                       to_print = f"{self.parse(0, line, f, sp, args)[2]}{object}{self.parse(1, line, f, sp, args)[2]}"
   851                                           
   852                                                                       # print the object
   853                                                                       print(to_print)
   854                                           
   855                                                                       # return the printed object
   856                                                                       return to_print
   857                                                                   return object
   858                                           
   859         2          0.7      0.4      0.1                      if objfunc == 'val':
   860                                                                   return object
   861                                           
   862         2          0.6      0.3      0.1                      if objfunc == 'type':
   863                                                                   return type(object)
   864                                           
   865         2          0.7      0.4      0.1                      if objfunc == 'len':
   866                                                                   return len(object)
   867                                           
   868         2          0.7      0.4      0.1                      if objfunc == 'str':
   869                                                                   return str(object)
   870                                           
   871         2          0.6      0.3      0.1                      if objfunc == 'int':
   872                                                                   return int(object)
   873                                           
   874         2          0.6      0.3      0.1                      if objfunc == 'float':
   875                                                                   return float(object)
   876                                           
   877         2          0.7      0.4      0.1                      if objfunc == 'complex':
   878                                                                   return complex(object)
   879                                           
   880         2          0.6      0.3      0.1                      if objfunc == 'bool':
   881                                                                   return bool(object)
   882                                           
   883         2          0.6      0.3      0.1                      if objfunc == 'dict':
   884                                                                   return dict(object)
   885                                           
   886                                                               # gets values from the object if the statement is true for each object
   887                                                               # runs the function on each element / kv pair
   888                                                               #
   889                                                               # method is not destructive
   890         2          0.6      0.3      0.1                      if objfunc == 'if':
   891                                           
   892                                                                   # variable name
   893                                                                   varname = self.parse(0, line, f, sp, args)[2]
   894                                           
   895                                                                   # function to execute
   896                                                                   function = args[1][0]
   897                                           
   898                                                                   new_list = []
   899                                           
   900                                                                   # perform logic
   901                                                                   for el in self.vars[vname].value:
   902                                                                       self.vars[varname] = Var(varname, el)
   903                                                                       if self.interpret(function):
   904                                                                           new_list.append(el)
   905                                           
   906                                                                   return new_list
   907                                           
   908                                                               # comparing object types
   909         2          0.6      0.3      0.1                      if objfunc == 'is':
   910                                                                   return object is self.parse(0, line, f, sp, args)[2]
   911                                           
   912                                                               # test if the object is equal to all the parameters
   913         2          0.8      0.4      0.1                      if objfunc == 'equals':
   914                                                                   for i in range(len(args)):
   915                                                                       if object != self.parse(i, line, f, sp, args)[2]:
   916                                                                           return False
   917                                                                   return True
   918                                           
   919                                                               # obtains a slice of the iterable
   920         2          0.6      0.3      0.1                      if objfunc == 'slice':
   921                                                                   return self.vars[vname].value[self.parse(0, line, f, sp, args)[2]:self.parse(1, line, f, sp, args)[2]]
   922                                           
   923                                                               # gets the index of the object
   924         2          0.5      0.2      0.1                      if objfunc == 'index':
   925                                                                   return self.vars[vname].value.index(self.parse(0, line, f, sp, args)[2])
   926                                           
   927                                                               # exports a variable to the parent context
   928         2          0.5      0.2      0.1                      if objfunc == 'export':
   929                                                                   name = vname
   930                                                                   # if an argument is provided
   931                                                                   # export as name
   932                                                                   if args[0][0] != '':
   933                                                                       name = self.parse(0, line, f, sp, args)[2]
   934                                                                   self.parent.vars[name] = Var(name, object)
   935                                                                   return object
   936                                           
   937                                                               # if no objfunc, there has been a request
   938                                                               # for repeated method calls/access
   939         2          0.6      0.3      0.1                      if objfunc == '':
   940                                                                   ret = self.vars[vname].value
   941                                                                   # for each block
   942                                                                   for arg in args:
   943                                                                       block = arg[0]
   944                                                                       ret = self.interpret(f"{vname}.{block}")
   945                                                                   return ret
   946                                           
   947                                                               # string_name() returns the string name of the object
   948         2          0.5      0.2      0.1                      if objfunc == 'string_name':
   949                                                                   return vname
   950                                           
   951                                                               # performs a function for each element in the iterable
   952         2          0.6      0.3      0.1                      if objfunc == 'each':
   953                                                                   # get the variable name
   954                                                                   varname = self.parse(0, line, f, sp, args)[2]
   955                                                                   # get the function
   956                                                                   func = args[1][0]
   957                                           
   958                                                                   # try an indexable
   959                                                                   try:
   960                                                                       for i in range(len(object)):
   961                                                                           self.vars[varname] = Var(varname, object[i])
   962                                                                           self.interpret(func)
   963                                           
   964                                                                   except:
   965                                                                       # try a set
   966                                                                       for i in object:
   967                                                                           self.vars[varname] = Var(varname, i)
   968                                                                           self.interpret(func)
   969                                           
   970                                                                   return object
   971                                           
   972                                                               # rfind and lfind
   973                                                               # find the index of the first element that satisfies the condition
   974         2          0.7      0.4      0.1                      if objfunc == 'rfind':
   975                                                                   return self.vars[vname].value.rfind(self.parse(0, line, f, sp, args)[2])
   976         2          0.7      0.4      0.1                      if objfunc == 'lfind':
   977                                                                   return self.vars[vname].value.find(self.parse(0, line, f, sp, args)[2])
   978                                                               # find
   979                                                               # find the index of the first element that satisfies the condition
   980         2          0.8      0.4      0.1                      if objfunc == 'find':
   981                                                                   return self.vars[vname].value.find(self.parse(0, line, f, sp, args)[2])
   982                                           
   983                                                               # filters the iterable
   984         2          0.6      0.3      0.1                      if objfunc == 'filter':
   985                                           
   986                                                                   # get the variable name
   987                                                                   varname = self.parse(0, line, f, sp, args)[2]
   988                                           
   989                                                                   # get the function
   990                                                                   block = args[1][0]
   991                                           
   992                                                                   # filtered
   993                                                                   filtered = []
   994                                           
   995                                                                   # filter the iterable
   996                                                                   for el in object:
   997                                                                       self.vars[varname] = Var(varname, el)
   998                                                                       if self.interpret(block):
   999                                                                           filtered.append(el)
  1000                                           
  1001                                                                   # set the variable to the filtered list
  1002                                                                   self.vars[vname].value = filtered
  1003                                           
  1004                                                                   # return the filtered list
  1005                                                                   return self.vars[vname].value
  1006                                           
  1007                                                               # basic arithmetic, non-destructive
  1008                                                               # takes any amount of arguments
  1009         2          0.7      0.4      0.1                      if objfunc == '+':
  1010                                                                   ret = object
  1011                                                                   for i in range(len(args)):
  1012                                                                       ret += self.parse(i, line, f, sp, args)[2]
  1013                                                                   return ret
  1014         2          0.6      0.3      0.1                      if objfunc == '-':
  1015                                                                   ret = object
  1016                                                                   for i in range(len(args)):
  1017                                                                       ret -= self.parse(i, line, f, sp, args)[2]
  1018                                                                   return ret
  1019         2          0.9      0.5      0.1                      if objfunc == '*' or objfunc == 'x':
  1020                                                                   ret = object
  1021                                                                   for i in range(len(args)):
  1022                                                                       ret *= self.parse(i, line, f, sp, args)[2]
  1023                                                                   return ret
  1024         2          0.6      0.3      0.1                      if objfunc == '/':
  1025                                                                   ret = object
  1026                                                                   for i in range(len(args)):
  1027                                                                       ret /= self.parse(i, line, f, sp, args)[2]
  1028                                                                   return ret
  1029         2          0.6      0.3      0.1                      if objfunc == '%':
  1030                                                                   ret = object
  1031                                                                   for i in range(len(args)):
  1032                                                                       ret %= self.parse(i, line, f, sp, args)[2]
  1033                                                                   return ret
  1034         2          0.6      0.3      0.1                      if objfunc == '**':
  1035                                                                   ret = object
  1036                                                                   for i in range(len(args)):
  1037                                                                       ret **= self.parse(i, line, f, sp, args)[2]
  1038                                                                   return ret
  1039         2          0.6      0.3      0.1                      if objfunc == '//':
  1040                                                                   ret = object
  1041                                                                   for i in range(len(args)):
  1042                                                                       ret //= self.parse(i, line, f, sp, args)[2]
  1043                                                                   return ret
  1044                                           
  1045                                                               # applies methods to to the object, considering
  1046                                                               # the method takes one argument
  1047         2          0.6      0.3      0.1                      if objfunc == 'func':
  1048                                                                   ret = object
  1049                                                                   # apply the function to the object
  1050                                                                   for arg in args:
  1051                                                                       method = arg[0]
  1052                                                                       ret = self.interpret(f"{method}({ret})")
  1053                                           
  1054                                                                   return ret
  1055                                           
  1056                                                               # reverses the iterable
  1057         2          0.7      0.4      0.1                      if objfunc == 'reverse':
  1058                                                                   self.vars[vname].value = self.vars[vname].value[::-1]
  1059                                                                   return self.vars[vname].value
  1060                                           
  1061                                                               # determines if this object is in the object passed
  1062         2          0.7      0.4      0.1                      if objfunc == 'in':
  1063                                                                   return self.vars[vname].value in self.parse(0, line, f, sp, args)[2]
  1064                                           
  1065                                                               # variable type specific methods
  1066                                                               # the isinstance branches below indicate mostly  DESCTRUCTIVE methods!
  1067                                                               # so be sure to read the code
  1068                                           
  1069                                                               # number specific functions
  1070         2          1.2      0.6      0.2                      if isinstance(object, int) or isinstance(object, float) or isinstance(object, complex):
  1071                                                                   # increases the value of the variable by 1
  1072         2          0.7      0.4      0.1                          if objfunc == '++' or objfunc == 'inc':
  1073                                                                       self.vars[vname].value += 1
  1074                                                                       return self.vars[vname].value
  1075                                           
  1076         2          0.7      0.4      0.1                          elif objfunc == '--' or objfunc == 'dec':
  1077                                                                       self.vars[vname].value -= 1
  1078                                                                       return self.vars[vname].value
  1079                                           
  1080                                                                   # determines if the number is even
  1081         2          0.6      0.3      0.1                          elif objfunc == 'even':
  1082                                                                       return self.vars[vname].value % 2 == 0
  1083         2          0.4      0.2      0.1                          elif objfunc == 'odd':
  1084                                                                       return self.vars[vname].value % 2 != 0
  1085                                           
  1086                                                                   # all of the below methods take any amount of arguments
  1087                                                                   # and perform the operation on the variable
  1088         2          0.7      0.4      0.1                          elif objfunc == 'add':
  1089         2          1.1      0.6      0.2                              for i in range(len(args)):
  1090         3         10.3      3.4      1.6                                  self.vars[vname].value += self.parse(
  1091         2          0.7      0.4      0.1                                      i, line, f, sp, args)[2]
  1092         1          0.5      0.5      0.1                              return self.vars[vname].value
  1093                                           
  1094         1          0.4      0.4      0.1                          elif objfunc == 'sub':
  1095         2          1.0      0.5      0.2                              for i in range(len(args)):
  1096         3          6.9      2.3      1.1                                  self.vars[vname].value -= self.parse(
  1097         2          0.6      0.3      0.1                                      i, line, f, sp, args)[2]
  1098         1          0.5      0.5      0.1                              return self.vars[vname].value
  1099                                           
  1100                                                                   elif objfunc == 'mul':
  1101                                                                       for i in range(len(args)):
  1102                                                                           self.vars[vname].value *= self.parse(
  1103                                                                               i, line, f, sp, args)[2]
  1104                                                                       return self.vars[vname].value
  1105                                           
  1106                                                                   elif objfunc == 'div':
  1107                                                                       for i in range(len(args)):
  1108                                                                           self.vars[vname].value /= self.parse(
  1109                                                                               i, line, f, sp, args)[2]
  1110                                                                       return self.vars[vname].value
  1111                                           
  1112                                                                   # computes the absolute value of the number
  1113                                                                   elif objfunc == 'abs':
  1114                                                                       self.vars[vname].value = abs(
  1115                                                                           self.vars[vname].value)
  1116                                                                       return self.vars[vname].value
  1117                                           
  1118                                                                   # rounds this number to the nearest place specified by the first argument
  1119                                                                   elif objfunc == 'round':
  1120                                           
  1121                                                                       # decimal place
  1122                                                                       decplace = self.parse(0, line, f, sp, args)[2]
  1123                                           
  1124                                                                       # round to the nearest decimal place
  1125                                                                       if args[0][0] != '':
  1126                                                                           self.vars[vname].value = round(
  1127                                                                               self.vars[vname].value, decplace)
  1128                                           
  1129                                                                       else:
  1130                                                                           self.vars[vname].value = round(
  1131                                                                               self.vars[vname].value)
  1132                                                                       return self.vars[vname].value
  1133                                           
  1134                                                                   elif objfunc == 'floor':
  1135                                                                       # using math
  1136                                                                       import math
  1137                                                                       self.vars[vname].value = math.floor(
  1138                                                                           self.vars[vname].value)
  1139                                                                       return self.vars[vname].value
  1140                                           
  1141                                                                   elif objfunc == 'ceil':
  1142                                                                       # using math
  1143                                                                       import math
  1144                                                                       self.vars[vname].value = math.ceil(
  1145                                                                           self.vars[vname].value)
  1146                                                                       return self.vars[vname].value
  1147                                           
  1148                                                                   # negates the value, if positive the value becomes negative and vice versa
  1149                                                                   elif objfunc == 'neg':
  1150                                                                       self.vars[vname].value = -self.vars[vname].value
  1151                                                                       return self.vars[vname].value
  1152                                           
  1153                                                                   # all of the below methods should take any amount of arguments
  1154                                           
  1155                                                                   # test if the variable is greater than all arguments
  1156                                                                   elif objfunc == 'greater' or objfunc == 'greaterthan' or objfunc == 'g':
  1157                                                                       for i in range(len(args)):
  1158                                                                           if self.vars[vname].value <= self.parse(i, line, f, sp, args)[2]:
  1159                                                                               return False
  1160                                                                       return True
  1161                                           
  1162                                                                   elif objfunc == 'less' or objfunc == 'lessthan' or objfunc == 'l':
  1163                                                                       for i in range(len(args)):
  1164                                                                           if self.vars[vname].value >= self.parse(i, line, f, sp, args)[2]:
  1165                                                                               return False
  1166                                                                       return True
  1167                                           
  1168                                                                   elif objfunc == 'greaterequal' or objfunc == 'ge':
  1169                                                                       for i in range(len(args)):
  1170                                                                           if self.vars[vname].value < self.parse(i, line, f, sp, args)[2]:
  1171                                                                               return False
  1172                                                                       return True
  1173                                           
  1174                                                                   elif objfunc == 'lessequal' or objfunc == 'le':
  1175                                                                       return self.vars[vname].value <= self.parse(0, line, f, sp, args)[2]
  1176                                           
  1177                                                                   # more basic functions
  1178                                                                   return self.vars[vname].value
  1179                                           
  1180                                                               # set based functions
  1181                                                               elif isinstance(object, set):
  1182                                           
  1183                                                                   # adds all arguments to the set object
  1184                                                                   if objfunc == 'add' or objfunc == 'put':
  1185                                                                       for i in range(len(args)):
  1186                                                                           self.vars[vname].value.add(
  1187                                                                               self.parse(i, line, f, sp, args)[2])
  1188                                                                       return self.vars[vname].value
  1189                                           
  1190                                                                   if objfunc == 'pop':
  1191                                                                       return self.vars[vname].value.pop()
  1192                                           
  1193                                                                   # removes all arguments from the set object
  1194                                                                   if objfunc == 'remove':
  1195                                                                       for i in range(len(args)):
  1196                                                                           self.vars[vname].value.remove(
  1197                                                                               self.parse(i, line, f, sp, args)[2])
  1198                                                                       return self.vars[vname].value
  1199                                           
  1200                                                                   # converts this set to a list
  1201                                                                   if objfunc == 'list':
  1202                                                                       return list(self.vars[vname].value)
  1203                                           
  1204                                                                   # gets at an index in the set
  1205                                                                   # sets are not indexable
  1206                                                                   if objfunc == 'get':
  1207                                           
  1208                                                                       # index to get at
  1209                                                                       ind = self.parse(0, line, f, sp, args)[2]
  1210                                           
  1211                                                                       # get the index
  1212                                                                       for i in object:
  1213                                                                           if ind == 0:
  1214                                                                               return i
  1215                                                                           ind -= 1
  1216                                           
  1217                                                               # array based functions
  1218                                                               elif isinstance(object, list):
  1219                                           
  1220                                                                   # adds all arguments to the first argument which should be a variable name
  1221                                                                   # as a string
  1222                                                                   if objfunc == 'push' or objfunc == 'append' or objfunc == 'add':
  1223                                                                       for i in range(len(args)):
  1224                                                                           self.vars[vname].value.append(
  1225                                                                               self.parse(i, line, f, sp, args)[2])
  1226                                                                       return self.vars[vname].value
  1227                                           
  1228                                                                   # pops a value from the array
  1229                                                                   elif objfunc == 'pop':
  1230                                                                       return self.vars[vname].value.pop()
  1231                                           
  1232                                                                   # getting at an index
  1233                                                                   elif objfunc == 'get':
  1234                                                                       return self.vars[vname].value[self.parse(0, line, f, sp, args)[2]]
  1235                                           
  1236                                                                   # sets at an index
  1237                                                                   elif objfunc == 'set':
  1238                                                                       self.vars[vname].value[self.parse(0, line, f, sp, args)[
  1239                                                                           2]] = self.parse(1, line, f, sp, args)[2]
  1240                                                                       return self.vars[vname].value
  1241                                           
  1242                                                                   # gets the average of this array
  1243                                                                   elif objfunc == 'avg' or objfunc == 'average':
  1244                                                                       return sum(self.vars[vname].value) / len(self.vars[vname].value)
  1245                                           
  1246                                                                   # inserts all values at an index
  1247                                                                   if objfunc == 'insert':
  1248                                           
  1249                                                                       # index to insert
  1250                                                                       index = self.parse(0, line, f, sp, args)[2]
  1251                                           
  1252                                                                       # inserts the rest of the arguments, one at a time
  1253                                                                       for i in range(len(args)):
  1254                                                                           self.vars[vname].value.insert(
  1255                                                                               index, self.parse(i, line, f, sp, args)[2])
  1256                                                                       return self.vars[vname].value
  1257                                           
  1258                                                                   # removes a certain amount of all arguments supplied
  1259                                                                   if objfunc == 'removen':
  1260                                                                       count = self.parse(0, line, f, sp, args)[2]
  1261                                           
  1262                                                                       # removes count amount of the rest of the arguments from the object
  1263                                                                       for i in range(1, len(args)):
  1264                                                                           for j in range(count):
  1265                                                                               del var[var.index(self.parse(
  1266                                                                                   i, line, f, sp, args)[2])]
  1267                                                                       return object
  1268                                           
  1269                                                                   # removes all occurances of each argument from the list
  1270                                                                   if objfunc == 'remove':
  1271                                                                       for i in range(len(args)):
  1272                                                                           while self.parse(i, line, f, sp, args)[2] in var:
  1273                                                                               del var[var.index(self.parse(
  1274                                                                                   i, line, f, sp, args)[2])]
  1275                                                                       return object
  1276                                           
  1277                                                                   # gets a sorted copy of this array
  1278                                                                   if objfunc == 'sorted':
  1279                                                                       return sorted(self.vars[vname].value)
  1280                                           
  1281                                                                   # sorts this array
  1282                                                                   if objfunc == 'sort':
  1283                                                                       self.vars[vname].value.sort()
  1284                                                                       return self.vars[vname].value
  1285                                           
  1286                                                                   # gets the length of the array
  1287                                                                   if objfunc == 'len':
  1288                                                                       return len(self.vars[vname].value)
  1289                                           
  1290                                                                   # determines if a list is empty
  1291                                                                   if objfunc == 'empty':
  1292                                                                       return len(self.vars[vname].value) == 0
  1293                                           
  1294                                                                   # determines if this list contains an element
  1295                                                                   if objfunc == 'contains' or objfunc == 'has' or objfunc == 'includes':
  1296                                                                       return self.parse(0, line, f, sp, args)[2] in self.vars[vname].value
  1297                                           
  1298                                                                   # finds an element in a list
  1299                                                                   # unlike index(), find returns -1 instead of throwing an
  1300                                                                   # error
  1301                                                                   if objfunc == 'find':
  1302                                                                       return self.vars[vname].value.find(self.parse(0, line, f, sp, args)[2])
  1303                                           
  1304                                                                   # shuffles a list
  1305                                                                   if objfunc == 'shuffle':
  1306                                                                       import random
  1307                                                                       random.shuffle(self.vars[vname].value)
  1308                                                                       return self.vars[vname].value
  1309                                           
  1310                                                                   # performs a function for each element in the iterable
  1311                                                                   # map() is a destructive method
  1312                                                                   if objfunc == 'map':
  1313                                                                       # get the variable name
  1314                                                                       varname = self.parse(0, line, f, sp, args)[2]
  1315                                           
  1316                                                                       # get the function
  1317                                                                       func = args[1][0]
  1318                                           
  1319                                                                       for i in range(len(object)):
  1320                                                                           self.vars[varname] = Var(varname, object[i])
  1321                                                                           object[i] = self.interpret(func)
  1322                                                                       del self.vars[varname]
  1323                                                                       return object
  1324                                           
  1325                                                                   # joins the array by the first argument
  1326                                                                   if objfunc == 'join' or objfunc == 'delimit':
  1327                                           
  1328                                                                       # join the array
  1329                                                                       return str(self.parse(0, line, f, sp, args)[2]).join(map(str, self.vars[vname].value))
  1330                                           
  1331                                                                   # converts this list to a set
  1332                                                                   if objfunc == 'toset':
  1333                                                                       return set(self.vars[vname].value)
  1334                                           
  1335                                                               # if the object is a string
  1336                                                               elif isinstance(object, str):
  1337                                           
  1338                                                                   if objfunc == 'add':
  1339                                                                       for i in range(len(args)):
  1340                                                                           self.vars[vname].value += self.parse(
  1341                                                                               i, line, f, sp, args)[2]
  1342                                                                       return self.vars[vname].value
  1343                                           
  1344                                                                   if objfunc == 'split':
  1345                                                                       arg = self.parse(0, line, f, sp, args)[2]
  1346                                                                       try:
  1347                                                                           return self.vars[vname].value.split(arg)
  1348                                                                       except:
  1349                                                                           return self.vars[vname].split(arg)
  1350                                           
  1351                                                                   # gets the lines of this string
  1352                                                                   if objfunc == 'lines':
  1353                                                                       return self.vars[vname].value.split('\n')
  1354                                           
  1355                                                                   # determines if the string is a digit
  1356                                                                   if objfunc == 'isdigit':
  1357                                                                       return self.vars[vname].value.isdigit()
  1358                                                                   # determines if the string is a letter
  1359                                                                   if objfunc == 'isalpha':
  1360                                                                       return self.vars[vname].value.isalpha()
  1361                                           
  1362                                                                   # replaces all instances of the first argument with the second argument
  1363                                                                   if objfunc == 'replace':
  1364                                           
  1365                                                                       # what to replace
  1366                                                                       replacing = self.parse(0, line, f, sp, args)[2]
  1367                                           
  1368                                                                       # replacing with
  1369                                                                       wth = self.parse(1, line, f, sp, args)[2]
  1370                                           
  1371                                                                       if len(args) == 2:
  1372                                                                           # replaces all instances of replacing with wth
  1373                                                                           self.vars[vname].value = self.vars[vname].value.replace(
  1374                                                                               replacing, wth)
  1375                                                                       elif len(args) == 3:
  1376                                                                           self.vars[vname].value = self.vars[vname].value.replace(
  1377                                                                               replacing, wth, self.parse(2, line, f, sp, args)[2])
  1378                                           
  1379                                                                       # returns the new string
  1380                                                                       return self.vars[vname].value
  1381                                           
  1382                                                                   # strips the value at the variable name
  1383                                                                   if objfunc == 'strip':
  1384                                                                       self.vars[vname].value = self.vars[vname].value.strip()
  1385                                                                       return self.vars[vname].value
  1386                                           
  1387                                                                   # obtains a stripped version of itself
  1388                                                                   if objfunc == 'stripped':
  1389                                                                       return self.vars[vname].value.strip()
  1390                                           
  1391                                                                   # obtains itself
  1392                                                                   if objfunc == 'self':
  1393                                                                       try:
  1394                                                                           return self.vars[vname].value
  1395                                                                       except:
  1396                                                                           return self.vars[vname]
  1397                                           
  1398                                                                   # sets a character in this string
  1399                                                                   if objfunc == 'set':
  1400                                           
  1401                                                                       # index to set
  1402                                                                       index = self.parse(0, line, f, sp, args)[2]
  1403                                           
  1404                                                                       # what to set it to
  1405                                                                       to_set = self.parse(1, line, f, sp, args)[2]
  1406                                           
  1407                                                                       # create a new string with the new character
  1408                                                                       self.vars[vname].value = self.vars[vname].value[:index] + \
  1409                                                                           to_set + self.vars[vname].value[index + 1:]
  1410                                           
  1411                                                                       # returns the new string
  1412                                                                       return self.vars[vname].value
  1413                                           
  1414                                                                   # gets a character in this string
  1415                                                                   if objfunc == 'get':
  1416                                                                       return self.vars[vname].value[self.parse(0, line, f, sp, args)[2]]
  1417                                           
  1418                                                                   # uppercases the string
  1419                                                                   if objfunc == 'upper':
  1420                                                                       self.vars[vname].value = self.vars[vname].value.upper()
  1421                                                                       return self.vars[vname].value
  1422                                           
  1423                                                                   # lowercases the string
  1424                                                                   if objfunc == 'lower':
  1425                                                                       self.vars[vname].value = self.vars[vname].value.lower()
  1426                                           
  1427                                                                   # cuts a string to the two indices passed
  1428                                                                   if objfunc == 'cut':
  1429                                                                       self.vars[vname].value = self.vars[vname].value[self.parse(
  1430                                                                           0, line, f, sp, args)[2]:self.parse(1, line, f, sp, args)[2]]
  1431                                                                       return self.vars[vname].value
  1432                                           
  1433                                                                   # inserts a string into a position
  1434                                                                   if objfunc == 'shove':
  1435                                                                       inserting = self.parse(0, line, f, sp, args)[2]
  1436                                                                       index = self.parse(1, line, f, sp, args)[2]
  1437                                                                       fixed = self.vars[vname].value[:index] + \
  1438                                                                           inserting + self.vars[vname].value[index:]
  1439                                                                       self.vars[vname].value = fixed
  1440                                                                       return self.vars[vname].value
  1441                                           
  1442                                                                   # gets a string containing a certain amount of characters left and
  1443                                                                   # right of the first occurance of the string inside of a string
  1444                                                                   if objfunc == 'around':
  1445                                           
  1446                                                                       # keyword to search for
  1447                                                                       keyword = self.parse(0, line, f, sp, args)[2]
  1448                                           
  1449                                                                       # amount of characters to get to the left of the keyword
  1450                                                                       left = self.parse(1, line, f, sp, args)[2]
  1451                                           
  1452                                                                       # amount of characters to get to the right of the keyword
  1453                                                                       right = self.parse(2, line, f, sp, args)[2]
  1454                                           
  1455                                                                       # get the index of the keyword
  1456                                                                       index = object.find(keyword)
  1457                                           
  1458                                                                       # if not found
  1459                                                                       if index == -1:
  1460                                                                           return f"around(): Keyword '{keyword}' not found in string"
  1461                                           
  1462                                                                       # get the string
  1463                                                                       return object[index-left:index+len(keyword)+right]
  1464                                           
  1465                                                                   # startswith
  1466                                                                   if objfunc == 'startswith':
  1467                                                                       return object.startswith(self.parse(0, line, f, sp, args)[2])
  1468                                           
  1469                                                                   # endswith
  1470                                                                   if objfunc == 'endswith':
  1471                                                                       return object.endswith(self.parse(0, line, f, sp, args)[2])
  1472                                           
  1473                                                               # working with the HTML session
  1474                                                               # object
  1475                                                               elif str(type(object)) == "<class 'requests_html.HTMLSession'>":
  1476                                                                   # gets information from a website
  1477                                                                   if objfunc == 'all':
  1478                                                                       return object.get(self.parse(0, line, f, sp, args)[2]).html
  1479                                           
  1480                                                                   # renders the html session
  1481                                                                   if objfunc == 'render':
  1482                                                                       return object.render(retries=3)
  1483                                           
  1484                                                                   return object
  1485                                           
  1486                                                               # working with requests_html.HTML
  1487                                                               # 2.0.384
  1488                                                               elif str(type(object)) == "<class 'requests_html.HTML'>":
  1489                                           
  1490                                                                   # finds elements in the HTML
  1491                                                                   if objfunc == 'gather':
  1492                                           
  1493                                                                       # if one argument
  1494                                                                       if args[0][0] == '':
  1495                                                                           return object.find()
  1496                                                                       else:
  1497                                                                           return object.find(self.parse(0, line, f, sp, args)[2])
  1498                                           
  1499                                                                   # return the attribute offered by the object itself
  1500                                                                   return getattr(object, objfunc)
  1501                                           
  1502                                                               # working with Excel sheets
  1503                                                               elif isinstance(object, self.Sheet):
  1504                                           
  1505                                                                   # active elements
  1506                                                                   title = object.title
  1507                                                                   workbook = object.workbook
  1508                                                                   path = object.path
  1509                                                                   sheet = object.sheet
  1510                                           
  1511                                                                   # gets the value of a cell
  1512                                                                   if objfunc == 'get':
  1513                                           
  1514                                                                       # column of the cell
  1515                                                                       column = self.parse(0, line, f, sp, args)[2]
  1516                                           
  1517                                                                       # row of the cell
  1518                                                                       row = self.parse(1, line, f, sp, args)[2]
  1519                                           
  1520                                                                       # returns the value of the cell
  1521                                                                       return sheet.cell(row + 1, column + 1).value
  1522                                           
  1523                                                                   # sets the value of a cell
  1524                                                                   if objfunc == 'set':
  1525                                           
  1526                                                                       # column of the cell
  1527                                                                       column = self.parse(0, line, f, sp, args)[2]
  1528                                           
  1529                                                                       # row of the cell
  1530                                                                       row = self.parse(1, line, f, sp, args)[2]
  1531                                           
  1532                                                                       # value to set the cell to
  1533                                                                       value = self.parse(2, line, f, sp, args)[2]
  1534                                           
  1535                                                                       # sets the value of the cell
  1536                                                                       sheet.cell(row + 1, column + 1, value)
  1537                                           
  1538                                                                       # returns the sheet
  1539                                                                       return value
  1540                                           
  1541                                                                   # clears the sheet
  1542                                                                   if objfunc == 'clear':
  1543                                           
  1544                                                                       # clears the sheet
  1545                                                                       for row in sheet.iter_rows():
  1546                                                                           for cell in row:
  1547                                                                               cell.value = None
  1548                                           
  1549                                                                       # returns the sheet
  1550                                                                       return object
  1551                                           
  1552                                                                   # gets the populated cell values of a column
  1553                                                                   # if the argument is a number, it gets the value of that column
  1554                                                                   # if the argument is a string, it gets the value of the column with that title
  1555                                                                   if objfunc == 'column':
  1556                                           
  1557                                                                       # column, either an integer or string
  1558                                                                       col = self.parse(0, line, f, sp, args)[2]
  1559                                           
  1560                                                                       column_values = []
  1561                                           
  1562                                                                       # if number
  1563                                                                       if isinstance(col, int):
  1564                                                                           col += 1
  1565                                                                           for cell in sheet.iter_cols(min_col=col, max_col=col):
  1566                                                                               for row in cell:
  1567                                                                                   if row.value != None:
  1568                                                                                       column_values.append(row.value)
  1569                                           
  1570                                                                       # otherwise, get column by title
  1571                                                                       elif isinstance(col, str):
  1572                                           
  1573                                                                           # for each column
  1574                                                                           for cell in sheet.iter_cols():
  1575                                                                               # if the title matches
  1576                                                                               if cell[0].value == col:
  1577                                           
  1578                                                                                   # get the column values
  1579                                                                                   for row in cell:
  1580                                                                                       if row.value != None:
  1581                                                                                           column_values.append(row.value)
  1582                                                                       return column_values
  1583                                           
  1584                                                                   # gets the populated cell values of a row
  1585                                                                   # if the argument is a number, it gets the value of that column
  1586                                                                   # if the argument is a string, it gets the value of the column with that title
  1587                                                                   if objfunc == 'row':
  1588                                           
  1589                                                                       # row, either an integer or string
  1590                                                                       r = self.parse(0, line, f, sp, args)[2]
  1591                                           
  1592                                                                       row_values = []
  1593                                           
  1594                                                                       # if number
  1595                                                                       if isinstance(r, int):
  1596                                                                           r += 1
  1597                                                                           for cell in sheet.iter_rows(min_row=r, max_row=r):
  1598                                                                               for row in cell:
  1599                                                                                   if row.value != None:
  1600                                                                                       row_values.append(row.value)
  1601                                                                       # otherwise, get row by title
  1602                                                                       elif isinstance(r, str):
  1603                                           
  1604                                                                           # for each row
  1605                                                                           for cell in sheet.iter_rows():
  1606                                                                               # if the title matches
  1607                                                                               if cell[0].value == r:
  1608                                           
  1609                                                                                   # get the row values
  1610                                                                                   for row in cell:
  1611                                                                                       if row.value != None:
  1612                                                                                           row_values.append(row.value)
  1613                                                                       return row_values
  1614                                           
  1615                                                                   # gets the index of a column with a given title
  1616                                                                   def get_column_index(title):
  1617                                                                       for cell in sheet.iter_cols():
  1618                                                                           if cell[0].value == title:
  1619                                                                               return cell[0].column
  1620                                                                       return None
  1621                                           
  1622                                                                   def get_row_index(title):
  1623                                                                       for cell in sheet.iter_rows():
  1624                                                                           if cell[0].value == title:
  1625                                                                               return cell[0].row
  1626                                                                       return None
  1627                                           
  1628                                                                   # rewrite the above method, but with
  1629                                                                   # if the argument is a number, it gets the value of that column
  1630                                                                   # if the argument is a string, it gets the value of the column with that title
  1631                                                                   if objfunc == 'set_column':
  1632                                           
  1633                                                                       # column, either an integer or string
  1634                                                                       col = self.parse(0, line, f, sp, args)[2]
  1635                                           
  1636                                                                       # array of values
  1637                                                                       values = self.parse(1, line, f, sp, args)[2]
  1638                                           
  1639                                                                       # if number
  1640                                                                       if isinstance(col, int):
  1641                                                                           col += 1
  1642                                                                           for i in range(len(values)):
  1643                                                                               sheet.cell(i + 1, col, values[i])
  1644                                           
  1645                                                                       # otherwise, get column by title
  1646                                                                       elif isinstance(col, str):
  1647                                           
  1648                                                                           # for each column
  1649                                                                           for cell in sheet.iter_cols():
  1650                                                                               # if the title matches
  1651                                                                               if cell[0].value == col:
  1652                                           
  1653                                                                                   # get the column values
  1654                                                                                   for i in range(len(values)):
  1655                                                                                       sheet.cell(
  1656                                                                                           i + 1, get_column_index(col), values[i])
  1657                                           
  1658                                                                       return values
  1659                                           
  1660                                                                   # sets a row to an array of values
  1661                                                                   # if the argument is a number, it gets the value of that column
  1662                                                                   # if the argument is a string, it gets the value of the column with that title
  1663                                                                   elif objfunc == 'set_row':
  1664                                           
  1665                                                                       # row, either an integer or string
  1666                                                                       r = self.parse(0, line, f, sp, args)[2]
  1667                                           
  1668                                                                       # array of values
  1669                                                                       values = self.parse(1, line, f, sp, args)[2]
  1670                                           
  1671                                                                       # if number
  1672                                                                       if isinstance(r, int):
  1673                                                                           r += 1
  1674                                                                           for i in range(len(values)):
  1675                                                                               sheet.cell(r, i + 1, values[i])
  1676                                           
  1677                                                                       # otherwise, get row by title
  1678                                                                       elif isinstance(r, str):
  1679                                           
  1680                                                                           # for each row
  1681                                                                           for cell in sheet.iter_rows():
  1682                                                                               # if the title matches
  1683                                                                               if cell[0].value == r:
  1684                                           
  1685                                                                                   # get the row values
  1686                                                                                   for i in range(len(values)):
  1687                                                                                       sheet.cell(get_row_index(
  1688                                                                                           r), i + 1, values[i])
  1689                                                                       return values
  1690                                           
  1691                                                                   # reqrite the above method, but with
  1692                                                                   # if the argument is a number, it gets the value of that column
  1693                                                                   # if the argument is a string, it gets the value of the column with that title
  1694                                                                   elif objfunc == 'add_to_column':
  1695                                           
  1696                                                                       # column
  1697                                                                       column = self.parse(0, line, f, sp, args)[2]
  1698                                           
  1699                                                                       # value to add
  1700                                                                       value = self.parse(1, line, f, sp, args)[2]
  1701                                           
  1702                                                                       # if number
  1703                                                                       if isinstance(column, int):
  1704                                                                           column += 1
  1705                                                                           # find the first empty cell in the column
  1706                                                                           for i in range(sheet.max_row + 1):
  1707                                                                               if sheet.cell(i + 1, column).value == None:
  1708                                                                                   sheet.cell(i + 1, column, value)
  1709                                                                                   return value
  1710                                                                           return value
  1711                                           
  1712                                                                       # otherwise, get column by title
  1713                                                                       elif isinstance(column, str):
  1714                                                                           column_index = get_column_index(column)
  1715                                                                           # find the first empty cell in the column
  1716                                                                           for i in range(sheet.max_row + 1):
  1717                                                                               if sheet.cell(i + 1, column_index).value == None:
  1718                                                                                   sheet.cell(i + 1, column_index, value)
  1719                                                                                   return value
  1720                                                                       return value
  1721                                           
  1722                                                                   # adds a value to a row
  1723                                                                   # if the argument is a number, it gets the value of that column
  1724                                                                   # if the argument is a string, it gets the value of the column with that title
  1725                                                                   elif objfunc == 'add_to_row':
  1726                                           
  1727                                                                       # row
  1728                                                                       row = self.parse(0, line, f, sp, args)[2]
  1729                                           
  1730                                                                       # value to add
  1731                                                                       value = self.parse(1, line, f, sp, args)[2]
  1732                                           
  1733                                                                       # if number
  1734                                                                       if isinstance(row, int):
  1735                                                                           row += 1
  1736                                                                           # find the first empty cell in the row
  1737                                                                           for i in range(sheet.max_column):
  1738                                                                               if sheet.cell(row, i + 1).value == None:
  1739                                                                                   sheet.cell(row, i + 1, value)
  1740                                                                                   return value
  1741                                                                           return value
  1742                                           
  1743                                                                       # otherwise, get row by title
  1744                                                                       elif isinstance(row, str):
  1745                                                                           row_index = get_row_index(row)
  1746                                                                           # find the first empty cell in the row
  1747                                                                           for i in range(sheet.max_column):
  1748                                                                               if sheet.cell(row_index, i + 1).value == None:
  1749                                                                                   sheet.cell(row_index, i + 1, value)
  1750                                                                                   return value
  1751                                                                       return value
  1752                                           
  1753                                                                   # performs code for each row
  1754                                                                   # takes 2 arguments, a string for the row variable
  1755                                                                   # and a function to perform on each row
  1756                                                                   elif objfunc == 'each_row':
  1757                                                                       # variable
  1758                                                                       row_var = self.parse(0, line, f, sp, args)[2]
  1759                                                                       # function
  1760                                                                       block = args[1][0]
  1761                                                                       ret = None
  1762                                           
  1763                                                                       # for each cell
  1764                                                                       for cell in sheet.iter_rows():
  1765                                           
  1766                                                                           # set the variable to the row
  1767                                                                           self.vars[row_var] = Var(
  1768                                                                               row_var, [cell[i].value for i in range(len(cell))])
  1769                                                                           # execute the function
  1770                                                                           ret = self.interpret(block)
  1771                                           
  1772                                                                       return ret
  1773                                           
  1774                                                                   # writes a matrix (2D array) to this Excel Worksheet
  1775                                                                   # with the offsets given by the second and third arguments,
  1776                                                                   # if no second or third arguments, then the matrix is written
  1777                                                                   # starting at the first cell
  1778                                                                   elif objfunc == 'import_matrix':
  1779                                           
  1780                                                                       # get the 2D list
  1781                                                                       matrix = self.parse(0, line, f, sp, args)[2]
  1782                                           
  1783                                                                       # default offset
  1784                                                                       offsetx = 0
  1785                                                                       offsety = 0
  1786                                           
  1787                                                                       # if there is a second argument
  1788                                                                       if len(args) == 2:
  1789                                                                           offsetx = self.parse(1, line, f, sp, args)[2]
  1790                                                                       if len(args) == 3:
  1791                                                                           offsetx = self.parse(1, line, f, sp, args)[2]
  1792                                                                           offsety = self.parse(2, line, f, sp, args)[2]
  1793                                           
  1794                                                                       # for each row
  1795                                                                       for i in range(len(matrix)):
  1796                                                                           # for each column
  1797                                                                           for j in range(len(matrix[i])):
  1798                                                                               w = matrix[i][j]
  1799                                                                               # if w is an AppElement, write its name
  1800                                                                               if 'name' in dir(w):
  1801                                                                                   w = w.name
  1802                                                                               sheet.cell(i + offsety + 1,
  1803                                                                                          j + offsetx + 1, w)
  1804                                                                       return matrix
  1805                                           
  1806                                                                   # if nothing else, return the object
  1807                                                                   return object
  1808                                           
  1809                                                               # working with Excel
  1810                                                               elif isinstance(object, self.Workbook):
  1811                                           
  1812                                                                   # active workbook
  1813                                                                   workbook = object.workbook
  1814                                                                   path = object.path
  1815                                           
  1816                                                                   # gets or creates a sheet in the workbook
  1817                                                                   if objfunc == 'sheet':
  1818                                           
  1819                                                                       # title of the new sheet
  1820                                                                       title = self.parse(0, line, f, sp, args)[2]
  1821                                           
  1822                                                                       # if title is a string
  1823                                                                       if isinstance(title, str):
  1824                                           
  1825                                                                           # if the sheet has already been created,
  1826                                                                           # return the created sheet
  1827                                                                           for name in workbook.sheetnames:
  1828                                                                               if name.lower() == title.lower():
  1829                                                                                   return self.Sheet(workbook[name], name, workbook, path)
  1830                                           
  1831                                                                           # creates the sheet
  1832                                                                           sheet = workbook.create_sheet(title)
  1833                                           
  1834                                                                           # returns the sheet
  1835                                                                           return self.Sheet(sheet, title, workbook, path)
  1836                                                                       # title is integer,
  1837                                                                       # return the sheet at that index
  1838                                                                       else:
  1839                                                                           for i, sheet in enumerate(workbook.sheetnames):
  1840                                                                               if i == title:
  1841                                                                                   return self.Sheet(workbook[sheet], sheet, workbook, path)
  1842                                                                       return None
  1843                                           
  1844                                                                   # saves the workbook
  1845                                                                   if objfunc == 'save':
  1846                                                                       workbook.save(path)
  1847                                                                       return object
  1848                                                                   # closes the workbook
  1849                                                                   if objfunc == 'close' or objfunc == 'stop' or objfunc == 'kill':
  1850                                                                       workbook.close()
  1851                                                                       return object
  1852                                           
  1853                                                                   # otherwise return the object
  1854                                                                   return object
  1855                                           
  1856                                                               # GENERAL METHODS
  1857                                                               # gets the immediate children of the parent window
  1858                                           
  1859                                                               def children(parent_window):
  1860                                                                   return [self.AppElement(child, child.window_text()) for child in window.children()]
  1861                                                               # gets a child at an index
  1862                                                               # prints the children
  1863                                           
  1864                                                               def child(parent_window, index):
  1865                                                                   child = children(parent_window)[index]
  1866                                                                   return self.AppElement(child, child.window_text())
  1867                                                               # finds a child with subtext in its name
  1868                                           
  1869                                                               def find_children(parent_window, subtext):
  1870                                                                   subtext = subtext.lower()
  1871                                                                   return [self.AppElement(child, child.window_text()) for child in window.children()
  1872                                                                           if subtext in child.window_text().lower()]
  1873                                           
  1874                                                               # recursively searches the child tree for a certain object type
  1875                                                               # dont allow ElementAmbiguousError
  1876                                           
  1877                                                               def recursive_search(parent_window, type, as_type, object_string_endswith=None):
  1878                                                                   found = []
  1879                                                                   # get the children
  1880                                                                   # use kwargs to avoid ElementAmbiguousError
  1881                                                                   # kwargs is a criteria to reduce a list by process, class_name, control_type, content_only and/or title.
  1882                                                                   kwargs = {'process': parent_window.process_id()}
  1883                                                                   c = parent_window.children(**kwargs)
  1884                                                                   for child in c:
  1885                                                                       if isinstance(child, type) or (object_string_endswith and str(child).endswith(object_string_endswith)):
  1886                                                                           found += [as_type(child, child.window_text())]
  1887                                                                       found += recursive_search(child, type,
  1888                                                                                                 as_type, object_string_endswith)
  1889                                                                   return found
  1890                                                               # prints all elements
  1891                                           
  1892                                                               def print_elements(parent_window, retrieve_elements):
  1893                                                                   for i, element in enumerate(retrieve_elements(parent_window)):
  1894                                                                       print(i, ":")
  1895                                                                       print(element)
  1896                                                                   return None
  1897                                                               # finds an element containing the substring specified
  1898                                           
  1899                                                               def find_elements(parent_window, subtext, retrieve_elements):
  1900                                                                   elements = []
  1901                                                                   subtext = subtext.lower()
  1902                                                                   for element in retrieve_elements(parent_window):
  1903                                                                       if subtext in element.name.lower():
  1904                                                                           elements.append(self.AppElement(
  1905                                                                               element, element.window_text()))
  1906                                                                   return elements
  1907                                                               # finds the exact elements specified
  1908                                           
  1909                                                               def find_elements_exact(parent_window, text, retrieve_elements):
  1910                                                                   elements = []
  1911                                                                   for element in retrieve_elements(parent_window):
  1912                                                                       if text == element.name:
  1913                                                                           elements.append(self.AppElement(
  1914                                                                               element, element.window_text()))
  1915                                                                   return elements
  1916                                                               # waits for the first element to appear containing the substring specified
  1917                                                               # is not case sensitive
  1918                                           
  1919                                                               def wait_for_element_subtext(parent_window, retrieve_elements, subtext, timeout=None):
  1920                                                                   subtext = subtext.lower()
  1921                                                                   # subfunction for locating the element
  1922                                           
  1923                                                                   def find_element_():
  1924                                                                       try:
  1925                                                                           for element in retrieve_elements(parent_window):
  1926                                                                               if subtext in element.name.lower():
  1927                                                                                   return self.AppElement(element, element.window_text())
  1928                                                                       except:
  1929                                                                           pass
  1930                                                                   if not timeout:
  1931                                                                       while True:
  1932                                                                           if (_ret := find_element_()) is not None:
  1933                                                                               return _ret
  1934                                                                   else:
  1935                                                                       import time
  1936                                                                       # get the current time
  1937                                                                       start_time = time.time()
  1938                                                                       # while the time elapsed is less than the timeout
  1939                                                                       while time.time() - start_time < timeout:
  1940                                                                           if (_ret := find_element_()) is not None:
  1941                                                                               return _ret
  1942                                                               # waits for the first element to appear with the exact text specified
  1943                                           
  1944                                                               def wait_for_element_exact(parent_window, retrieve_elements, text, timeout=None):
  1945                                                                   # subfunction for locating the element
  1946                                                                   def find_element_():
  1947                                                                       try:
  1948                                                                           for element in retrieve_elements(parent_window):
  1949                                                                               if text == element.name:
  1950                                                                                   return self.AppElement(element, element.window_text())
  1951                                                                       except:
  1952                                                                           pass
  1953                                                                   if not timeout:
  1954                                                                       while True:
  1955                                                                           if (_ret := find_element_()) is not None:
  1956                                                                               return _ret
  1957                                                                   else:
  1958                                                                       import time
  1959                                                                       # get the current time
  1960                                                                       start_time = time.time()
  1961                                                                       # while the time elapsed is less than the timeout
  1962                                                                       while time.time() - start_time < timeout:
  1963                                                                           if (_ret := find_element_()) is not None:
  1964                                                                               return _ret
  1965                                                               # waits for the first element to appear in all children containing the substring specified with the type specified
  1966                                           
  1967                                                               def wait_for_type_subtext_all(parent_window, type, as_type, subtext, timeout=None):
  1968                                                                   return wait_for_element_subtext(parent_window, lambda parent_window: recursive_search(parent_window, type, as_type), subtext, timeout=timeout)
  1969                                                               # wait for the first element to appear in all children with the exact text specified with the type specified
  1970                                           
  1971                                                               def wait_for_type_exact_all(parent_window, type, as_type, text, timeout=None):
  1972                                                                   return wait_for_element_exact(parent_window, lambda parent_window: recursive_search(parent_window, type, as_type), text, timeout=timeout)
  1973                                           
  1974                                                               # waits for a child to exist with text containing subtext
  1975                                           
  1976                                                               def wait_for_text(parent_window, subtext, timeout=None):
  1977                                                                   return wait_for_element_subtext(parent_window, children, subtext, timeout=timeout)
  1978                                                               # waits for a child to exist in the entire child tree containing subtext
  1979                                           
  1980                                                               def wait_for_text_all(parent_window, subtext, timeout=None):
  1981                                                                   return wait_for_element_subtext(parent_window, all_children, subtext, timeout=timeout)
  1982                                                               # waits for a child to exist with text exactly equal to text
  1983                                           
  1984                                                               def wait_for_text_exact(parent_window, text, timeout=None):
  1985                                                                   return wait_for_element_exact(parent_window, children, text, timeout=timeout)
  1986                                                               # waits for a child to exist in the entire child tree with text exactly equal to text
  1987                                           
  1988                                                               def wait_for_text_exact_all(parent_window, text, timeout=None):
  1989                                                                   return wait_for_element_exact(parent_window, all_children, text, timeout=timeout)
  1990                                                               # prints all children of a parent window
  1991                                           
  1992                                                               def print_children(parent_window):
  1993                                                                   return print_elements(parent_window, children)
  1994                                           
  1995                                                               # gets all children in the child tree
  1996                                                               def all_children(parent_window):
  1997                                                                   found = []
  1998                                                                   for child in parent_window.children():
  1999                                                                       found.append(self.AppElement(
  2000                                                                           child, child.window_text()))
  2001                                                                       found += all_children(child)
  2002                                                                   return found
  2003                                                               # prints the child tree of a parent window
  2004                                           
  2005                                                               def print_all_children(parent_window):
  2006                                                                   return print_elements(parent_window, all_children)
  2007                                                               # gets from all children at an index
  2008                                           
  2009                                                               def all_child(parent_window, index):
  2010                                                                   return all_children(parent_window)[index]
  2011                                                               # finds all children with subtext in their name
  2012                                           
  2013                                                               def find_all_children(parent_window, subtext):
  2014                                                                   return find_elements(parent_window, subtext, all_children)
  2015                                                               # finds all children from an exact text
  2016                                           
  2017                                                               def find_all_children_exact(parent_window, text):
  2018                                                                   return find_elements_exact(parent_window, text, all_children)
  2019                                           
  2020                                                               # ---------------------------
  2021                                           
  2022                                                               # NARROWING GENERAL METHODS
  2023                                                               # recursively gets all menus existing in the parent_window tree
  2024                                                               # accumulates all instances of pywinauto.controls.uia_controls.MenuWrapper
  2025                                           
  2026                                                               def menus(parent_window):
  2027                                                                   return recursive_search(parent_window, pywinauto.controls.uia_controls.MenuWrapper, self.Menu)
  2028                                                               # gets a single menu
  2029                                           
  2030                                                               def menu(parent_window, index):
  2031                                                                   return menus(parent_window)[index]
  2032                                                               # prints all the menus
  2033                                           
  2034                                                               def print_menus(parent_window):
  2035                                                                   return print_elements(parent_window, menus)
  2036                                                               # finds a menu with subtext in its name
  2037                                           
  2038                                                               def find_menus(parent_window, subtext):
  2039                                                                   return find_elements(parent_window, subtext, menus)
  2040                                           
  2041                                                               # gets all toolbars
  2042                                                               def toolbars(parent_window):
  2043                                                                   return recursive_search(parent_window, pywinauto.controls.uia_controls.ToolbarWrapper, self.ToolBar)
  2044                                           
  2045                                                               def print_toolbars(parent_window):
  2046                                                                   return print_elements(parent_window, toolbars)
  2047                                           
  2048                                                               def toolbar(parent_window, index):
  2049                                                                   return toolbars(parent_window)[index]
  2050                                           
  2051                                                               def find_toolbars(parent_window, subtext):
  2052                                                                   return find_elements(parent_window, subtext, toolbars)
  2053                                           
  2054                                                               # recursively gets all instances of pywinauto.controls.uia_controls.ButtonWrapper
  2055                                                               def buttons(parent_window):
  2056                                                                   return recursive_search(parent_window, pywinauto.controls.uia_controls.ButtonWrapper, self.Button)
  2057                                           
  2058                                                               def button(parent_window, index):
  2059                                                                   return buttons(parent_window)[index]
  2060                                           
  2061                                                               def print_buttons(parent_window):
  2062                                                                   return print_elements(parent_window, buttons)
  2063                                           
  2064                                                               def find_buttons(parent_window, subtext):
  2065                                                                   return find_elements(parent_window, subtext, buttons)
  2066                                           
  2067                                                               # for hyperlinks
  2068                                                               def links(parent_window):
  2069                                                                   return recursive_search(parent_window, int, self.Link, object_string_endswith="Hyperlink")
  2070                                           
  2071                                                               def link(parent_window, index):
  2072                                                                   return links(parent_window)[index]
  2073                                           
  2074                                                               def print_links(parent_window):
  2075                                                                   return print_elements(parent_window, links)
  2076                                           
  2077                                                               def find_links(parent_window, subtext):
  2078                                                                   return find_elements(parent_window, subtext, links)
  2079                                           
  2080                                                               def find_links_exact(parent_window, text):
  2081                                                                   return find_elements_exact(parent_window, text, links)
  2082                                           
  2083                                                               # for tabitems
  2084                                                               def tabitems(parent_window):
  2085                                                                   return recursive_search(parent_window, int, self.TabItem, object_string_endswith="TabItem")
  2086                                           
  2087                                                               def tabitem(parent_window, index):
  2088                                                                   return tabitems(parent_window)[index]
  2089                                           
  2090                                                               def print_tabitems(parent_window):
  2091                                                                   return print_elements(parent_window, tabitems)
  2092                                           
  2093                                                               def find_tabitems(parent_window, subtext):
  2094                                                                   return find_elements(parent_window, subtext, tabitems)
  2095                                           
  2096                                                               def find_tabitems_exact(parent_window, text):
  2097                                                                   return find_elements_exact(parent_window, text, tabitems)
  2098                                           
  2099                                                               # for tabcontrols
  2100                                                               def tabcontrols(parent_window):
  2101                                                                   return recursive_search(parent_window, int, self.AppElement, object_string_endswith="TabControl")
  2102                                           
  2103                                                               def tabcontrol(parent_window, index):
  2104                                                                   return tabcontrols(parent_window)[index]
  2105                                           
  2106                                                               def print_tabcontrols(parent_window):
  2107                                                                   return print_elements(parent_window, tabcontrols)
  2108                                           
  2109                                                               def find_tabcontrols(parent_window, subtext):
  2110                                                                   return find_elements(parent_window, subtext, tabcontrols)
  2111                                           
  2112                                                               def find_tabcontrols_exact(parent_window, text):
  2113                                                                   return find_elements_exact(parent_window, text, tabcontrols)
  2114                                           
  2115                                                               # for EditWrapper
  2116                                                               def inputs(parent_window):
  2117                                                                   return recursive_search(parent_window, pywinauto.controls.uia_controls.EditWrapper, self.Input)
  2118                                           
  2119                                                               def input(parent_window, index):
  2120                                                                   return inputs(parent_window)[index]
  2121                                           
  2122                                                               def print_inputs(parent_window):
  2123                                                                   return print_elements(parent_window, inputs)
  2124                                           
  2125                                                               def find_inputs(parent_window, subtext):
  2126                                                                   return find_elements(parent_window, subtext, inputs)
  2127                                           
  2128                                                               def find_inputs_exact(parent_window, text):
  2129                                                                   return find_elements_exact(parent_window, text, inputs)
  2130                                           
  2131                                                               # for ButtonWrapper but endswith CheckBox
  2132                                                               def checkboxes(parent_window):
  2133                                                                   return recursive_search(parent_window, int, self.Button, object_string_endswith="CheckBox")
  2134                                           
  2135                                                               def checkbox(parent_window, index):
  2136                                                                   return checkboxes(parent_window)[index]
  2137                                           
  2138                                                               def print_checkboxes(parent_window):
  2139                                                                   return print_elements(parent_window, checkboxes)
  2140                                           
  2141                                                               def find_checkboxes(parent_window, subtext):
  2142                                                                   return find_elements(parent_window, subtext, checkboxes)
  2143                                           
  2144                                                               def find_checkboxes_exact(parent_window, text):
  2145                                                                   return find_elements_exact(parent_window, text, checkboxes)
  2146                                           
  2147                                                               # for Image
  2148                                                               def images(parent_window):
  2149                                                                   return recursive_search(parent_window, int, self.AppElement, object_string_endswith="Image")
  2150                                           
  2151                                                               def image(parent_window, index):
  2152                                                                   return images(parent_window)[index]
  2153                                           
  2154                                                               def print_images(parent_window):
  2155                                                                   return print_elements(parent_window, images)
  2156                                           
  2157                                                               def find_images(parent_window, subtext):
  2158                                                                   return find_elements(parent_window, subtext, images)
  2159                                           
  2160                                                               def find_images_exact(parent_window, text):
  2161                                                                   return find_elements_exact(parent_window, text, images)
  2162                                           
  2163                                                               # for Tables
  2164                                                               def tables(parent_window):
  2165                                                                   return recursive_search(parent_window, int, self.Table, object_string_endswith="Table")
  2166                                           
  2167                                                               def table(parent_window, index):
  2168                                                                   return tables(parent_window)[index]
  2169                                           
  2170                                                               def print_tables(parent_window):
  2171                                                                   return print_elements(parent_window, tables)
  2172                                           
  2173                                                               def find_tables(parent_window, subtext):
  2174                                                                   return find_elements(parent_window, subtext, tables)
  2175                                           
  2176                                                               def find_tables_exact(parent_window, text):
  2177                                                                   return find_elements_exact(parent_window, text, tables)
  2178                                           
  2179                                                               # for GroupBoxes
  2180                                                               def groupboxes(parent_window):
  2181                                                                   return recursive_search(parent_window, int, self.AppElement, object_string_endswith="GroupBox")
  2182                                           
  2183                                                               def groupbox(parent_window, index):
  2184                                                                   return groupboxes(parent_window)[index]
  2185                                           
  2186                                                               def print_groupboxes(parent_window):
  2187                                                                   return print_elements(parent_window, groupboxes)
  2188                                           
  2189                                                               def find_groupboxes(parent_window, subtext):
  2190                                                                   return find_elements(parent_window, subtext, groupboxes)
  2191                                           
  2192                                                               def find_groupboxes_exact(parent_window, text):
  2193                                                                   return find_elements_exact(parent_window, text, groupboxes)
  2194                                           
  2195                                                               # for Panes
  2196                                                               def panes(parent_window):
  2197                                                                   return recursive_search(parent_window, int, self.AppElement, object_string_endswith="Pane")
  2198                                           
  2199                                                               def pane(parent_window, index):
  2200                                                                   return panes(parent_window)[index]
  2201                                           
  2202                                                               def print_panes(parent_window):
  2203                                                                   return print_elements(parent_window, panes)
  2204                                           
  2205                                                               def find_panes(parent_window, subtext):
  2206                                                                   return find_elements(parent_window, subtext, panes)
  2207                                           
  2208                                                               def find_panes_exact(parent_window, text):
  2209                                                                   return find_elements_exact(parent_window, text, panes)
  2210                                           
  2211                                                               # for ListItems
  2212                                                               def listitems(parent_window):
  2213                                                                   return recursive_search(parent_window, pywinauto.controls.uia_controls.ListItemWrapper, self.AppElement, object_string_endswith="ListItem")
  2214                                           
  2215                                                               def listitem(parent_window, index):
  2216                                                                   return listitems(parent_window)[index]
  2217                                           
  2218                                                               def print_listitems(parent_window):
  2219                                                                   return print_elements(parent_window, listitems)
  2220                                           
  2221                                                               def find_listitems(parent_window, subtext):
  2222                                                                   return find_elements(parent_window, subtext, listitems)
  2223                                           
  2224                                                               def find_listitems_exact(parent_window, text):
  2225                                                                   return find_elements_exact(parent_window, text, listitems)
  2226                                           
  2227                                                               # for documents
  2228                                                               def documents(parent_window):
  2229                                                                   return recursive_search(parent_window, int, self.AppElement, object_string_endswith="Document")
  2230                                           
  2231                                                               def document(parent_window, index):
  2232                                                                   return documents(parent_window)[index]
  2233                                           
  2234                                                               def print_documents(parent_window):
  2235                                                                   return print_elements(parent_window, documents)
  2236                                           
  2237                                                               def find_documents(parent_window, subtext):
  2238                                                                   return find_elements(parent_window, subtext, documents)
  2239                                           
  2240                                                               def find_documents_exact(parent_window, text):
  2241                                                                   return find_elements_exact(parent_window, text, documents)
  2242                                           
  2243                                                               # for decendants
  2244                                                               def descendants(parent_window):
  2245                                                                   return recursive_search(parent_window, int, self.AppElement)
  2246                                                               # ---------------------------
  2247                                                               # GENERALIZING METHOD CALLS FOR ELEMENT DISCOVERY
  2248                                           
  2249                                                               def callables(window,
  2250                                                                             # array elements
  2251                                                                             objfunc1, objfunc1_method,
  2252                                                                             # print the elements
  2253                                                                             objfunc2, objfunc2_method,
  2254                                                                             # get a certain element
  2255                                                                             objfunc3, objfunc3_method,
  2256                                                                             # find elements with subtext in their names
  2257                                                                             objfunc4, objfunc4_method,
  2258                                                                             # find elements with exact text in their names
  2259                                                                             objfunc5=None, objfunc5_method=None,
  2260                                                                             # waits for the first element of a certain type with subtext in name
  2261                                                                             objfunc6=None, objfunc6_method=None, type1=None, as_type1=None,
  2262                                                                             # waits for the first element of a certain type with exact text in name
  2263                                                                             objfunc7=None, objfunc7_method=None, type2=None, as_type2=None,
  2264                                                                             ):
  2265                                           
  2266                                                                   # RETRIEVING CHILDREN
  2267                                                                   # gets the available child reference keywords
  2268                                                                   if objfunc == objfunc1:
  2269                                                                       return objfunc1_method(window)
  2270                                                                   # prints the children
  2271                                                                   if objfunc == objfunc2:
  2272                                                                       return objfunc2_method(window)
  2273                                                                   # gets a certain child
  2274                                                                   # first argument is the index of the child
  2275                                                                   if objfunc == objfunc3:
  2276                                                                       return objfunc3_method(window, self.parse(0, line, f, sp, args)[2])
  2277                                                                   # finds children with subtext in their names
  2278                                                                   if objfunc == objfunc4:
  2279                                                                       return objfunc4_method(window, self.parse(0, line, f, sp, args)[2])
  2280                                                                   if objfunc == objfunc5:
  2281                                                                       return objfunc5_method(window, self.parse(0, line, f, sp, args)[2])
  2282                                           
  2283                                                                   # waits for the first child of a certain type with exact text in its name
  2284                                                                   if objfunc == objfunc6:
  2285                                                                       # if 1 argument, there is no timeout
  2286                                                                       if len(args) == 1:
  2287                                                                           return wait_for_type_exact_all(window, type1, as_type1, self.parse(0, line, f, sp, args)[2])
  2288                                                                       elif len(args) == 2:
  2289                                                                           return wait_for_type_exact_all(window, type1, as_type1, self.parse(0, line, f, sp, args)[2], self.parse(1, line, f, sp, args)[2])
  2290                                                                   # waits for the first child of a certain type with subtext in its name
  2291                                                                   if objfunc == objfunc7:
  2292                                                                       # if 1 argument, there is no timeout
  2293                                                                       if len(args) == 1:
  2294                                                                           return wait_for_type_subtext_all(window, type2, as_type2, self.parse(0, line, f, sp, args)[2])
  2295                                                                       elif len(args) == 2:
  2296                                                                           return wait_for_type_subtext_all(window, type2, as_type2, self.parse(0, line, f, sp, args)[2], self.parse(1, line, f, sp, args)[2])
  2297                                           
  2298                                                                   return '<msnint2 no callable>'
  2299                                           
  2300                                                               # ---------------------------
  2301                                           
  2302                                                               # moves the mouse to the center of an element, and clicks it
  2303                                           
  2304                                                               def clk(window, button='left', waittime=0):
  2305                                                                   import time
  2306                                                                   from pywinauto import mouse
  2307                                                                   # set the focus to this element
  2308                                                                   window.set_focus()
  2309                                           
  2310                                                                   # wait for the element to be ready
  2311                                                                   time.sleep(waittime)
  2312                                           
  2313                                                                   # get the new coordinates of this element after the focus
  2314                                                                   coords = window.get_properties()[
  2315                                                                       'rectangle'].mid_point()
  2316                                           
  2317                                                                   # click the mouse
  2318                                                                   mouse.click(button=button, coords=coords)
  2319                                           
  2320                                                                   # return the object
  2321                                                                   return object
  2322                                           
  2323                                                               # determines if a point is visible within a rectangle
  2324                                                               def has_point(object, x, y):
  2325                                                                   try:
  2326                                                                       rect = object.get_properties()['rectangle']
  2327                                                                       # if implemented
  2328                                                                       return rect.top <= y <= rect.bottom and rect.left <= x <= rect.right
  2329                                                                   except:
  2330                                                                       print(str(object))
  2331                                                                       return True
  2332                                                               # recursively get the first object that has the point
  2333                                                               # the first object that has the point and no children
  2334                                           
  2335                                                               def rec(root, x, y):
  2336                                           
  2337                                                                   # if the root has children
  2338                                                                   if root.children():
  2339                                                                       # for each child
  2340                                                                       for child in root.children():
  2341                                                                           # if the child has the point
  2342                                                                           if has_point(child, x, y):
  2343                                                                               # return the child
  2344                                                                               return rec(child, x, y)
  2345                                                                   # if the root has no children
  2346                                                                   else:
  2347                                                                       # return the root
  2348                                                                       return self.AppElement(root, root.window_text())
  2349                                           
  2350                                                               # get all objects that have the point
  2351                                                               def get_all(root, x, y):
  2352                                                                   all = []
  2353                                                                   # if the root has children
  2354                                                                   if root.children():
  2355                                                                       # for each child
  2356                                                                       for child in root.children():
  2357                                                                           # if the child has the point
  2358                                                                           if has_point(child, x, y):
  2359                                                                               # add the child to the list
  2360                                                                               all.append(self.AppElement(
  2361                                                                                   child, child.window_text()))
  2362                                                                               # get all of the child's children
  2363                                                                               all += get_all(child, x, y)
  2364                                                                   # return the list
  2365                                                                   return all
  2366                                           
  2367                                                               # presses multiple keys at the same time
  2368                                                               def press_simul(kys):
  2369                                                                   sending = ''
  2370                                                                   # keys down
  2371                                                                   for key in kys:
  2372                                                                       sending += '{' + key + ' down}'
  2373                                                                   # keys up
  2374                                                                   for key in kys:
  2375                                                                       sending += '{' + key + ' up}'
  2376                                                                   return sending
  2377                                           
  2378                                                               # function for converting keys requiring a shift press
  2379                                                               #   example: a '3' should be converted to {VK_SHIFT down}3{VK_SHIFT up}
  2380                                                               #   example: a '"' should be converted to {VK_SHIFT down}'{VK_SHIFT up}
  2381                                                               #   example: a 'E' should be converted to {VK_SHIFT down}e{VK_SHIFT up}
  2382                                                               # this function is mainly for converting an exerpt of code to a typable
  2383                                                               # string for pywinauto to type
  2384                                                               def convert_keys(keystrokes):
  2385                                                                   new = ''
  2386                                                                   special = {
  2387                                                                       '!': '1',
  2388                                                                       '@': '2',
  2389                                                                       '#': '3',
  2390                                                                       '$': '4',
  2391                                                                       '%': '5',
  2392                                                                       '^': '6',
  2393                                                                       '&': '7',
  2394                                                                       '*': '8',
  2395                                                                       '(': '9',
  2396                                                                       ')': '0',
  2397                                                                       '_': '-',
  2398                                                                       '+': '=',
  2399                                                                       '{': '[',
  2400                                                                       '}': ']',
  2401                                                                       '|': '\\',
  2402                                                                       ':': ';',
  2403                                                                       '"': "'",
  2404                                                                       '<': ',',
  2405                                                                       '>': '.',
  2406                                                                       '?': '/',
  2407                                                                       '~': '`',
  2408                                                                       ' ': ' '
  2409                                                                   }
  2410                                                                   # for each keystroke
  2411                                                                   for key in keystrokes:
  2412                                                                       if key == ' ':
  2413                                                                           # if the key is a space
  2414                                                                           new += ' '
  2415                                                                       elif key in special:
  2416                                                                           # if the key is a special character
  2417                                                                           new += '{VK_SHIFT down}' + \
  2418                                                                               special[key] + '{VK_SHIFT up}'
  2419                                                                       elif key.isupper():
  2420                                                                           # if the key is uppercase
  2421                                                                           new += '{VK_SHIFT down}' + \
  2422                                                                               key.lower() + '{VK_SHIFT up}'
  2423                                                                       else:
  2424                                                                           # if the key is not a special character
  2425                                                                           new += key
  2426                                                                   return new
  2427                                           
  2428                                                               # types keys with a delay between each key
  2429                                                               def type_keys_with_delay(window, text, delay):
  2430                                                                   e = False
  2431                                                                   import time
  2432                                                                   for char in text:
  2433                                                                       try:
  2434                                                                           window.type_keys(char, with_spaces=True)
  2435                                                                       except:
  2436                                           
  2437                                                                           if not e:
  2438                                                                               window.set_focus()
  2439                                                                               e = True
  2440                                                                           pywinauto.keyboard.send_keys(char)
  2441                                                                       time.sleep(delay)
  2442                                           
  2443                                                               # parses object functions for discovering types
  2444                                                               # of elements
  2445                                                               def search(window):
  2446                                                                   ret = '<msnint2 no callable>'
  2447                                           
  2448                                                                   # RETRIEVING CHILDREN
  2449                                                                   # gets the available child reference keywords
  2450                                                                   if (chldrn := callables(window,
  2451                                                                                           'children', children,
  2452                                                                                           'print_children', print_children,
  2453                                                                                           'child', child,
  2454                                                                                           'find_children', find_children)) != '<msnint2 no callable>':
  2455                                                                       ret = chldrn
  2456                                           
  2457                                                                   # working with the entire child tree
  2458                                                                   elif (all_chldrn := callables(window,
  2459                                                                                                 'all_children', all_children,
  2460                                                                                                 'print_all_children', print_all_children,
  2461                                                                                                 'all_child', all_child,
  2462                                                                                                 'find_all_children', find_all_children,
  2463                                                                                                 'find_all_children_exact', find_all_children_exact,
  2464                                                                                                 objfunc6='wait_for_child', objfunc6_method=wait_for_type_exact_all,
  2465                                                                                                 type1=pywinauto.controls.uiawrapper.UIAWrapper,
  2466                                                                                                 as_type1=self.AppElement,
  2467                                                                                                 objfunc7='wait_for_child_exact', objfunc7_method=wait_for_type_subtext_all,
  2468                                                                                                 type2=pywinauto.controls.uiawrapper.UIAWrapper,
  2469                                                                                                 as_type2=self.AppElement
  2470                                           
  2471                                                                                                 )) != '<msnint2 no callable>':
  2472                                                                       ret = all_chldrn
  2473                                           
  2474                                                                   # getting all menus
  2475                                                                   elif (mns := callables(window,
  2476                                                                                          'menus', menus,
  2477                                                                                          'print_menus', print_menus,
  2478                                                                                          'menu', menu,
  2479                                                                                          'find_menus', find_menus,
  2480                                                                                          objfunc5=None, objfunc5_method=None,
  2481                                                                                          objfunc6='wait_for_menu_exact', objfunc6_method=wait_for_type_exact_all,
  2482                                                                                          type1=pywinauto.controls.uia_controls.MenuWrapper,
  2483                                                                                          as_type1=self.Menu,
  2484                                                                                          objfunc7='wait_for_menu', objfunc7_method=wait_for_type_subtext_all,
  2485                                                                                          type2=pywinauto.controls.uia_controls.MenuWrapper,
  2486                                                                                          as_type2=self.Menu
  2487                                                                                          )) != '<msnint2 no callable>':
  2488                                                                       ret = mns
  2489                                           
  2490                                                                   # gets all toolbars
  2491                                                                   elif (tbrs := callables(window,
  2492                                                                                           'toolbars', toolbars,
  2493                                                                                           'print_toolbars', print_toolbars,
  2494                                                                                           'toolbar', toolbar,
  2495                                                                                           'find_toolbars', find_toolbars,
  2496                                                                                           objfunc5=None, objfunc5_method=None,
  2497                                                                                           objfunc6='wait_for_toolbar_exact', objfunc6_method=wait_for_type_exact_all,
  2498                                                                                           type1=pywinauto.controls.uia_controls.ToolbarWrapper,
  2499                                                                                           as_type1=self.ToolBar,
  2500                                                                                           objfunc7='wait_for_toolbar', objfunc7_method=wait_for_type_subtext_all,
  2501                                                                                           type2=pywinauto.controls.uia_controls.ToolbarWrapper,
  2502                                                                                           as_type2=self.ToolBar
  2503                                                                                           )) != '<msnint2 no callable>':
  2504                                                                       ret = tbrs
  2505                                           
  2506                                                                   # gets all buttons
  2507                                                                   elif (btns := callables(window,
  2508                                                                                           'buttons', buttons,
  2509                                                                                           'print_buttons', print_buttons,
  2510                                                                                           'button', button,
  2511                                                                                           'find_buttons', find_buttons,
  2512                                                                                           objfunc5=None, objfunc5_method=None,
  2513                                                                                           objfunc6='wait_for_button_exact', objfunc6_method=wait_for_type_exact_all,
  2514                                                                                           type1=pywinauto.controls.uia_controls.ButtonWrapper,
  2515                                                                                           as_type1=self.Button,
  2516                                                                                           objfunc7='wait_for_button', objfunc7_method=wait_for_type_subtext_all,
  2517                                                                                           type2=pywinauto.controls.uia_controls.ButtonWrapper,
  2518                                                                                           as_type2=self.Button
  2519                                                                                           )) != '<msnint2 no callable>':
  2520                                                                       ret = btns
  2521                                           
  2522                                                                   # gets all tabitems
  2523                                                                   elif (tbs := callables(window,
  2524                                                                                          'tabitems', tabitems,
  2525                                                                                          'print_tabitems', print_tabitems,
  2526                                                                                          'tabitem', tabitem,
  2527                                                                                          'find_tabitems', find_tabitems,
  2528                                                                                          objfunc5=None, objfunc5_method=None,
  2529                                                                                          objfunc6='wait_for_tabitem_exact', objfunc6_method=wait_for_type_exact_all,
  2530                                                                                          type1=int,
  2531                                                                                          as_type1=self.TabItem,
  2532                                                                                          objfunc7='wait_for_tabitem', objfunc7_method=wait_for_type_subtext_all,
  2533                                                                                          type2=int,
  2534                                                                                          as_type2=self.TabItem
  2535                                                                                          )) != '<msnint2 no callable>':
  2536                                                                       ret = tbs
  2537                                           
  2538                                                                   # gets all links
  2539                                                                   elif (lnks := callables(window,
  2540                                                                                           'links', links,
  2541                                                                                           'print_links', print_links,
  2542                                                                                           'link', link,
  2543                                                                                           'find_links', find_links,
  2544                                                                                           objfunc5=None, objfunc5_method=None,
  2545                                                                                           objfunc6='wait_for_link_exact', objfunc6_method=wait_for_type_exact_all,
  2546                                                                                           type1=int,
  2547                                                                                           as_type1=self.Hyperlink,
  2548                                                                                           objfunc7='wait_for_link', objfunc7_method=wait_for_type_subtext_all,
  2549                                                                                           type2=int,
  2550                                                                                           as_type2=self.Hyperlink
  2551                                                                                           )) != '<msnint2 no callable>':
  2552                                                                       ret = lnks
  2553                                           
  2554                                                                   # gets all Inputs
  2555                                                                   elif (inpts := callables(window,
  2556                                                                                            'inputs', inputs,
  2557                                                                                            'print_inputs', print_inputs,
  2558                                                                                            'input', input,
  2559                                                                                            'find_inputs', find_inputs,
  2560                                                                                            objfunc6='wait_for_input_exact', objfunc6_method=wait_for_type_exact_all,
  2561                                                                                            type1=pywinauto.controls.uia_controls.EditWrapper,
  2562                                                                                            as_type1=self.Input,
  2563                                                                                            objfunc7='wait_for_input', objfunc7_method=wait_for_type_subtext_all,
  2564                                                                                            type2=pywinauto.controls.uia_controls.EditWrapper,
  2565                                                                                            as_type2=self.Input
  2566                                                                                            )) != '<msnint2 no callable>':
  2567                                                                       ret = inpts
  2568                                           
  2569                                                                   # gets all checkboxes
  2570                                                                   elif (chks := callables(window,
  2571                                                                                           'checkboxes', checkboxes,
  2572                                                                                           'print_checkboxes', print_checkboxes,
  2573                                                                                           'checkbox', checkbox,
  2574                                                                                           'find_checkboxes', find_checkboxes,
  2575                                                                                           objfunc6='wait_for_checkbox_exact', objfunc6_method=wait_for_type_exact_all,
  2576                                                                                           type1=pywinauto.controls.uia_controls.ButtonWrapper,
  2577                                                                                           as_type1=self.Button,
  2578                                                                                           objfunc7='wait_for_checkbox', objfunc7_method=wait_for_type_subtext_all,
  2579                                                                                           type2=pywinauto.controls.uia_controls.ButtonWrapper,
  2580                                                                                           as_type2=self.Button
  2581                                                                                           )) != '<msnint2 no callable>':
  2582                                                                       ret = chks
  2583                                           
  2584                                                                   # gets all images
  2585                                                                   elif (imgs := callables(window,
  2586                                                                                           'images', images,
  2587                                                                                           'print_images', print_images,
  2588                                                                                           'image', image,
  2589                                                                                           'find_images', find_images)) != '<msnint2 no callable>':
  2590                                                                       ret = imgs
  2591                                           
  2592                                                                   # gets all tables
  2593                                                                   elif (tbls := callables(window,
  2594                                                                                           'tables', tables,
  2595                                                                                           'print_tables', print_tables,
  2596                                                                                           'table', table,
  2597                                                                                           'find_tables', find_tables,
  2598                                                                                           objfunc6='wait_for_table_exact', objfunc6_method=wait_for_type_exact_all,
  2599                                                                                           type1=pywinauto.controls.uia_controls.ListViewWrapper,
  2600                                                                                           as_type1=self.Table,
  2601                                                                                           objfunc7='wait_for_table', objfunc7_method=wait_for_type_subtext_all,
  2602                                                                                           type2=pywinauto.controls.uia_controls.ListViewWrapper,
  2603                                                                                           as_type2=self.Table
  2604                                                                                           )) != '<msnint2 no callable>':
  2605                                                                       ret = tbls
  2606                                           
  2607                                                                   # get all GroupBoxes
  2608                                                                   elif (grps := callables(window,
  2609                                                                                           'groupboxes', groupboxes,
  2610                                                                                           'print_groupboxes', print_groupboxes,
  2611                                                                                           'groupbox', groupbox,
  2612                                                                                           'find_groupboxes', find_groupboxes,
  2613                                                                                           objfunc6='wait_for_groupbox_exact', objfunc6_method=wait_for_type_exact_all,
  2614                                                                                           type1=int,
  2615                                                                                           as_type1=self.AppElement,
  2616                                                                                           objfunc7='wait_for_groupbox', objfunc7_method=wait_for_type_subtext_all,
  2617                                                                                           type2=int,
  2618                                                                                           as_type2=self.AppElement
  2619                                                                                           )) != '<msnint2 no callable>':
  2620                                                                       ret = grps
  2621                                           
  2622                                                                   # for Panes
  2623                                                                   elif (pns := callables(window,
  2624                                                                                          'panes', panes,
  2625                                                                                          'print_panes', print_panes,
  2626                                                                                          'pane', pane,
  2627                                                                                          'find_panes', find_panes,
  2628                                                                                          objfunc6='wait_for_pane_exact', objfunc6_method=wait_for_type_exact_all,
  2629                                                                                          type1=int,
  2630                                                                                          as_type1=self.AppElement,
  2631                                                                                          objfunc7='wait_for_pane', objfunc7_method=wait_for_type_subtext_all,
  2632                                                                                          type2=int,
  2633                                                                                          as_type2=self.AppElement
  2634                                                                                          )) != '<msnint2 no callable>':
  2635                                                                       ret = pns
  2636                                           
  2637                                                                   # for ListItems
  2638                                                                   elif (lsts := callables(window,
  2639                                                                                           'listitems', listitems,
  2640                                                                                           'print_listitems', print_listitems,
  2641                                                                                           'listitem', listitem,
  2642                                                                                           'find_listitems', find_listitems,
  2643                                                                                           objfunc6='wait_for_listitem_exact', objfunc6_method=wait_for_type_exact_all,
  2644                                                                                           type1=pywinauto.controls.uia_controls.ListItemWrapper,
  2645                                                                                           as_type1=self.AppElement,
  2646                                                                                           objfunc7='wait_for_listitem', objfunc7_method=wait_for_type_subtext_all,
  2647                                                                                           type2=pywinauto.controls.uia_controls.ListItemWrapper,
  2648                                                                                           as_type2=self.AppElement
  2649                                                                                           )) != '<msnint2 no callable>':
  2650                                                                       ret = lsts
  2651                                           
  2652                                                                   # for TabControls
  2653                                                                   elif (tabs := callables(window,
  2654                                                                                           'tabcontrols', tabcontrols,
  2655                                                                                           'print_tabcontrols', print_tabcontrols,
  2656                                                                                           'tabcontrol', tabcontrol,
  2657                                                                                           'find_tabcontrols', find_tabcontrols,
  2658                                                                                           objfunc6='wait_for_tabcontrol_exact', objfunc6_method=wait_for_type_exact_all,
  2659                                                                                           type1=int,
  2660                                                                                           as_type1=self.AppElement,
  2661                                                                                           objfunc7='wait_for_tabcontrol', objfunc7_method=wait_for_type_subtext_all,
  2662                                                                                           type2=int,
  2663                                                                                           as_type2=self.AppElement
  2664                                                                                           )) != '<msnint2 no callable>':
  2665                                                                       ret = tabs
  2666                                           
  2667                                                                   # for Documents
  2668                                                                   elif (docs := callables(window,
  2669                                                                                           'documents', documents,
  2670                                                                                           'print_documents', print_documents,
  2671                                                                                           'document', document,
  2672                                                                                           'find_documents', find_documents,
  2673                                                                                           objfunc6='wait_for_document_exact', objfunc6_method=wait_for_type_exact_all,
  2674                                                                                           type1=int,
  2675                                                                                           as_type1=self.AppElement,
  2676                                                                                           objfunc7='wait_for_document', objfunc7_method=wait_for_type_subtext_all,
  2677                                                                                           type2=int,
  2678                                                                                           as_type2=self.AppElement
  2679                                                                                           )) != '<msnint2 no callable>':
  2680                                                                       ret = docs
  2681                                           
  2682                                                                   return ret
  2683                                           
  2684                                                               # if the object is a pywinauto application
  2685                                                               # KNOWN ISSUES:
  2686                                                               #   - I've tested this on a Windows 11 laptop and it doesn't
  2687                                                               #     work for some reason
  2688                                                               if isinstance(object, self.App):
  2689                                                                   # return for an app
  2690                                                                   ret = object
  2691                                           
  2692                                                                   # path to the application to work with
  2693                                                                   path = object.path
  2694                                                                   # actual pwinauto application object
  2695                                                                   app = object.application
  2696                                                                   # window
  2697                                                                   window = app.window() if app else None
  2698                                           
  2699                                                                   # thread based operation
  2700                                                                   p_thread = False
  2701                                                                   if objfunc.endswith(':lock'):
  2702                                                                       p_thread = True
  2703                                                                       objfunc = objfunc[:-5]
  2704                                                                       auto_lock.acquire()
  2705                                           
  2706                                                                   # element discovery with search()
  2707                                                                   if (srch := search(window)) != '<msnint2 no callable>':
  2708                                                                       ret = srch
  2709                                           
  2710                                                                   # STARTING AND STOPPING APPLICATIONS
  2711                                                                   if objfunc == 'start':
  2712                                                                       from pywinauto.application import Application
  2713                                                                       # create and start the application
  2714                                                                       if not object.application:
  2715                                                                           object.application = Application(
  2716                                                                               backend="uia").start(path)
  2717                                           
  2718                                                                       # add to global apps
  2719                                                                       global apps
  2720                                                                       apps[len(apps) + 1] = object
  2721                                           
  2722                                                                       ret = object.application
  2723                                                                   # kills the application
  2724                                                                   elif objfunc == 'stop' or objfunc == 'kill' or objfunc == 'close':
  2725                                                                       # kill the application
  2726                                                                       ret = app.kill()
  2727                                           
  2728                                                                   # gets the top_window
  2729                                                                   elif objfunc == 'print_tree':
  2730                                                                       ret = app.dump_tree()
  2731                                           
  2732                                                                   # gets a connection to this application
  2733                                                                   elif objfunc == 'connection':
  2734                                                                       from pywinauto.application import Application
  2735                                                                       ret = self.App(object.path, Application(
  2736                                                                           backend="uia").connect(process=object.application.process))
  2737                                           
  2738                                                                   # gets information about this application
  2739                                                                   # gets the text of the window
  2740                                                                   elif objfunc == 'text':
  2741                                                                       ret = window.window_text()
  2742                                                                   # gets the window
  2743                                                                   elif objfunc == 'window':
  2744                                                                       ret = window
  2745                                                                   # gets the handle
  2746                                                                   elif objfunc == 'handle':
  2747                                                                       ret = window.handle
  2748                                           
  2749                                                                   # chrome based children collection
  2750                                                                   def chrome_children_():
  2751                                                                       chrome_window = app.window(title_re='.*Chrome.')
  2752                                                                       chrome_handle = chrome_window.handle
  2753                                                                       wd = app.window(handle=chrome_handle)
  2754                                                                       document = wd.child_window(
  2755                                                                           found_index=0, class_name='Chrome_RenderWidgetHostHWND')
  2756                                                                       return document.descendants()
  2757                                           
  2758                                                                   # GOOGLE CHROME ONLY
  2759                                                                   if objfunc == 'chrome_children':
  2760                                                                       # if not arguments
  2761                                                                       if args[0][0] == '':
  2762                                                                           ret = chrome_children_()
  2763                                                                       # if one argument, check if the first argument is contained
  2764                                                                       elif len(args) == 1:
  2765                                                                           subtext = self.parse(0, line, f, sp, args)[
  2766                                                                               2].lower()
  2767                                                                           ret = [self.AppElement(d, d.window_text()) for d in chrome_children_(
  2768                                                                           ) if subtext in d.window_text().lower()]
  2769                                                                       # if two arguments, check if the first argument is exact
  2770                                                                       elif len(args) == 2:
  2771                                                                           subtext = self.parse(0, line, f, sp, args)[2]
  2772                                                                           ret = [self.AppElement(d, d.window_text()) for d in chrome_children_(
  2773                                                                           ) if subtext == d.window_text()]
  2774                                           
  2775                                                                   # waits for a child containing text
  2776                                                                   elif objfunc == 'wait_for_text':
  2777                                                                       # if no timeout provided
  2778                                                                       if len(args) == 1:
  2779                                                                           ret = wait_for_text(
  2780                                                                               window, self.parse(0, line, f, sp, args)[2])
  2781                                                                       # if timeout provided
  2782                                                                       elif len(args) == 2:
  2783                                                                           ret = wait_for_text(window, self.parse(0, line, f, sp, args)[2],
  2784                                                                                               timeout=self.parse(1, line, f, sp, args)[2])
  2785                                                                   # waits for a child containing text in the entire child tree
  2786                                                                   elif objfunc == 'wait_for_text_all':
  2787                                                                       # if no timeout provided
  2788                                                                       if len(args) == 1:
  2789                                                                           ret = wait_for_text_all(
  2790                                                                               window, self.parse(0, line, f, sp, args)[2])
  2791                                                                       elif len(args) == 2:
  2792                                                                           ret = wait_for_text_all(window, self.parse(0, line, f, sp, args)[2],
  2793                                                                                                   timeout=self.parse(1, line, f, sp, args)[2])
  2794                                           
  2795                                                                   # waits for a child containing the exact text
  2796                                                                   elif objfunc == 'wait_for_text_exact':
  2797                                                                       # if no timeout provided
  2798                                                                       if len(args) == 1:
  2799                                                                           ret = wait_for_text_exact(
  2800                                                                               window, self.parse(0, line, f, sp, args)[2])
  2801                                                                       elif len(args) == 2:
  2802                                                                           ret = wait_for_text_exact(window, self.parse(0, line, f, sp, args)[2],
  2803                                                                                                     timeout=self.parse(1, line, f, sp, args)[2])
  2804                                                                   # waits for a child containing the exact text in the entire child tree
  2805                                                                   elif objfunc == 'wait_for_text_exact_all':
  2806                                                                       # if no timeout provided
  2807                                                                       if len(args) == 1:
  2808                                                                           ret = wait_for_text_exact_all(
  2809                                                                               window, self.parse(0, line, f, sp, args)[2])
  2810                                                                       elif len(args) == 2:
  2811                                                                           ret = wait_for_text_exact_all(window, self.parse(0, line, f, sp, args)[2],
  2812                                                                                                         timeout=self.parse(1, line, f, sp, args)[2])
  2813                                           
  2814                                                                   # APPLICATION ACTIONS
  2815                                                                   # sends keystrokes to the application
  2816                                                                   # takes one argument, being the keystrokes to send
  2817                                                                   elif objfunc == 'write':
  2818                                                                       writing = self.parse(0, line, f, sp, args)[2]
  2819                                                                       try:
  2820                                                                           # sends keystrokes to the application
  2821                                                                           ret = window.type_keys(
  2822                                                                               writing, with_spaces=True)
  2823                                                                       except:
  2824                                                                           # with_spaces not allowed
  2825                                                                           ret = window.type_keys(
  2826                                                                               convert_keys(writing), with_spaces=True)
  2827                                                                   # writes special characters into the console
  2828                                                                   # takes one argument, being the special characters to write
  2829                                                                   elif objfunc == 'write_special':
  2830                                                                       # keystrokes
  2831                                                                       keystrokes = self.parse(0, line, f, sp, args)[2]
  2832                                                                       # convert to special characters
  2833                                                                       ret = window.type_keys(convert_keys(
  2834                                                                           keystrokes), with_spaces=True)
  2835                                           
  2836                                                                   # presses keys at the same time
  2837                                                                   elif objfunc == 'press':
  2838                                                                       kys = []
  2839                                                                       for i in range(len(args)):
  2840                                                                           kys.append(self.parse(i, line, f, sp, args)[2])
  2841                                                                       # presses the keys at the same time
  2842                                                                       ret = window.type_keys(press_simul(kys))
  2843                                                                   # sends keystrokes to the application
  2844                                                                   # takes one argument, being the keystrokes to send
  2845                                                                   elif objfunc == 'send_keys':
  2846                                           
  2847                                                                       # import pywinauto.keyboard
  2848                                                                       import pywinauto
  2849                                           
  2850                                                                       # sends keystrokes to the application
  2851                                                                       ret = pywinauto.keyboard.send_keys(convert_keys(
  2852                                                                           self.parse(0, line, f, sp, args)[2]), with_spaces=True)
  2853                                           
  2854                                                                   # gets the element that is currently hovered over
  2855                                                                   # recurses through all children, determining which elements have
  2856                                                                   # the mouses position
  2857                                                                   elif objfunc == 'hovered':
  2858                                                                       # import win32api
  2859                                                                       import win32api
  2860                                           
  2861                                                                       # get the root window of this application
  2862                                                                       root = window.top_level_parent()
  2863                                           
  2864                                                                       # get the current mouse position
  2865                                                                       x, y = win32api.GetCursorPos()
  2866                                           
  2867                                                                       # recursively find all children from the root window
  2868                                                                       # that have the point specified
  2869                                                                       ret = get_all(root, x, y)
  2870                                           
  2871                                                                   # opens the developer tools
  2872                                                                   elif objfunc == 'inspect':
  2873                                                                       # presses the shortcut keys to open the developer tools
  2874                                                                       ret = window.type_keys('{F12}')
  2875                                           
  2876                                                                       # waits for the inspect window to appear
  2877                                                                       wait_for_text_all(window, 'Console')
  2878                                           
  2879                                                                   # closes the developer tools
  2880                                                                   elif objfunc == 'close_inspect':
  2881                                                                       # presses the shortcut keys to close the developer tools
  2882                                                                       ret = window.type_keys('{F12}')
  2883                                           
  2884                                                                   # refreshes the page
  2885                                                                   elif objfunc == 'refresh':
  2886                                                                       # presses the shortcut keys to refresh the page
  2887                                                                       ret = window.type_keys('{F5}')
  2888                                           
  2889                                                                   # presses the enter key
  2890                                                                   elif objfunc == 'enter':
  2891                                                                       # presses the enter key
  2892                                                                       ret = window.type_keys('{ENTER}')
  2893                                                                   # presses the escape key
  2894                                                                   elif objfunc == 'escape':
  2895                                                                       # presses the escape key
  2896                                                                       ret = window.type_keys('{ESC}')
  2897                                                                   # page down
  2898                                                                   elif objfunc == 'page_down':
  2899                                                                       # presses the page down key
  2900                                                                       ret = window.type_keys('{PGDN}')
  2901                                                                   # page up
  2902                                                                   elif objfunc == 'page_up':
  2903                                                                       # presses the page up key
  2904                                                                       ret = window.type_keys('{PGUP}')
  2905                                           
  2906                                                                   # # collects all children within the entire page
  2907                                                                   # # finds all scrollbars and scrolls throughout the entire page
  2908                                                                   # # in all directions, collecting all children
  2909                                                                   # if objfunc == 'collect_children':
  2910                                                                   #     chld = set()
  2911                                                                   #     # gets all scrollbars
  2912                                                                   #     scrlbrs = window.scrollbars()
  2913                                                                   #     # get the height of the screen
  2914                                                                   #     height = window.rectangle().height
  2915                                           
  2916                                                                   #     return scrlbrs
  2917                                           
  2918                                                                   # # gets the vertical scrollbar
  2919                                                                   # if objfunc == 'vertical_scrollbar':
  2920                                                                   #     wd = window.child_window(control_type="Scroll")
  2921                                                                   #     return self.ScrollBar(wd, 'vertical')
  2922                                           
  2923                                                                   # release auto_lock
  2924                                                                   if p_thread:
  2925                                                                       auto_lock.release()
  2926                                           
  2927                                                                   # return the object
  2928                                                                   return ret
  2929                                           
  2930                                                               # if the object is a pywinauto window element
  2931                                                               elif isinstance(object, self.AppElement):
  2932                                                                   # returning
  2933                                                                   ret = object
  2934                                                                   # get the window of the AppElement object
  2935                                                                   window = object.window
  2936                                                                   # get the text of the AppElement object
  2937                                                                   name = object.name
  2938                                           
  2939                                                                   # function to move the mouse from start to end,
  2940                                                                   # with a speed of speed
  2941                                                                   def movemouse(start, end, speed):
  2942                                                                       import time
  2943                                                                       from pywinauto import mouse
  2944                                                                       # reverse the speed, so a speed of 50 gives
  2945                                                                       # end_range of 50, and a speed of 75 gives
  2946                                                                       # end_range of 25
  2947                                                                       # dragging the mouse
  2948                                                                       # presses the mouse down at the coordinates
  2949                                                                       mouse.press(coords=start)
  2950                                                                       end_range = 100 - speed
  2951                                                                       for i in range(0, end_range):
  2952                                                                           mouse.move(coords=(int(start[0] + (end[0] - start[0]) / 100 * i),
  2953                                                                                              int(start[1] + (end[1] - start[1]) / 100 * i)))
  2954                                                                           time.sleep(0.001)
  2955                                           
  2956                                                                       # releases the mouse at the end coordinates
  2957                                                                       mouse.release(coords=end)
  2958                                           
  2959                                                                   p_thread = False
  2960                                           
  2961                                                                   # thread based functions
  2962                                                                   # if the function is a thread based function
  2963                                                                   if objfunc.endswith(':lock'):
  2964                                                                       p_thread = True
  2965                                                                       auto_lock.acquire()
  2966                                                                       objfunc = objfunc[:-5]
  2967                                           
  2968                                                                   # OBTAINING DIFFERENT TYPES OF CHILDREN
  2969                                                                   # get the element window
  2970                                                                   if objfunc == 'window':
  2971                                                                       ret = window
  2972                                           
  2973                                                                   # element discovery with search()
  2974                                                                   if (srch := search(window)) != '<msnint2 no callable>':
  2975                                                                       ret = srch
  2976                                           
  2977                                                                   # getting information about the current window
  2978                                                                   # gets the window text
  2979                                                                   elif objfunc == 'text':
  2980                                                                       ret = window.window_text()
  2981                                                                   # GETTING LOCATION OF THE WINDOW
  2982                                                                   elif objfunc == 'top':
  2983                                                                       ret = window.get_properties()['rectangle'].top
  2984                                                                   elif objfunc == 'bottom':
  2985                                                                       ret = window.get_properties()['rectangle'].bottom
  2986                                                                   elif objfunc == 'left':
  2987                                                                       ret = window.get_properties()['rectangle'].left
  2988                                                                   elif objfunc == 'right':
  2989                                                                       ret = window.get_properties()['rectangle'].right
  2990                                                                   elif objfunc == 'center' or objfunc == 'mid_point':
  2991                                                                       ret = window.get_properties(
  2992                                                                       )['rectangle'].mid_point()
  2993                                                                   # getting the rectangle overall
  2994                                                                   elif objfunc == 'rectangle':
  2995                                                                       ret = [window.get_properties()['rectangle'].top, window.get_properties()[
  2996                                                                           'rectangle'].bottom, window.get_properties()['rectangle'].left, window.get_properties()['rectangle'].right]
  2997                                           
  2998                                                                   # computes the diameter of the window
  2999                                                                   elif objfunc == 'width':
  3000                                                                       try:
  3001                                                                           left = window.get_properties()[
  3002                                                                               'rectangle'].left
  3003                                                                           right = window.get_properties()[
  3004                                                                               'rectangle'].right
  3005                                                                           ret = right - left
  3006                                                                       except:
  3007                                                                           ret = None
  3008                                                                   # computes the height of the window
  3009                                                                   elif objfunc == 'height':
  3010                                                                       try:
  3011                                                                           top = window.get_properties()['rectangle'].top
  3012                                                                           bottom = window.get_properties()[
  3013                                                                               'rectangle'].bottom
  3014                                                                           ret = bottom - top
  3015                                                                       except:
  3016                                                                           ret = None
  3017                                           
  3018                                                                   # getting adjacent elements
  3019                                                                   # could or could not be decendants
  3020                                                                   # operation is very slow, should be used mainly
  3021                                                                   # for element discovery
  3022                                                                   elif objfunc == 'element_above':
  3023                                                                       from pywinauto import mouse
  3024                                                                       # pixels above
  3025                                                                       pixels = self.parse(0, line, f, sp, args)[2]
  3026                                                                       # get the root window of this application
  3027                                                                       root = object.top_level_parent()
  3028                                           
  3029                                                                       # get the top middle point of this element
  3030                                                                       top = object.get_properties(
  3031                                                                       )['rectangle'].top - pixels
  3032                                                                       mid = object.get_properties(
  3033                                                                       )['rectangle'].mid_point()[0]
  3034                                                                       # if there exist two arguments, move the mouse to that location
  3035                                                                       if len(args) == 2:
  3036                                                                           mouse.move(coords=(mid, top))
  3037                                                                       # recursively find all children from the root window
  3038                                                                       # that have the point specified
  3039                                                                       ret = rec(root, mid, top)
  3040                                                                   elif objfunc == 'element_below':
  3041                                                                       from pywinauto import mouse
  3042                                                                       # pixels above
  3043                                                                       pixels = self.parse(0, line, f, sp, args)[2]
  3044                                                                       # get the root window of this application
  3045                                                                       root = object.top_level_parent()
  3046                                                                       # get the top middle point of this element
  3047                                                                       bottom = object.get_properties(
  3048                                                                       )['rectangle'].bottom + pixels
  3049                                                                       mid = object.get_properties(
  3050                                                                       )['rectangle'].mid_point()[0]
  3051                                                                       if len(args) == 2:
  3052                                                                           mouse.move(coords=(mid, bottom))
  3053                                                                       # recursively find all children from the root window
  3054                                                                       # that have the point specified
  3055                                                                       ret = rec(root, mid, bottom)
  3056                                                                   elif objfunc == 'element_left':
  3057                                                                       from pywinauto import mouse
  3058                                                                       # pixels to the left
  3059                                                                       pixels = self.parse(0, line, f, sp, args)[2]
  3060                                                                       # get the root window of this application
  3061                                                                       root = object.top_level_parent()
  3062                                           
  3063                                                                       # get the left middle point of this element
  3064                                                                       left = object.get_properties(
  3065                                                                       )['rectangle'].left - pixels
  3066                                                                       mid = object.get_properties(
  3067                                                                       )['rectangle'].mid_point()[1]
  3068                                                                       if len(args) == 2:
  3069                                                                           mouse.move(coords=(left, mid))
  3070                                                                       # recursively find all children from the root window
  3071                                                                       # that have the point specified
  3072                                                                       ret = rec(root, left, mid)
  3073                                                                   elif objfunc == 'element_right':
  3074                                                                       from pywinauto import mouse
  3075                                                                       # pixels to the right
  3076                                                                       pixels = self.parse(0, line, f, sp, args)[2]
  3077                                                                       # get the root window of this application
  3078                                                                       root = object.top_level_parent()
  3079                                           
  3080                                                                       # get the right middle point of this element
  3081                                                                       right = object.get_properties(
  3082                                                                       )['rectangle'].right + pixels
  3083                                                                       mid = object.get_properties(
  3084                                                                       )['rectangle'].mid_point()[1]
  3085                                                                       if len(args) == 2:
  3086                                                                           mouse.move(coords=(right, mid))
  3087                                                                       # recursively find all children from the root window
  3088                                                                       # that have the point specified
  3089                                                                       ret = rec(root, right, mid)
  3090                                           
  3091                                                                   # focus on the window
  3092                                                                   elif objfunc == 'focus':
  3093                                                                       ret = window.set_focus()
  3094                                           
  3095                                                                   # scrolls to the window
  3096                                                                   elif objfunc == 'scroll':
  3097                                                                       from pywinauto import mouse
  3098                                                                       ret = mouse.scroll(coords=(window.get_properties()['rectangle'].mid_point()[0],
  3099                                                                                                  window.get_properties()['rectangle'].mid_point()[1]))
  3100                                           
  3101                                                                   # drags this element to either another AppElement
  3102                                                                   elif objfunc == 'drag':
  3103                                                                       # if one argument and that argument isinstance(AppElement)
  3104                                                                       first = self.parse(0, line, f, sp, args)[2]
  3105                                                                       # midpoint of the element to drag to
  3106                                                                       start = (window.get_properties()['rectangle'].mid_point()[0],
  3107                                                                                window.get_properties()['rectangle'].mid_point()[1])
  3108                                                                       end = (first.get_properties()['rectangle'].mid_point()[0],
  3109                                                                              first.get_properties()['rectangle'].mid_point()[1])
  3110                                           
  3111                                                                       # slowly moves the mouse to the end coordinates
  3112                                                                       # this is to prevent the mouse from moving too fast
  3113                                                                       # and not dragging the object
  3114                                                                       # the farther the distance, the longer it takes
  3115                                                                       # to move the mouse
  3116                                                                       speed = 50
  3117                                                                       if len(args) == 2:
  3118                                                                           speed = self.parse(1, line, f, sp, args)[2]
  3119                                                                       # drags the mouse
  3120                                                                       movemouse(start, end, speed)
  3121                                                                       ret = True
  3122                                           
  3123                                                                   # drags this AppElement to coordinates
  3124                                                                   elif objfunc == 'drag_coords':
  3125                                           
  3126                                                                       start = (window.get_properties()['rectangle'].mid_point()[0],
  3127                                                                                window.get_properties()['rectangle'].mid_point()[1])
  3128                                                                       end = (self.parse(0, line, f, sp, args)[2],
  3129                                                                              self.parse(1, line, f, sp, args)[2])
  3130                                           
  3131                                                                       # gets the speed, if specified
  3132                                                                       speed = 50
  3133                                                                       if len(args) == 3:
  3134                                                                           speed = self.parse(2, line, f, sp, args)[2]
  3135                                                                       # drags the mouse
  3136                                                                       movemouse(start, end, speed)
  3137                                                                       ret = True
  3138                                           
  3139                                                                   # WINDOW ACTIONS
  3140                                                                   # sends keystrokes to the application
  3141                                                                   # takes one argument, being the keystrokes to send
  3142                                                                   elif objfunc == 'write':
  3143                                                                       writing = self.parse(0, line, f, sp, args)[2]
  3144                                                                       timeout = False
  3145                                                                       # if a timeout between keystrokes is offered
  3146                                                                       if len(args) == 2:
  3147                                                                           timeout = True
  3148                                           
  3149                                                                       if timeout:
  3150                                                                           ret = type_keys_with_delay(
  3151                                                                               window, writing, self.parse(1, line, f, sp, args)[2])
  3152                                                                       else:
  3153                                                                           try:
  3154                                                                               ret = window.type_keys(
  3155                                                                                   writing, with_spaces=True)
  3156                                                                           except:
  3157                                                                               window.set_focus()
  3158                                                                               ret = window.type_keys(writing)
  3159                                           
  3160                                                                   # presses backspace
  3161                                                                   # if no arguments, presses it one time
  3162                                                                   # else, presses it the first argument many times
  3163                                                                   if objfunc == 'backspace':
  3164                                                                       window.set_focus()
  3165                                                                       # no argument
  3166                                                                       if args[0][0] == '':
  3167                                                                           ret = window.type_keys('{BACKSPACE}')
  3168                                                                       # else, send {BACKSPACE} that many times
  3169                                                                       else:
  3170                                                                           times = self.parse(0, line, f, sp, args)[2]
  3171                                                                           ret = window.type_keys('{BACKSPACE}' * times)
  3172                                           
  3173                                                                   # presses the enter key
  3174                                                                   elif objfunc == 'enter':
  3175                                                                       ret = window.type_keys('{ENTER}')
  3176                                           
  3177                                                                   # hovers over the window
  3178                                                                   elif objfunc == 'hover':
  3179                                                                       from pywinauto import mouse
  3180                                                                       # hovers the mouse over the window, using the mid point of the element
  3181                                                                       ret = mouse.move(
  3182                                                                           coords=(window.get_properties()['rectangle'].mid_point()))
  3183                                           
  3184                                                                   # different types of AppElements
  3185                                                                   # if the appelement is a button
  3186                                                                   if isinstance(object, self.Button):
  3187                                           
  3188                                                                       # clicks the button
  3189                                                                       if objfunc == 'click' or objfunc == 'left_click':
  3190                                                                           ret = object.click()
  3191                                                                       # left clicks the button
  3192                                                                       elif objfunc == 'right_click':
  3193                                                                           ret = object.right_click()
  3194                                                                       ret = object
  3195                                           
  3196                                                                   # working with Links
  3197                                                                   elif isinstance(object, self.Link):
  3198                                                                       waittime = self.parse(0, line, f, sp, args)[
  3199                                                                           2] if args[0][0] != '' else 1
  3200                                                                       # clicks the link
  3201                                                                       if objfunc == 'click' or objfunc == 'left_click':
  3202                                                                           ret = clk(window, waittime=waittime)
  3203                                                                       # right clicks the link
  3204                                                                       elif objfunc == 'right_click':
  3205                                                                           ret = clk(window, button='right',
  3206                                                                                     waittime=waittime)
  3207                                                                       ret = object
  3208                                           
  3209                                                                   # working with Tables
  3210                                                                   elif isinstance(object, self.Table):
  3211                                                                       # get table
  3212                                                                       table = object.window
  3213                                           
  3214                                                                       # gets a row by index, based on the above logic
  3215                                                                       def row(index):
  3216                                                                           row = []
  3217                                                                           items = []
  3218                                                                           try:
  3219                                                                               cols = table.column_count()
  3220                                                                           except NotImplementedError:
  3221                                                                               # not implemented
  3222                                                                               cols = 5
  3223                                                                               items = table.items()
  3224                                                                           for i in range(cols):
  3225                                                                               try:
  3226                                                                                   try:
  3227                                                                                       wrapper = table.cell(
  3228                                                                                           row=index, column=i)
  3229                                                                                   except:
  3230                                                                                       # table.items() gets a 1D list of items,
  3231                                                                                       # compute the index of the item
  3232                                                                                       # based on 'i' and 'index'
  3233                                                                                       wrapper = items[i + index * cols]
  3234                                           
  3235                                                                                   row.append(self.AppElement(
  3236                                                                                       wrapper, wrapper.window_text()))
  3237                                                                               except:
  3238                                                                                   break
  3239                                                                           return row
  3240                                                                       # gets a column by index
  3241                                           
  3242                                                                       def col(index):
  3243                                                                           col = []
  3244                                                                           for i in range(table.column_count()):
  3245                                                                               try:
  3246                                                                                   wrapper = table.cell(
  3247                                                                                       row=i, column=index)
  3248                                                                                   col.append(self.AppElement(
  3249                                                                                       wrapper, wrapper.window_text()))
  3250                                                                               except:
  3251                                                                                   break
  3252                                                                           return col
  3253                                           
  3254                                                                       # gets a cell at a row and column
  3255                                                                       if objfunc == 'get':
  3256                                           
  3257                                                                           # get column
  3258                                                                           col = self.parse(0, line, f, sp, args)[2]
  3259                                                                           # get row
  3260                                                                           row = self.parse(1, line, f, sp, args)[2]
  3261                                                                           wrapper = table.cell(row=row, column=col)
  3262                                                                           # gets the cell
  3263                                                                           ret = self.AppElement(
  3264                                                                               wrapper, wrapper.window_text())
  3265                                           
  3266                                                                       # try to accumulate all the rows
  3267                                                                       # up to sys.maxsize
  3268                                                                       elif objfunc == 'matrix':
  3269                                                                           import sys
  3270                                                                           matrix = []
  3271                                                                           for i in range(sys.maxsize):
  3272                                                                               try:
  3273                                                                                   if (_r := row(i)):
  3274                                                                                       matrix.append(_r)
  3275                                                                                   else:
  3276                                                                                       break
  3277                                                                               except:
  3278                                                                                   break
  3279                                                                           ret = matrix
  3280                                                                       # gets a row
  3281                                                                       elif objfunc == 'row':
  3282                                                                           ret = row(self.parse(0, line, f, sp, args)[2])
  3283                                                                       # gets a column
  3284                                                                       elif objfunc == 'column':
  3285                                                                           ret = col(self.parse(0, line, f, sp, args)[2])
  3286                                           
  3287                                                                   # working with ToolBars
  3288                                                                   elif isinstance(object, self.ToolBar):
  3289                                                                       toolbar_window = object.window
  3290                                                                       # gets the buttons of the toolbar
  3291                                                                       if objfunc == 'buttons':
  3292                                                                           ret = [toolbar_window.button(i) for i in range(
  3293                                                                               toolbar_window.button_count())]
  3294                                                                       # prints the buttons of this toolbar
  3295                                                                       if objfunc == 'print_buttons':
  3296                                                                           for i in range(toolbar_window.button_count()):
  3297                                                                               print(i, ':', toolbar_window.button(i))
  3298                                                                           ret = None
  3299                                                                       # gets a button at an index
  3300                                                                       if objfunc == 'button':
  3301                                                                           ret = toolbar_window.button(
  3302                                                                               self.parse(0, line, f, sp, args)[2])
  3303                                                                       # finds all buttons with subtext in their names
  3304                                                                       if objfunc == 'find_buttons':
  3305                                                                           ret = find_buttons(
  3306                                                                               toolbar_window, self.parse(0, line, f, sp, args)[2])
  3307                                                                       ret = object
  3308                                           
  3309                                                                   # working with scrollbars
  3310                                                                   elif isinstance(object, self.ScrollBar):
  3311                                                                       scrollbar_window = object.window
  3312                                           
  3313                                                                       if objfunc == 'scroll_down':
  3314                                                                           ret = scrollbar_window.scroll_down(
  3315                                                                               amount='page', count=1)
  3316                                           
  3317                                                                   # extra methods such that this AppElement requires different logic
  3318                                                                   if objfunc == 'click' or objfunc == 'left_click':
  3319                                                                       ret = clk(window, waittime=self.parse(
  3320                                                                           0, line, f, sp, args)[2] if args[0][0] != '' else 1)
  3321                                                                   elif objfunc == 'right_click':
  3322                                                                       ret = clk(window, button='right', waittime=self.parse(
  3323                                                                           0, line, f, sp, args)[2] if args[0][0] != '' else 1)
  3324                                           
  3325                                                                   # if thread based, release the lock
  3326                                                                   if p_thread:
  3327                                                                       auto_lock.release()
  3328                                           
  3329                                                                   return ret
  3330                                           
  3331                                                               # if the object is a dictionary
  3332                                                               elif isinstance(object, dict):
  3333                                           
  3334                                                                   # allows for repetitive setting on a multiple indexed dictionary
  3335                                                                   if objfunc == 'set':
  3336                                                                       self.vars[vname].value[self.parse(0, line, f, sp, args)[
  3337                                                                           2]] = self.parse(1, line, f, sp, args)[2]
  3338                                                                       return self.vars[vname].value
  3339                                           
  3340                                                                   # first argument is what to set, should be called to_set
  3341                                                                   # rest of the arguments are the indices at which to index the object and set to_set
  3342                                                                   if objfunc == 'setn':
  3343                                           
  3344                                                                       # what to set
  3345                                                                       to_set = self.parse(0, line, f, sp, args)[2]
  3346                                           
  3347                                                                       # the rest of the arguments are the indices
  3348                                                                       # example: dict.setn('im being set', 'index1', 'index2', 'index3', ...)
  3349                                                                       # should equal: dict['index1']['index2']['index3'] = 'im being set'
  3350                                           
  3351                                                                       # the object to set
  3352                                                                       obj = self.vars[vname].value
  3353                                           
  3354                                                                       # iterates through the indices
  3355                                                                       for i in range(1, len(args)):
  3356                                           
  3357                                                                           # if the index is the last one
  3358                                                                           if i == len(args) - 1:
  3359                                           
  3360                                                                               # sets the index to to_set
  3361                                                                               obj[self.parse(i, line, f, sp, args)[
  3362                                                                                   2]] = to_set
  3363                                           
  3364                                                                           # if the index is not the last one
  3365                                                                           else:
  3366                                           
  3367                                                                               # sets the object to the index
  3368                                                                               obj = obj[self.parse(
  3369                                                                                   i, line, f, sp, args)[2]]
  3370                                           
  3371                                                                       # returns the object
  3372                                                                       return self.vars[vname].value
  3373                                           
  3374                                                                   # recursively gets a value in a dictionary
  3375                                                                   if objfunc == 'get':
  3376                                           
  3377                                                                       # the object to get from
  3378                                                                       obj = self.vars[vname].value
  3379                                           
  3380                                                                       # iterates through the indices
  3381                                                                       for i in range(len(args)):
  3382                                           
  3383                                                                           # sets the object to the index
  3384                                                                           obj = obj[self.parse(i, line, f, sp, args)[2]]
  3385                                           
  3386                                                                       # returns the object
  3387                                                                       return obj
  3388                                           
  3389                                                                   # gets the keys of this dictionary
  3390                                                                   if objfunc == 'keys':
  3391                                                                       return self.vars[vname].value.keys()
  3392                                           
  3393                                                                   # gets the values of this dictionary
  3394                                                                   if objfunc == 'values':
  3395                                                                       return self.vars[vname].value.values()
  3396                                           
  3397                                                                   # gets the items of this dictionary
  3398                                                                   if objfunc == 'items':
  3399                                                                       return self.vars[vname].value.items()
  3400                                           
  3401                                                                   # executes a function for each key-value pair
  3402                                                                   if objfunc == 'foreach':
  3403                                           
  3404                                                                       # variable name of the key
  3405                                                                       keyname = self.parse(0, line, f, sp, args)[2]
  3406                                           
  3407                                                                       # variable name of the value
  3408                                                                       valuename = self.parse(1, line, f, sp, args)[2]
  3409                                           
  3410                                                                       # function to execute
  3411                                                                       function = args[2][0]
  3412                                           
  3413                                                                       # loop through the dictionary
  3414                                                                       for key, value in self.vars[vname].value.items():
  3415                                           
  3416                                                                           # set the key and value variables
  3417                                                                           self.vars[keyname] = Var(keyname, key)
  3418                                                                           self.vars[valuename] = Var(valuename, value)
  3419                                           
  3420                                                                           # execute the function
  3421                                                                           self.interpret(function)
  3422                                           
  3423                                                                       # return the dictionary
  3424                                                                       return self.vars[vname].value
  3425                                           
  3426                                                                   # maps each value in the dictionary to the output of the function
  3427                                                                   if objfunc == 'map':
  3428                                           
  3429                                                                       # map arguments
  3430                                                                       keyvarname = self.parse(0, line, f, sp, args)[2]
  3431                                                                       valuevarname = self.parse(1, line, f, sp, args)[2]
  3432                                                                       function = args[2][0]
  3433                                           
  3434                                                                       new_dict = {}
  3435                                           
  3436                                                                       # loop through the objects items, assigning the key to the key and
  3437                                                                       # value to the value
  3438                                                                       for key, value in self.vars[vname].value.items():
  3439                                           
  3440                                                                           # log old key
  3441                                                                           old_key = key
  3442                                           
  3443                                                                           # execute the function
  3444                                                                           self.vars[keyvarname] = Var(keyvarname, key)
  3445                                                                           self.vars[valuevarname] = Var(
  3446                                                                               valuevarname, value)
  3447                                           
  3448                                                                           # run the function
  3449                                                                           ret = self.interpret(function)
  3450                                           
  3451                                                                           if self.vars[keyvarname].value == old_key:
  3452                                                                               new_dict[old_key] = self.vars[valuevarname].value
  3453                                                                           else:
  3454                                                                               new_dict[self.vars[keyvarname].value] = self.vars[valuevarname].value
  3455                                           
  3456                                                                       self.vars[vname].value = new_dict
  3457                                           
  3458                                                                       return self.vars[vname].value
  3459                                           
  3460                                                           # the below conditions interpret a line based on initial appearances
  3461                                                           # beneath these conditions will the Interpreter then parse the arguments from the line as a method call
  3462                                                           # request for Interpreter redirect to a block of code
  3463                                                           # the first argument is
  3464                                                           if func == 'redirect':
  3465                                                               line_vname = self.parse(0, line, f, sp, args)[2]
  3466                                                               _block = args[1][0]
  3467                                                               self.redirect_inside = []
  3468                                           
  3469                                                               # creates redirect for this interpreter
  3470                                                               self.redirect = [line_vname, _block]
  3471                                                               self.redirecting = True
  3472                                                               return self.redirect
  3473                                           
  3474                                                           # request for Interpreter redirect cancellation
  3475                                                           if func == 'stopredirect':
  3476                                                               self.redirecting = False
  3477                                           
  3478                                                               return True
  3479                                           
  3480                                                           # starts the redirection
  3481                                                           if func == 'startredirect':
  3482                                                               ret = None
  3483                                                               for _ins in self.redirect_inside:
  3484                                                                   ins = _ins[0]
  3485                                                                   _line = _ins[1]
  3486                                                                   self.vars[self.redirect[0]] = Var(
  3487                                                                       self.redirect[0], _line)
  3488                                                                   ret = self.interpret(ins)
  3489                                                               return ret
  3490                                           
  3491                                                           # alternative to '~' user defined method syntax
  3492                                                           # example call:
  3493                                                           # function('sum')
  3494                                                           elif func == 'function':
  3495                                           
  3496                                                               # obtain the name of the function
  3497                                                               fname = self.parse(0, line, f, sp, args)[2]
  3498                                           
  3499                                                               # obtain line to be added to the method
  3500                                                               block = args[1][0]
  3501                                           
  3502                                                               # function arguments
  3503                                           
  3504                                                               # return variable name
  3505                                                               ret = '__unused'
  3506                                           
  3507                                                               # create the new Method
  3508                                                               new_method = self.Method(fname, self)
  3509                                           
  3510                                                               # add the body
  3511                                                               new_method.add_body(block)
  3512                                                               new_method.add_return(f"{fname}__return__")
  3513                                           
  3514                                                               # obtain the rest of the arguments as method args
  3515                                                               for i in range(2, len(args)):
  3516                                                                   # adds variable name as an argument
  3517                                                                   # if any function specific argument is None, break
  3518                                                                   val = self.parse(i, line, f, sp, args)[2]
  3519                                                                   if val == None:
  3520                                                                       break
  3521                                                                   new_method.add_arg(val)
  3522                                                               self.methods[fname] = new_method
  3523                                                               return fname
  3524                                           
  3525                                                           # simpler way to create a function
  3526                                                           elif func == 'def':
  3527                                           
  3528                                                               # get the name of the new function
  3529                                                               name = self.parse(0, line, f, sp, args)[2]
  3530                                           
  3531                                                               # get the body of the script at the last argument
  3532                                                               body = args[-1][0]
  3533                                           
  3534                                                               # create the new function
  3535                                                               new_func = self.Method(name, self)
  3536                                           
  3537                                                               # get the args for this function between the name and the body
  3538                                                               # parse all args between the name and the body
  3539                                                               for i in range(1, len(args) - 1):
  3540                                                                   new_func.add_arg(self.parse(i, line, f, sp, args)[2])
  3541                                           
  3542                                                               # add the body
  3543                                                               new_func.add_body(f"ret('{name}' ,{body})")
  3544                                           
  3545                                                               # return buffer variable name
  3546                                                               r_name = f"{name}__return__"
  3547                                           
  3548                                                               # if the return buffer doesn't exist, create it
  3549                                                               if r_name not in self.vars:
  3550                                                                   # create the return variable
  3551                                                                   self.vars[r_name] = Var(r_name, None)
  3552                                           
  3553                                                               # add the return variable
  3554                                                               new_func.add_return(r_name)
  3555                                           
  3556                                                               # add the function to the methods
  3557                                                               self.methods[name] = new_func
  3558                                           
  3559                                                               # return the name of the function
  3560                                                               return name
  3561                                           
  3562                                                           # performs modular arithmetic on the two arguments given
  3563                                                           elif func == 'mod':
  3564                                                               return self.parse(0, line, f, sp, args)[2] % self.parse(1, line, f, sp, args)[2]
  3565                                           
  3566                                                           # returns a value to a function
  3567                                                           # first argument is the function to return to
  3568                                                           # second argument is the value to return
  3569                                                           # ret() is used to create a return buffer for
  3570                                                           #   multiprogramming.
  3571                                                           elif func == 'ret':
  3572                                           
  3573                                                               # function to return to
  3574                                                               fname = self.parse(0, line, f, sp, args)[2]
  3575                                           
  3576                                                               # value
  3577                                                               value = self.parse(1, line, f, sp, args)[2]
  3578                                           
  3579                                                               vname = f"{fname}__return__"
  3580                                                               self.vars[vname].value = value
  3581                                                               return value
  3582                                           
  3583                                                           # user method execution requested
  3584                                                           elif func in self.methods:
  3585                                           
  3586                                                               method = self.methods[func]
  3587                                           
  3588                                                               # create func args
  3589                                                               func_args = []
  3590                                           
  3591                                                               # if arguments supplied
  3592                                                               if not args[0][0] == '':
  3593                                           
  3594                                                                   for i in range(len(args)):
  3595                                                                       arguments = args[i]
  3596                                                                       line, as_s, arg = self.parse(i, line, f, sp, args)
  3597                                                                       func_args.append(arg)
  3598                                                                       try:
  3599                                                                           meth_argname = method.args[i]
  3600                                                                       except:
  3601                                                                           self.raise_incorrect_args(str(len(method.args)), str(
  3602                                                                               self.arg_count(args)), line, lines_ran, method)
  3603                                                                       self.vars[meth_argname] = Var(meth_argname, arg)
  3604                                           
  3605                                                               # create return variable
  3606                                                               ret_name = method.returns[0]
  3607                                           
  3608                                                               # add the return variable if not exists
  3609                                                               if ret_name not in self.vars:
  3610                                                                   self.vars[ret_name] = Var(ret_name, None)
  3611                                           
  3612                                                               # execute method
  3613                                                               try:
  3614                                                                   method.run(func_args, self, args)
  3615                                           
  3616                                                               # incorrect amount of arguments supplied
  3617                                                               except IndexError:
  3618                                                                   # raise msn2 error
  3619                                                                   self.raise_incorrect_args(str(len(method.args)), str(
  3620                                                                       self.arg_count(args)), line, lines_ran, method)
  3621                                           
  3622                                                               # if its a variable
  3623                                                               if ret_name in self.vars:
  3624                                                                   return self.vars[ret_name].value
  3625                                           
  3626                                                               try:
  3627                                                                   return eval(str(self.vars[ret_name].value), {}, {})
  3628                                                               except:
  3629                                                                   pass
  3630                                                               try:
  3631                                                                   return str(self.vars[ret_name].value)
  3632                                                               except:
  3633                                                                   return str(self.vars[ret_name])
  3634                                           
  3635                                                           # creating a list
  3636                                                           if func == 'arr' or func == 'from':
  3637                                                               arr = []
  3638                                                               if args[0][0] == '':
  3639                                                                   return arr
  3640                                                               for i in range(len(args)):
  3641                                                                   arr.append(self.parse(i, line, f, sp, args)[2])
  3642                                                               return arr
  3643                                           
  3644                                                           # creates a dictionary from its arguments
  3645                                                           # every two arguments
  3646                                                           # an odd quantity of arguments is impossible
  3647                                                           if func == 'dictfrom' or func == 'object':
  3648                                                               d = {}
  3649                                                               if args[0][0] == '':
  3650                                                                   return d
  3651                                           
  3652                                                               # step over arguments in steps of 2
  3653                                                               for i in range(0, len(args), 2):
  3654                                                                   cur = self.parse(i, line, f, sp, args)[2]
  3655                                                                   nxt = self.parse(i + 1, line, f, sp, args)[2]
  3656                                                                   d[cur] = nxt
  3657                                                               return d
  3658                                           
  3659                                                           # splits the first argument by the second argument
  3660                                                           if func == 'split':
  3661                                                               to_split = self.parse(0, line, f, sp, args)[2]
  3662                                                               splitting_by = self.parse(1, line, f, sp, args)[2]
  3663                                                               return to_split.split(splitting_by)
  3664                                           
  3665                                                           # obtains text between the first argument of the second argument
  3666                                                           if func == 'between':
  3667                                           
  3668                                                               # surrounding token
  3669                                                               surrounding = self.parse(0, line, f, sp, args)[2]
  3670                                           
  3671                                                               # string to analyze
  3672                                                               string = self.parse(1, line, f, sp, args)[2]
  3673                                           
  3674                                                               funccalls = []
  3675                                                               try:
  3676                                                                   while string.count(surrounding) > 1:
  3677                                                                       string = string[string.index(
  3678                                                                           surrounding) + len(surrounding):]
  3679                                                                       funccalls.append(
  3680                                                                           string[:string.index(surrounding)])
  3681                                                                       string = string[string.index(
  3682                                                                           surrounding) + len(surrounding):]
  3683                                                               except:
  3684                                                                   None
  3685                                           
  3686                                                               return funccalls
  3687                                           
  3688                                                           # determines if the argument passed is of the type specified
  3689                                                           if func == 'isstr':
  3690                                                               return isinstance(self.parse(0, line, f, sp, args)[2], str)
  3691                                                           elif func == 'islist':
  3692                                                               return isinstance(self.parse(0, line, f, sp, args)[2], list)
  3693                                                           elif func == 'isfloat':
  3694                                                               return isinstance(self.parse(0, line, f, sp, args)[2], float)
  3695                                                           elif func == 'isint':
  3696                                                               return isinstance(self.parse(0, line, f, sp, args)[2], int)
  3697                                                           elif func == 'isdict':
  3698                                                               return isinstance(self.parse(0, line, f, sp, args)[2], dict)
  3699                                           
  3700                                                           # gets the sum of all arguments
  3701                                                           if func == 'sum':
  3702                                                               total = 0
  3703                                                               for i in range(len(args)):
  3704                                                                   total += sum(self.parse(i, line, f, sp, args)[2])
  3705                                                               return total
  3706                                           
  3707                                                           # creates / sets a variable
  3708                                                           if func == 'var':
  3709                                           
  3710                                                               # extract varname
  3711                                                               varname = self.parse(0, line, f, sp, args)[2]
  3712                                           
  3713                                                               # extract value
  3714                                                               value = self.parse(1, line, f, sp, args)[2]
  3715                                           
  3716                                                               # add / set variable
  3717                                                               self.vars[varname] = Var(varname, value)
  3718                                                               return value
  3719                                           
  3720                                                           # converts the argument to a list
  3721                                                           elif func == 'list':
  3722                                                               return list(self.parse(0, line, f, sp, args)[2])
  3723                                           
  3724                                                           # absolute value
  3725                                                           elif func == 'abs':
  3726                                                               return abs(self.parse(0, line, f, sp, args)[2])
  3727                                                           # zip
  3728                                                           elif func == 'zip':
  3729                                                               return zip(self.parse(0, line, f, sp, args)[2], self.parse(1, line, f, sp, args)[2])
  3730                                                           # next
  3731                                                           elif func == 'next':
  3732                                                               return next(self.parse(0, line, f, sp, args)[2])
  3733                                                           # iter
  3734                                                           elif func == 'iter':
  3735                                                               return iter(self.parse(0, line, f, sp, args)[2])
  3736                                           
  3737                                                           # determines if a variable exists or not
  3738                                                           elif func == 'exists':
  3739                                                               return self.parse(0, line, f, sp, args)[2] in self.vars
  3740                                           
  3741                                                           # gets the length of the first argument
  3742                                                           elif func == 'len':
  3743                                                               line, as_s, arg = self.parse(0, line, f, sp, args)
  3744                                                               return len(arg)
  3745                                           
  3746                                                           # asserts each argument is True, prints and logs assertion error
  3747                                                           elif func == 'assert':
  3748                                                               for i in range(len(args)):
  3749                                                                   arguments = args[i]
  3750                                                                   line, assertion = self.convert_arg(
  3751                                                                       arguments[0], line, f, sp, args)
  3752                                                                   if not assertion:
  3753                                                                       failed = ''
  3754                                                                       for arg in args:
  3755                                                                           failed += str(arg[0]) + ' '
  3756                                                                       self.err(
  3757                                                                           f"Assertion error in '{line}'", assertion, failed, lines_ran)
  3758                                           
  3759                                                               return True
  3760                                           
  3761                                                           # trace capabilities
  3762                                                           elif obj == 'trace':
  3763                                                               if objfunc == 'before':
  3764                                                                   return lines_ran[len(lines_ran) - self.parse(0, line, f, sp, args)[2]:]
  3765                                                               if objfunc == 'this':
  3766                                                                   return lines_ran[-1]
  3767                                                               if objfunc == 'len':
  3768                                                                   return total_ints
  3769                                                               return '<msnint2 class>'
  3770                                           
  3771                                                           # gets msn2 settings information
  3772                                                           elif func == 'settings':
  3773                                                               # returns the settings dict
  3774                                                               return self.settings
  3775                                           
  3776                                                           # referencing python variables
  3777                                                           elif obj == 'py':
  3778                                           
  3779                                                               # getting a variable from the current python environment
  3780                                                               if objfunc == 'get':
  3781                                                                   return self._locals[self.parse(0, line, f, sp, args)[2]]
  3782                                           
  3783                                                               # setting a variable in the current python environment
  3784                                                               elif objfunc == 'set':
  3785                                                                   varname = self.parse(0, line, f, sp, args)[2]
  3786                                                                   value = self.parse(1, line, f, sp, args)[2]
  3787                                                                   self._locals[varname] = value
  3788                                                                   return value
  3789                                           
  3790                                                               # get the locals
  3791                                                               elif objfunc == 'locals':
  3792                                                                   return self._locals
  3793                                           
  3794                                                               # get the globals
  3795                                                               elif objfunc == 'globals':
  3796                                                                   return self._globals
  3797                                           
  3798                                                               # runs a stored python script
  3799                                                               elif objfunc == 'run':
  3800                                           
  3801                                                                   # get the script
  3802                                                                   scr = self.parse(0, line, f, sp, args)[2]
  3803                                           
  3804                                                                   # execute the python and return
  3805                                                                   # the snippet with arguments inserted
  3806                                                                   return self.exec_python(scr)
  3807                                           
  3808                                                               # return a local variable within the python
  3809                                                               # environment
  3810                                                               else:
  3811                                                                   return self._locals[objfunc]
  3812                                           
  3813                                                           # casting
  3814                                                           elif func == 'int':
  3815                                                               return int(self.parse(0, line, f, sp, args)[2])
  3816                                                           elif func == 'float':
  3817                                                               return float(self.parse(0, line, f, sp, args)[2])
  3818                                                           elif func == 'str':
  3819                                                               return str(self.parse(0, line, f, sp, args)[2])
  3820                                                           elif func == 'bool':
  3821                                                               return bool(self.parse(0, line, f, sp, args)[2])
  3822                                                           elif func == 'complex':
  3823                                                               return complex(self.parse(0, line, f, sp, args)[2])
  3824                                           
  3825                                                           # gets the type of the argument
  3826                                                           elif func == 'type':
  3827                                                               return type(self.parse(0, line, f, sp, args)[2])
  3828                                           
  3829                                                           # gets the dir of the argument
  3830                                                           elif func == 'dir':
  3831                                                               return dir(self.parse(0, line, f, sp, args)[2])
  3832                                           
  3833                                                           # casting to iterables / sets / dicts
  3834                                                           elif func == 'set':
  3835                                           
  3836                                                               # creates a set from all arguments
  3837                                                               if args[0][0] == '':
  3838                                                                   return set()
  3839                                           
  3840                                                               # creates a set from all arguments
  3841                                                               s = set()
  3842                                           
  3843                                                               # adds all arguments to the set
  3844                                                               for i in range(len(args)):
  3845                                                                   s.add(self.parse(i, line, f, sp, args)[2])
  3846                                                               return s
  3847                                           
  3848                                                           elif func == 'dict':
  3849                                                               return dict(self.parse(0, line, f, sp, args)[2])
  3850                                                           elif func == 'tuple':
  3851                                                               return tuple(self.parse(0, line, f, sp, args)[2])
  3852                                           
  3853                                                           # conditional logic
  3854                                                           elif func == 'if':
  3855                                                               # if condition and blocks arguments
  3856                                                               ifcond_s = args[0][0]
  3857                                                               true_block_s = args[1][0]
  3858                                           
  3859                                                               # false block is optional
  3860                                                               try:
  3861                                                                   false_block_s = args[2][0]
  3862                                                               except:
  3863                                                                   false_block_s = None
  3864                                           
  3865                                                               ifcond = self.parse(0, line, f, sp, args)[2]
  3866                                           
  3867                                                               # if condition is true
  3868                                                               if ifcond:
  3869                                                                   return self.parse(1, line, f, sp, args)[2]
  3870                                           
  3871                                                               # otherwise false block is executed
  3872                                                               if false_block_s:
  3873                                                                   return self.parse(2, line, f, sp, args)[2]
  3874                                                               return False
  3875                                           
  3876                                                           # while logic WIPWIPWIPWIPWIP
  3877                                                           elif func == 'while':
  3878                                           
  3879                                                               # while arguments as strings
  3880                                                               whilecond_s = args[0][0]
  3881                                                               while_block_s = args[1][0]
  3882                                           
  3883                                                               while (self.interpret(whilecond_s)):
  3884                                                                   self.interpret(while_block_s)
  3885                                                               return True
  3886                                           
  3887                                                            # iteration
  3888                                                           elif func == 'for':
  3889                                           
  3890                                                               # block to execute
  3891                                                               inside = args[3][0]
  3892                                           
  3893                                                               # times to loop
  3894                                                               line, as_s, start = self.parse(0, line, f, sp, args)
  3895                                                               line, as_s, end = self.parse(1, line, f, sp, args)
  3896                                                               line, as_s, loopvar = self.parse(2, line, f, sp, args)
  3897                                                               self.vars[loopvar] = Var(loopvar, start)
  3898                                                               # regular iteration
  3899                                                               if start < end:
  3900                                                                   for i in range(start, end):
  3901                                                                       if loopvar in self.vars and self.vars[loopvar].value >= end:
  3902                                                                           break
  3903                                                                       self.vars[loopvar] = Var(loopvar, i)
  3904                                                                       self.interpret(inside)
  3905                                           
  3906                                                               # reversed if requested
  3907                                                               elif start > end:
  3908                                                                   for i in reversed(range(end, start)):
  3909                                                                       if loopvar in self.vars and self.vars[loopvar].value < end:
  3910                                                                           break
  3911                                                                       self.vars[loopvar] = Var(loopvar, i)
  3912                                                                       self.interpret(inside)
  3913                                                               return self.vars[loopvar].value
  3914                                           
  3915                                                           # executes a block of code for each element in an array
  3916                                                           elif func == 'each':
  3917                                           
  3918                                                               # get array argument
  3919                                                               line, as_s, array = self.parse(0, line, f, sp, args)
  3920                                           
  3921                                                               # get element variable name
  3922                                                               line, as_s, element_name = self.parse(1, line, f, sp, args)
  3923                                                               block_s = args[2][0]
  3924                                           
  3925                                                               # prepare each element
  3926                                                               self.vars[element_name] = Var(element_name, 0)
  3927                                           
  3928                                                               # execute block for each element
  3929                                                               for i in range(len(array)):
  3930                                                                   self.vars[element_name].value = array[i]
  3931                                                                   self.interpret(block_s)
  3932                                                               return array
  3933                                           
  3934                                                           # sorting an array by an attribute of each element
  3935                                                           elif func == 'sortby':
  3936                                           
  3937                                                               # iterable to sort
  3938                                                               iterable = self.parse(0, line, f, sp, args)[2]
  3939                                           
  3940                                                               # variable name
  3941                                                               varname = self.parse(1, line, f, sp, args)[2]
  3942                                           
  3943                                                               # block of code to interpret, the sorting
  3944                                                               # is based on the interpretation of this block
  3945                                                               block = args[2][0]
  3946                                           
  3947                                                               # pairing elements to their interpretations
  3948                                                               pairing = []
  3949                                                               for i in range(len(iterable)):
  3950                                                                   self.vars[varname] = Var(varname, iterable[i])
  3951                                                                   pairing.append((self.interpret(block), iterable[i]))
  3952                                                               # sort the pairing based on the first element of each pair
  3953                                                               pairing.sort(key=lambda x: x[0])
  3954                                                               # return the sorted array containing the second element
  3955                                                               # of each pair
  3956                                                               return [pair[1] for pair in pairing]
  3957                                           
  3958                                                           # performs list comprehension
  3959                                                           elif func == 'comp':
  3960                                                               lst = []
  3961                                           
  3962                                                               # array to comprehend
  3963                                                               arr = self.parse(0, line, f, sp, args)[2]
  3964                                           
  3965                                                               # varname for the element
  3966                                                               varname = self.parse(1, line, f, sp, args)[2]
  3967                                           
  3968                                                               # block to perform
  3969                                                               block = args[2][0]
  3970                                           
  3971                                                               # performs the list comprehension
  3972                                                               for v in arr:
  3973                                                                   self.vars[varname] = Var(varname, v)
  3974                                                                   r = self.interpret(block)
  3975                                                                   if r != msn2_none:
  3976                                                                       lst.append(r)
  3977                                                               return lst
  3978                                           
  3979                                                           # returns the first argument, then performs the second argument as a block
  3980                                                           elif func == 'do':
  3981                                                               ret = self.parse(0, line, f, sp, args)[2]
  3982                                                               self.interpret(args[1][0])
  3983                                                               return ret
  3984                                           
  3985                                                           # special value for msn2 to return None
  3986                                                           elif func == 'None':
  3987                                                               return msn2_none
  3988                                           
  3989                                                           # filters an iterable to retain all elements that satisfy the second argument as
  3990                                                           # a block
  3991                                                           # the first argument is a string for a variable for each element
  3992                                                           # second argument is a block to run for each element
  3993                                                           elif func == 'filter':
  3994                                           
  3995                                                               # iterable to filter
  3996                                                               iterable = self.parse(0, line, f, sp, args)[2]
  3997                                           
  3998                                                               # variable name
  3999                                                               varname = self.parse(1, line, f, sp, args)[2]
  4000                                           
  4001                                                               # block to execute
  4002                                                               block = args[2][0]
  4003                                           
  4004                                                               # new array
  4005                                                               filtered = []
  4006                                           
  4007                                                               # iterate through each element
  4008                                                               for v in iterable:
  4009                                           
  4010                                                                   # set the variable to the element
  4011                                                                   self.vars[varname] = Var(varname, v)
  4012                                           
  4013                                                                   # if the block returns true, add the element to the new array
  4014                                                                   if self.interpret(block):
  4015                                                                       filtered.append(v)
  4016                                           
  4017                                                               return filtered
  4018                                           
  4019                                                           # unpacks the first argument into any amount of variables
  4020                                                           # specified by the remaining arguments provided as variable names
  4021                                                           # creates the variables if they don't exists
  4022                                                           # 5/22/2023
  4023                                                           elif func == 'unpack':
  4024                                           
  4025                                                               # iterable to unpack
  4026                                                               iterable = self.parse(0, line, f, sp, args)[2]
  4027                                           
  4028                                                               # variable names to unpack into
  4029                                                               for i in range(1, len(args)):
  4030                                                                   varname = self.parse(i, line, f, sp, args)[2]
  4031                                                                   self.vars[varname] = Var(varname, iterable[i - 1])
  4032                                           
  4033                                                               return iterable
  4034                                           
  4035                                                           # determines if the array has all elements specified
  4036                                                           # takes any amount of arguments
  4037                                                           # first argument is the iterable
  4038                                                           # the rest are elements to check for
  4039                                                           elif func == 'has':
  4040                                                               # iterable to check
  4041                                                               iterable = self.parse(0, line, f, sp, args)[2]
  4042                                           
  4043                                                               # iterate through each element
  4044                                                               for i in range(len(args) - 1):
  4045                                                                   if self.parse(i + 1, line, f, sp, args)[2] not in iterable:
  4046                                                                       return False
  4047                                                               return True
  4048                                           
  4049                                                           # gets the first element in the iterable
  4050                                                           elif func == 'first' or func == 'head':
  4051                                                               try:
  4052                                                                   return self.parse(0, line, f, sp, args)[2][0]
  4053                                                               except:
  4054                                                                   return None
  4055                                           
  4056                                                           # gets the last element in the iterable
  4057                                                           elif func == 'last' or func == 'tail':
  4058                                                               try:
  4059                                                                   return self.parse(0, line, f, sp, args)[2][-1]
  4060                                                               except:
  4061                                                                   return None
  4062                                           
  4063                                                           # the following provide efficient variable arithmetic
  4064                                                           elif func == 'add':
  4065                                                               line, as_s, first = self.parse(0, line, f, sp, args)
  4066                                                               line, as_s, second = self.parse(1, line, f, sp, args)
  4067                                           
  4068                                                               # case array
  4069                                                               if isinstance(self.vars[first].value, list):
  4070                                                                   self.vars[first].value.append(second)
  4071                                           
  4072                                                               # case string or number
  4073                                                               else:
  4074                                                                   self.vars[first].value += second
  4075                                                               return self.vars[first].value
  4076                                           
  4077                                                           # performs basic operations on non-variable values
  4078                                                           elif obj == 'op':
  4079                                           
  4080                                                               # obtains the first argument
  4081                                                               arg1 = self.parse(0, line, f, sp, args)[2]
  4082                                           
  4083                                                               # adds all arguments
  4084                                                               if objfunc == 'append' or objfunc == 'push' or objfunc == 'add' or objfunc == 'plus' or objfunc == '+' or objfunc == 'concat' or objfunc == 'concatenate' or objfunc == 'join' or objfunc == 'merge' or objfunc == 'sum':
  4085                                           
  4086                                                                   if isinstance(arg1, list):
  4087                                                                       for i in range(1, len(args)):
  4088                                                                           arg2 = self.parse(i, line, f, sp, args)[2]
  4089                                                                           arg1.append(arg2)
  4090                                                                       return arg1
  4091                                                                   else:
  4092                                                                       for i in range(1, len(args)):
  4093                                                                           arg2 = self.parse(i, line, f, sp, args)[2]
  4094                                                                           arg1 += arg2
  4095                                                                       return arg1
  4096                                           
  4097                                                               # subtracts all arguments
  4098                                                               if objfunc == 'sub' or objfunc == 'minus' or objfunc == 'subtract' or objfunc == '-':
  4099                                                                   for i in range(1, len(args)):
  4100                                                                       arg2 = self.parse(i, line, f, sp, args)[2]
  4101                                                                       arg1 -= arg2
  4102                                                                   return arg1
  4103                                           
  4104                                                               if objfunc == 'mul' or objfunc == 'times' or objfunc == 'x' or objfunc == '*' or objfunc == 'multiply':
  4105                                                                   for i in range(1, len(args)):
  4106                                                                       arg2 = self.parse(i, line, f, sp, args)[2]
  4107                                                                       arg1 *= arg2
  4108                                                                   return arg1
  4109                                           
  4110                                                               if objfunc == 'div' or objfunc == 'divide' or objfunc == 'over' or objfunc == '/' or objfunc == '':
  4111                                                                   for i in range(1, len(args)):
  4112                                                                       arg2 = self.parse(i, line, f, sp, args)[2]
  4113                                                                       arg1 /= arg2
  4114                                                                   return arg1
  4115                                           
  4116                                                               # integer division
  4117                                                               if objfunc == 'idiv' or objfunc == 'intdiv' or objfunc == 'intdivide' or objfunc == 'intover' or objfunc == '//' or objfunc == '':
  4118                                                                   for i in range(1, len(args)):
  4119                                                                       arg2 = self.parse(i, line, f, sp, args)[2]
  4120                                                                       arg1 //= arg2
  4121                                                                   return arg1
  4122                                           
  4123                                                               if objfunc == 'mod' or objfunc == 'modulo' or objfunc == 'modulus' or objfunc == '%' or objfunc == 'remainder':
  4124                                                                   for i in range(1, len(args)):
  4125                                                                       arg2 = self.parse(i, line, f, sp, args)[2]
  4126                                                                       arg1 %= arg2
  4127                                                                   return arg1
  4128                                           
  4129                                                               if objfunc == 'pow' or objfunc == 'power' or objfunc == 'exponent' or objfunc == '**':
  4130                                                                   for i in range(1, len(args)):
  4131                                                                       arg2 = self.parse(i, line, f, sp, args)[2]
  4132                                                                       arg1 **= arg2
  4133                                                                   return arg1
  4134                                                               if objfunc == 'root' or objfunc == 'nthroot' or objfunc == 'nthrt':
  4135                                                                   for i in range(1, len(args)):
  4136                                                                       arg2 = self.parse(i, line, f, sp, args)[2]
  4137                                                                       arg1 **= (1 / arg2)
  4138                                                                   return arg1
  4139                                                               return '<msnint2 class>'
  4140                                           
  4141                                                           # computes the maximum value from all arguments
  4142                                                           # takes any amount of arguments, all being
  4143                                                           # either numbers or lists
  4144                                                           elif func == 'maximum':
  4145                                                               maxval = max(_f) if isinstance(
  4146                                                                   (_f := self.parse(0, line, f, sp, args)[2]), list) else _f
  4147                                                               for i in range(1, len(args)):
  4148                                                                   val = self.parse(i, line, f, sp, args)[2]
  4149                                                                   # is a list argument
  4150                                                                   if isinstance(val, list):
  4151                                                                       maxval = max(maxval, max(val))
  4152                                                                   # is a number
  4153                                                                   else:
  4154                                                                       maxval = max(maxval, val)
  4155                                                               return maxval
  4156                                                           elif func == 'minimum':
  4157                                                               minval = min(_f) if isinstance(
  4158                                                                   (_f := self.parse(0, line, f, sp, args)[2]), list) else _f
  4159                                                               for i in range(1, len(args)):
  4160                                                                   val = self.parse(i, line, f, sp, args)[2]
  4161                                                                   # is a list argument
  4162                                                                   if isinstance(val, list):
  4163                                                                       minval = min(minval, min(val))
  4164                                                                   # is a number
  4165                                                                   else:
  4166                                                                       minval = min(minval, val)
  4167                                                               return minval
  4168                                           
  4169                                                           # more support for functions
  4170                                                           elif obj == 'function':
  4171                                           
  4172                                                               fname = self.parse(0, line, f, sp, args)[2]
  4173                                           
  4174                                                               # adds a line of code to a function / method's body
  4175                                                               if objfunc == 'addbody':
  4176                                                                   _body = self.parse(1, line, f, sp, args)[2]
  4177                                           
  4178                                                                   self.methods[fname].add_body(_body)
  4179                                                                   return fname
  4180                                           
  4181                                                               # adds an argument to a function
  4182                                                               if objfunc == 'addarg':
  4183                                           
  4184                                                                   arg = self.parse(1, line, f, sp, args)[2]
  4185                                           
  4186                                                                   self.methods[fname].add_arg(arg)
  4187                                                                   return fname
  4188                                           
  4189                                                               # adds a return variable to this function
  4190                                                               if objfunc == 'addreturn':
  4191                                                                   retvar = self.parse(1, line, f, sp, args)[2]
  4192                                           
  4193                                                                   self.methods[fname].add_return(retvar)
  4194                                                                   return fname
  4195                                           
  4196                                                               if objfunc == 'getbody':
  4197                                                                   return self.methods[fname].body
  4198                                           
  4199                                                               if objfunc == 'getargs':
  4200                                                                   return self.methods[fname].args
  4201                                           
  4202                                                               if objfunc == 'getreturn':
  4203                                                                   return self.methods[fname].returns[0]
  4204                                           
  4205                                                               # removes a function from the working context
  4206                                                               if objfunc == 'destroy':
  4207                                                                   self.methods.pop(fname)
  4208                                                                   return fname
  4209                                           
  4210                                                               # simulates an execution of a function
  4211                                                               if objfunc == 'run':
  4212                                           
  4213                                                                   # form a string that is msn2 of the user defined function
  4214                                           
  4215                                                                   args_str = ''
  4216                                                                   for i in range(1, len(args)):
  4217                                                                       arg = self.parse(i, line, f, sp, args)[2]
  4218                                                                       if i != len(args) - 1:
  4219                                                                           args_str += str(arg) + ', '
  4220                                                                       else:
  4221                                                                           args_str += str(arg)
  4222                                           
  4223                                                                   inst = fname + '(' + args_str + ')'
  4224                                                                   return self.interpret(inst)
  4225                                           
  4226                                                               return '<msnint2 class>'
  4227                                           
  4228                                                           elif func == 'sub':
  4229                                                               line, as_s, first = self.parse(0, line, f, sp, args)
  4230                                                               line, as_s, second = self.parse(1, line, f, sp, args)
  4231                                                               self.vars[first].value -= second
  4232                                                               return self.vars[first].value
  4233                                                           elif func == 'mul':
  4234                                                               line, as_s, first = self.parse(0, line, f, sp, args)
  4235                                                               line, as_s, second = self.parse(1, line, f, sp, args)
  4236                                                               self.vars[first].value *= second
  4237                                                               return self.vars[first].value
  4238                                                           elif func == 'div':
  4239                                                               line, as_s, first = self.parse(0, line, f, sp, args)
  4240                                                               line, as_s, second = self.parse(1, line, f, sp, args)
  4241                                                               self.vars[first].value /= second
  4242                                                               return self.vars[first].value
  4243                                           
  4244                                                           # appends to an array variable
  4245                                                           elif func == 'append':
  4246                                           
  4247                                                               # varname
  4248                                                               varname = self.parse(0, line, f, sp, args)[2]
  4249                                           
  4250                                                               # value to append
  4251                                                               value = self.parse(1, line, f, sp, args)[2]
  4252                                           
  4253                                                               self.vars[varname].value.append(value)
  4254                                                               return value
  4255                                           
  4256                                                           # gets at the index specified
  4257                                                           elif func == '->':
  4258                                           
  4259                                                               # array
  4260                                                               array = self.parse(0, line, f, sp, args)[2]
  4261                                           
  4262                                                               # index
  4263                                                               index = self.parse(1, line, f, sp, args)[2]
  4264                                           
  4265                                                               return array[index]
  4266                                           
  4267                                                           # gets the MSNScript version of this interpreter
  4268                                                           elif func == 'version':
  4269                                                               return self.version
  4270                                           
  4271                                                           # destroys a function or variable
  4272                                                           elif func == 'destroy':
  4273                                                               varname = self.parse(0, line, f, sp, args)[2]
  4274                                           
  4275                                                               # deletes all variables or methods that start with '__'
  4276                                                               if varname == '__':
  4277                                                                   for key in list(self.vars):
  4278                                                                       if key.startswith('__'):
  4279                                                                           del self.vars[key]
  4280                                                                   for key in list(self.methods):
  4281                                                                       if key.startswith('__'):
  4282                                                                           del self.methods[key]
  4283                                                                   return True
  4284                                           
  4285                                                               if varname in self.vars:
  4286                                                                   del self.vars[varname]
  4287                                           
  4288                                                               elif varname in self.methods:
  4289                                                                   del self.methods[varname]
  4290                                           
  4291                                                               return True
  4292                                           
  4293                                                           # gets a range()
  4294                                                           elif func == 'range':
  4295                                                               start = self.parse(0, line, f, sp, args)[2]
  4296                                                               # if one argument
  4297                                                               if len(args) == 1:
  4298                                                                   return range(start)
  4299                                                               # get the end of the range
  4300                                                               end = self.parse(1, line, f, sp, args)[2]
  4301                                                               # if two arguments
  4302                                                               if len(args) == 2:
  4303                                                                   return range(start, end)
  4304                                                               if len(args) == 3:
  4305                                                                   step = self.parse(2, line, f, sp, args)[2]
  4306                                                                   return range(start, end, step)
  4307                                                               return range()
  4308                                           
  4309                                                           # random capabilities
  4310                                                           elif func == 'random':
  4311                                                               import random
  4312                                                               # gets a random number between 0 and 1
  4313                                                               if len(args) == 1:
  4314                                           
  4315                                                                   arg = self.parse(0, line, f, sp, args)[2]
  4316                                           
  4317                                                                   return random.random()
  4318                                           
  4319                                                               # random number in range
  4320                                                               elif len(args) == 2:
  4321                                                                   arg = self.parse(0, line, f, sp, args)[2]
  4322                                                                   arg2 = self.parse(1, line, f, sp, args)[2]
  4323                                           
  4324                                                                   return (random.random() * (arg2 - arg)) + arg
  4325                                           
  4326                                                               # random int in range
  4327                                                               elif len(args) == 3:
  4328                                                                   # using math
  4329                                                                   import math
  4330                                                                   arg = self.parse(0, line, f, sp, args)[2]
  4331                                                                   arg2 = self.parse(1, line, f, sp, args)[2]
  4332                                           
  4333                                                                   return math.floor((random.random() * (arg2 - arg)) + arg)
  4334                                           
  4335                                                               return '<msnint2 class>'
  4336                                           
  4337                                                           # html parsing simplified
  4338                                                           elif obj == 'html':
  4339                                           
  4340                                                               url = self.parse(0, line, f, sp, args)[2]
  4341                                           
  4342                                                               # creates a BeautifulSoup object of a url
  4343                                                               if objfunc == 'soup':
  4344                                                                   from bs4 import BeautifulSoup
  4345                                                                   import requests
  4346                                                                   response = requests.get(url)
  4347                                                                   return BeautifulSoup(response.content, 'html5lib')
  4348                                           
  4349                                                               # scrapes all html elements from a url
  4350                                                               # WIPWIPWIPWIP
  4351                                                               if objfunc == 'from':
  4352                                           
  4353                                                                   obj_to_add = []
  4354                                                                   all_elem = self.html_all_elements(url)
  4355                                                                   for elem in all_elem:
  4356                                                                       obj_to_add.append(
  4357                                                                           {'tag': elem.name, 'attrs': elem.attrs, 'text': elem.text})
  4358                                                                   return obj_to_add
  4359                                           
  4360                                                               # starts an HTMLSession
  4361                                                               if objfunc == 'session':
  4362                                                                   from requests_html import HTMLSession
  4363                                                                   return HTMLSession()
  4364                                           
  4365                                                           # ai specific usage
  4366                                                           elif obj == 'ai':
  4367                                                               # ChatGPT API
  4368                                                               import openai
  4369                                                               global models
  4370                                                               # verify existence of openai api key
  4371                                                               if not openai.api_key:
  4372                                                                   try:
  4373                                                                       openai.api_key = os.environ['OPENAI_API_KEY']
  4374                                                                   except:
  4375                                                                       raise Exception(
  4376                                                                           'OpenAI API key not found. Please set your OPENAI_API_KEY environment variable to your OpenAI API key.')
  4377                                                               # if models not defined, define them
  4378                                                               if not models:
  4379                                                                   models = {
  4380                                                                       # standard model, answers questions will little to no creativity
  4381                                                                       'basic': {'model': 'text-davinci-003', 'creativity': 0},
  4382                                                                       # creative model, answers questions with creativity
  4383                                                                       'creative': {'model': 'text-davinci-003', 'creativity': 0.5},
  4384                                                                       # advanced model, answers questions with high creativity
  4385                                                                       'advanced': {'model': 'text-davinci-003', 'creativity': 1}
  4386                                                                   }
  4387                                                               # asks openai model a question
  4388                                                               # simple ai, see top of file for definition
  4389                                                               if objfunc == 'basic':
  4390                                                                   # creates an ai model
  4391                                                                   # creates and returns a custom ai model
  4392                                                                   def ai_response(model, prompt, creativity):
  4393                                                                       # ChatGPT API
  4394                                                                       import openai
  4395                                                                       return openai.Completion.create(
  4396                                                                           model=model,
  4397                                                                           prompt=prompt,
  4398                                                                           temperature=creativity
  4399                                                                       ).choices[0].text
  4400                                                                   # generates an ai response with the basic model
  4401                                                                   return ai_response(models['basic']['model'], self.parse(0, line, f, sp, args)[2], models['basic']['creativity'])
  4402                                                               return '<msnint2 class>'
  4403                                           
  4404                                                           # raises an msn2 exception
  4405                                                           elif func == 'raise':
  4406                                                               self.err(self.parse(0, line, f, sp, args)[2], self.parse(
  4407                                                                   1, line, f, sp, args)[2], self.parse(2, line, f, sp, args)[2], lines_ran)
  4408                                           
  4409                                                           # defines new syntax, see tests/validator.msn2 for documentation
  4410                                                           elif func == 'syntax':
  4411                                           
  4412                                                               # gets the syntax token
  4413                                                               token = self.parse(0, line, f, sp, args)[2]
  4414                                           
  4415                                                               # gets the variable name of the between
  4416                                                               between = self.parse(1, line, f, sp, args)[2]
  4417                                           
  4418                                                               # function that should be executed when the syntax is found
  4419                                                               function = args[2][0]
  4420                                           
  4421                                                               return self.add_syntax(token, between, function)
  4422                                           
  4423                                                           # creates a new enclosed syntax that should execute the block
  4424                                                           # specified on the line by which it was created
  4425                                                           elif func == 'enclosedsyntax':
  4426                                           
  4427                                                               start = self.parse(0, line, f, sp, args)[2]
  4428                                                               end = self.parse(1, line, f, sp, args)[2]
  4429                                                               varname = self.parse(2, line, f, sp, args)[2]
  4430                                           
  4431                                                               index = str(start) + 'msnint2_reserved' + str(end)
  4432                                                               enclosed[index] = [start, end, varname, args[3][0]]
  4433                                           
  4434                                                               if len(args) == 5:
  4435                                                                   enclosed[index].append(
  4436                                                                       self.parse(4, line, f, sp, args)[2])
  4437                                                               return enclosed[index]
  4438                                           
  4439                                                           # defines a new macro
  4440                                                           elif func == 'macro':
  4441                                           
  4442                                                               token = self.parse(0, line, f, sp, args)[2]
  4443                                           
  4444                                                               varname = self.parse(1, line, f, sp, args)[2]
  4445                                           
  4446                                                               code = args[2][0]
  4447                                           
  4448                                                               macros[token] = [token, varname, code]
  4449                                           
  4450                                                               # 4th argument offered as a return value from that macro
  4451                                                               # as opposed to a block of code
  4452                                                               if len(args) == 4:
  4453                                                                   macros[token].append(
  4454                                                                       self.parse(3, line, f, sp, args)[2])
  4455                                           
  4456                                                               return macros[token]
  4457                                           
  4458                                                           # creates a macro that should be declared at the end of a line
  4459                                                           elif func == 'postmacro':
  4460                                           
  4461                                                               token = self.parse(0, line, f, sp, args)[2]
  4462                                           
  4463                                                               varname = self.parse(1, line, f, sp, args)[2]
  4464                                           
  4465                                                               code = args[2][0]
  4466                                           
  4467                                                               postmacros[token] = [token, varname, code]
  4468                                           
  4469                                                               # same as macro
  4470                                                               if len(args) == 4:
  4471                                                                   postmacros[token].append(
  4472                                                                       self.parse(3, line, f, sp, args)[2])
  4473                                           
  4474                                                               return postmacros[token]
  4475                                           
  4476                                                           # creates an inline syntax that allows for value replacement
  4477                                                           # within a line
  4478                                                           # this is different from the above system calls because this
  4479                                                           # syntax is invoked and returned as a value which will replace
  4480                                                           # the invocation within the line
  4481                                                           # arguments are the same as enclosedsyntax
  4482                                                           #
  4483                                                           # WIPWIPWIPWIPWIP
  4484                                                           elif func == 'inlinesyntax':
  4485                                                               start = self.parse(0, line, f, sp, args)[2]
  4486                                                               end = self.parse(1, line, f, sp, args)[2]
  4487                                                               varname = self.parse(2, line, f, sp, args)[2]
  4488                                           
  4489                                                               index = str(start) + 'msnint2_reserved' + str(end)
  4490                                           
  4491                                                               inlines[index] = [start, end, varname, args[3][0]]
  4492                                           
  4493                                                               if len(args) == 5:
  4494                                                                   inlines[index].append(
  4495                                                                       self.parse(4, line, f, sp, args)[2])
  4496                                                               return inlines[index]
  4497                                           
  4498                                                           # performs object based operations
  4499                                                           elif obj == 'var':
  4500                                           
  4501                                                               # determines if all variables passed are equal
  4502                                                               if objfunc == 'equals':
  4503                                                                   firstvar = self.vars[self.parse(
  4504                                                                       0, line, f, sp, args)[2]].value
  4505                                                                   for i in range(1, len(args)):
  4506                                                                       if firstvar != self.vars[self.parse(i, line, f, sp, args)[2]].value:
  4507                                                                           return False
  4508                                                                   return True
  4509                                                               return '<msnint2 class>'
  4510                                           
  4511                                                           # gets the value of a variable
  4512                                                           elif func == 'val':
  4513                                           
  4514                                                               # gets the variable name
  4515                                                               varname = self.parse(0, line, f, sp, args)[2]
  4516                                           
  4517                                                               try:
  4518                                                                   return self.vars[varname].value
  4519                                                               except:
  4520                                                                   return self.vars[varname]
  4521                                           
  4522                                                           # gets a sorted version of the array
  4523                                                           elif func == 'sorted':
  4524                                                               return sorted(self.parse(0, line, f, sp, args)[2])
  4525                                           
  4526                                                           # performs file-specific operations
  4527                                                           elif obj == 'file':
  4528                                                               # import shutil
  4529                                                               import shutil
  4530                                                               # opens a file with utf-8 encoding
  4531                                                               def open_utf(filename, mode):
  4532                                                                   return open(filename, mode, encoding='utf-8')
  4533                                                                   
  4534                                                               # creates a file
  4535                                                               if objfunc == 'create':
  4536                                                                   lock.acquire()
  4537                                                                   line, as_s, filename = self.parse(0, line, f, sp, args)
  4538                                                                   open_utf(filename, 'w')
  4539                                                                   lock.release()
  4540                                                                   return True
  4541                                           
  4542                                                               # reads text from a file
  4543                                                               if objfunc == 'read':
  4544                                                                   lock.acquire()
  4545                                                                   file = open_utf(self.parse(0, line, f, sp, args)[2], 'r')
  4546                                                                   contents = file.read()
  4547                                                                   file.close()
  4548                                                                   lock.release()
  4549                                                                   return contents
  4550                                           
  4551                                                               # writes to a file
  4552                                                               if objfunc == 'write':
  4553                                                                   lock.acquire()
  4554                                                                   file = open_utf(self.parse(0, line, f, sp, args)[2], 'w')
  4555                                                                   towrite = self.parse(1, line, f, sp, args)[2]
  4556                                                                   file.write(towrite)
  4557                                                                   file.close()
  4558                                                                   lock.release()
  4559                                                                   return towrite
  4560                                           
  4561                                                               # writes the argument as code
  4562                                                               if objfunc == 'writemsn':
  4563                                                                   lock.acquire()
  4564                                                                   file = open_utf(self.parse(0, line, f, sp, args)[2], 'w')
  4565                                                                   towrite = args[1][0]
  4566                                                                   file.write(towrite)
  4567                                                                   lock.release()
  4568                                                                   return towrite
  4569                                           
  4570                                                               # clears a file of all text
  4571                                                               if objfunc == 'clear':
  4572                                                                   lock.acquire()
  4573                                                                   file = open_utf(self.parse(0, line, f, sp, args)[2], 'w')
  4574                                                                   file.write("")
  4575                                                                   file.close()
  4576                                                                   lock.release()
  4577                                                                   return True
  4578                                           
  4579                                                               # appends to a file
  4580                                                               if objfunc == 'append':
  4581                                                                   lock.acquire()
  4582                                                                   file = open_utf(self.parse(0, line, f, sp, args)[2], 'a')
  4583                                                                   towrite = self.parse(1, line, f, sp, args)[2]
  4584                                                                   file.write(towrite)
  4585                                                                   file.close()
  4586                                                                   lock.release()
  4587                                                                   return towrite
  4588                                           
  4589                                                               # deletes a file
  4590                                                               if objfunc == 'delete':
  4591                                                                   lock.acquire()
  4592                                                                   deleting = self.parse(0, line, f, sp, args)[2]
  4593                                                                   try:
  4594                                                                       os.remove(deleting)
  4595                                                                   except:
  4596                                                                       None
  4597                                                                   lock.release()
  4598                                                                   return deleting
  4599                                           
  4600                                                               # renames a file
  4601                                                               if objfunc == 'rename':
  4602                                                                   lock.acquire()
  4603                                                                   old = self.parse(0, line, f, sp, args)[2]
  4604                                                                   new = self.parse(1, line, f, sp, args)[2]
  4605                                                                   os.rename(old, new)
  4606                                                                   lock.release()
  4607                                                                   return new
  4608                                           
  4609                                                               # copies a file
  4610                                                               if objfunc == 'copy':
  4611                                                                   lock.acquire()
  4612                                                                   old = self.parse(0, line, f, sp, args)[2]
  4613                                                                   new = self.parse(1, line, f, sp, args)[2]
  4614                                                                   shutil.copy2(old, new)
  4615                                                                   lock.release()
  4616                                                                   return new
  4617                                           
  4618                                                               if objfunc == 'copy2':
  4619                                                                   lock.acquire()
  4620                                                                   old = self.parse(0, line, f, sp, args)[2]
  4621                                                                   new = self.parse(1, line, f, sp, args)[2]
  4622                                                                   shutil.copy2(old, new)
  4623                                                                   lock.release()
  4624                                                                   return new
  4625                                           
  4626                                                               if objfunc == 'copyfile':
  4627                                                                   lock.acquire()
  4628                                                                   old = self.parse(0, line, f, sp, args)[2]
  4629                                                                   new = self.parse(1, line, f, sp, args)[2]
  4630                                                                   shutil.copyfile(old, new)
  4631                                                                   lock.release()
  4632                                                                   return new
  4633                                           
  4634                                                               if objfunc == 'fullpath':
  4635                                                                   lock.acquire()
  4636                                                                   path = self.parse(0, line, f, sp, args)[2]
  4637                                                                   fullpath = os.path.abspath(path)
  4638                                                                   lock.release()
  4639                                                                   return fullpath
  4640                                           
  4641                                                               # moves a file
  4642                                                               if objfunc == 'move':
  4643                                                                   lock.acquire()
  4644                                                                   old = self.parse(0, line, f, sp, args)[2]
  4645                                                                   new = self.parse(1, line, f, sp, args)[2]
  4646                                                                   shutil.move(old, new)
  4647                                                                   lock.release()
  4648                                                                   return new
  4649                                           
  4650                                                               # determines if a file exists
  4651                                                               if objfunc == 'exists':
  4652                                                                   lock.acquire()
  4653                                                                   exists = os.path.exists(
  4654                                                                       self.parse(0, line, f, sp, args)[2])
  4655                                                                   lock.release()
  4656                                                                   return exists
  4657                                           
  4658                                                               # determines if a file is a directory
  4659                                                               if objfunc == 'isdir':
  4660                                                                   lock.acquire()
  4661                                                                   isdir = os.path.isdir(
  4662                                                                       self.parse(0, line, f, sp, args)[2])
  4663                                                                   lock.release()
  4664                                                                   return isdir
  4665                                           
  4666                                                               # determines if a file is a file
  4667                                                               if objfunc == 'isfile':
  4668                                                                   lock.acquire()
  4669                                                                   isfile = os.path.isfile(
  4670                                                                       self.parse(0, line, f, sp, args)[2])
  4671                                                                   lock.release()
  4672                                                                   return isfile
  4673                                           
  4674                                                               # lists files in a directory
  4675                                                               if objfunc == 'listdir':
  4676                                                                   lock.acquire()
  4677                                                                   try:
  4678                                                                       listdir = os.listdir(
  4679                                                                           self.parse(0, line, f, sp, args)[2])
  4680                                                                       lock.release()
  4681                                                                       return listdir
  4682                                                                   except FileNotFoundError:
  4683                                           
  4684                                                                       # directory doesn't exist
  4685                                                                       lock.release()
  4686                                                                       return None
  4687                                           
  4688                                                               # makes a directory
  4689                                                               if objfunc == 'mkdir':
  4690                                                                   lock.acquire()
  4691                                                                   try:
  4692                                                                       made = os.mkdir(self.parse(
  4693                                                                           0, line, f, sp, args)[2])
  4694                                                                       lock.release()
  4695                                                                       return made
  4696                                                                   except FileExistsError:
  4697                                                                       lock.release()
  4698                                                                       return False
  4699                                           
  4700                                                               # removes a directory
  4701                                                               if objfunc == 'rmdir':
  4702                                                                   lock.acquire()
  4703                                                                   try:
  4704                                                                       rm = os.rmdir(self.parse(0, line, f, sp, args)[2])
  4705                                                                       lock.release()
  4706                                                                       return rm
  4707                                                                   except OSError:
  4708                                                                       lock.release()
  4709                                                                       return None
  4710                                           
  4711                                                               # gets the current working directory
  4712                                                               if objfunc == 'getcwd':
  4713                                                                   lock.acquire()
  4714                                                                   cwd = os.getcwd()
  4715                                                                   lock.release()
  4716                                                                   return cwd
  4717                                           
  4718                                                               # gets the size of a file
  4719                                                               if objfunc == 'getsize':
  4720                                                                   lock.acquire()
  4721                                                                   size = os.path.getsize(
  4722                                                                       self.parse(0, line, f, sp, args)[2])
  4723                                                                   lock.release()
  4724                                                                   return size
  4725                                           
  4726                                                               # deletes all files and directories within a directory
  4727                                                               if objfunc == 'emptydir':
  4728                                                                   lock.acquire()
  4729                                                                   directory = self.parse(0, line, f, sp, args)[2]
  4730                                                                   try:
  4731                                                                       for file in os.listdir(directory):
  4732                                                                           try:
  4733                                                                               os.remove(os.path.join(directory, file))
  4734                                                                           except:
  4735                                                                               shutil.rmtree(os.path.join(
  4736                                                                                   directory, file), ignore_errors=True)
  4737                                                                       lock.release()
  4738                                                                       return directory
  4739                                                                   except FileNotFoundError:
  4740                                           
  4741                                                                       # directory doesn't exist
  4742                                                                       lock.release()
  4743                                                                       return None
  4744                                           
  4745                                                           elif func == 'fileacquire':
  4746                                                               lock.acquire()
  4747                                                               return True
  4748                                           
  4749                                                           elif func == 'filerelease':
  4750                                                               lock.release()
  4751                                                               return True
  4752                                           
  4753                                                           # automation operations
  4754                                                           elif obj == 'auto':
  4755                                           
  4756                                                               # gets the largest element from a list of elements
  4757                                                               if objfunc == 'largest':
  4758                                                                   elements = self.parse(0, line, f, sp, args)[2]
  4759                                                                   if not elements:
  4760                                                                       return elements
  4761                                                                   largest = elements[0]
  4762                                                                   for element in elements:
  4763                                                                       try:
  4764                                                                           # element has width and height
  4765                                                                           if element.width() > largest.width() and element.height() > largest.height():
  4766                                                                               largest = element
  4767                                                                       except:
  4768                                                                           # element does not have width and height
  4769                                                                           return element
  4770                                                                   return largest
  4771                                                               return '<msnint2 class>'
  4772                                           
  4773                                                           # # performs math operations
  4774                                                           elif obj == 'math':
  4775                                                               import math
  4776                                           
  4777                                                               if objfunc == 'add':
  4778                                                                   return self.parse(0, line, f, sp, args)[2] + self.parse(1, line, f, sp, args)[2]
  4779                                           
  4780                                                               if objfunc == 'subtract':
  4781                                                                   return self.parse(0, line, f, sp, args)[2] - self.parse(1, line, f, sp, args)[2]
  4782                                           
  4783                                                               if objfunc == 'multiply':
  4784                                                                   return self.parse(0, line, f, sp, args)[2] * self.parse(1, line, f, sp, args)[2]
  4785                                           
  4786                                                               if objfunc == 'divide':
  4787                                                                   return self.parse(0, line, f, sp, args)[2] / self.parse(1, line, f, sp, args)[2]
  4788                                           
  4789                                                               if objfunc == 'power':
  4790                                                                   return self.parse(0, line, f, sp, args)[2] ** self.parse(1, line, f, sp, args)[2]
  4791                                           
  4792                                                               if objfunc == 'root':
  4793                                                                   return self.parse(0, line, f, sp, args)[2] ** (1 / self.parse(1, line, f, sp, args)[2])
  4794                                           
  4795                                                               if objfunc == 'sqrt':
  4796                                                                   return self.parse(0, line, f, sp, args)[2] ** 0.5
  4797                                           
  4798                                                               if objfunc == 'mod':
  4799                                                                   return self.parse(0, line, f, sp, args)[2] % self.parse(1, line, f, sp, args)[2]
  4800                                           
  4801                                                               if objfunc == 'floor':
  4802                                                                   return math.floor(self.parse(0, line, f, sp, args)[2])
  4803                                           
  4804                                                               if objfunc == 'ceil':
  4805                                                                   return math.ceil(self.parse(0, line, f, sp, args)[2])
  4806                                           
  4807                                                               if objfunc == 'round':
  4808                                                                   return round(self.parse(0, line, f, sp, args)[2])
  4809                                           
  4810                                                               if objfunc == 'abs':
  4811                                                                   return abs(self.parse(0, line, f, sp, args)[2])
  4812                                           
  4813                                                               if objfunc == 'sin':
  4814                                                                   return math.sin(self.parse(0, line, f, sp, args)[2])
  4815                                           
  4816                                                               if objfunc == 'cos':
  4817                                                                   return math.cos(self.parse(0, line, f, sp, args)[2])
  4818                                           
  4819                                                               if objfunc == 'tan':
  4820                                                                   return math.tan(self.parse(0, line, f, sp, args)[2])
  4821                                           
  4822                                                               if objfunc == 'asin':
  4823                                                                   return math.asin(self.parse(0, line, f, sp, args)[2])
  4824                                                               return '<msnint2 class>'
  4825                                           
  4826                                                           # inserts a value into the iterable at the specified index
  4827                                                           elif func == 'map':
  4828                                           
  4829                                                               # iterable
  4830                                                               iterable = self.parse(0, line, f, sp, args)[2]
  4831                                           
  4832                                                               # varname
  4833                                                               varname = self.parse(1, line, f, sp, args)[2]
  4834                                           
  4835                                                               # function
  4836                                                               function = args[2][0]
  4837                                           
  4838                                                               # map the function to each element in the iterable
  4839                                                               for i, el in enumerate(iterable):
  4840                                                                   self.vars[varname] = Var(varname, el)
  4841                                                                   iterable[i] = self.interpret(function)
  4842                                                               return iterable
  4843                                           
  4844                                                           # inserts a value into the iterable at the specified index
  4845                                                           elif func == 'insert':
  4846                                                               return self.parse(0, line, f, sp, args)[2].insert(self.parse(1, line, f, sp, args)[2], self.parse(2, line, f, sp, args)[2])
  4847                                           
  4848                                                           # gets the type of the first argument passed
  4849                                                           elif func == 'type':
  4850                                                               return type(self.parse(0, line, f, sp, args)[2])
  4851                                           
  4852                                                           # gets the parent context
  4853                                                           elif func == 'parent':
  4854                                                               return self.parent
  4855                                           
  4856                                                           # gets the booting context
  4857                                                           elif func == 'boot':
  4858                                                               while self.parent != None:
  4859                                                                   self = self.parent
  4860                                                               return self
  4861                                           
  4862                                                           # sets an index of an array
  4863                                                           # first argument is the variable to modify
  4864                                                           # second is the index to modify
  4865                                                           # third argument is the value to set
  4866                                                           elif func == 'set':
  4867                                           
  4868                                                               # obtain varname of array
  4869                                                               varname = self.parse(0, line, f, sp, args)[2]
  4870                                           
  4871                                                               # index to set at
  4872                                                               ind = self.parse(1, line, f, sp, args)[2]
  4873                                           
  4874                                                               # value to set
  4875                                                               val = self.parse(2, line, f, sp, args)[2]
  4876                                           
  4877                                                               # perform set operation
  4878                                                               self.vars[varname].value[ind] = val
  4879                                           
  4880                                                               return val
  4881                                           
  4882                                                           # deletes a variable
  4883                                                           elif func == 'del':
  4884                                                               for i in range(len(args)):
  4885                                                                   line, as_s, first = self.parse(i, line, f, sp, args)
  4886                                                                   del self.vars[first]
  4887                                                               return True
  4888                                           
  4889                                                           # concatinates two strings
  4890                                                           elif func == 'cat':
  4891                                           
  4892                                                               # first argument (required)
  4893                                                               first = self.parse(0, line, f, sp, args)[2]
  4894                                           
  4895                                                               # second argument (required)
  4896                                                               second = self.parse(1, line, f, sp, args)[2]
  4897                                           
  4898                                                               cat = str(first) + str(second)
  4899                                           
  4900                                                               # concatinate rest of arguments
  4901                                                               for i in range(2, len(args)):
  4902                                                                   cat += str(self.parse(i, line, f, sp, args)[2])
  4903                                           
  4904                                                               return cat
  4905                                           
  4906                                                           # determines equality of all arguments
  4907                                                           elif func == 'equals':
  4908                                                               line, as_s, arg1 = self.parse(0, line, f, sp, args)
  4909                                                               for i in range(1, len(args)):
  4910                                                                   line, as_s, curr_arg = self.parse(i, line, f, sp, args)
  4911                                                                   if curr_arg != arg1:
  4912                                                                       return False
  4913                                                               return True
  4914                                           
  4915                                                           # nots a bool
  4916                                                           elif func == 'not':
  4917                                                               return not self.parse(0, line, f, sp, args)[2]
  4918                                           
  4919                                                           # ands two bools
  4920                                                           elif func == 'and':
  4921                                                               first = self.parse(0, line, f, sp, args)[2]
  4922                                                               if not first:
  4923                                                                   return False
  4924                                                               for i in range(1, len(args)):
  4925                                                                   line, as_s, curr_arg = self.parse(i, line, f, sp, args)
  4926                                                                   if not curr_arg:
  4927                                                                       return False
  4928                                                               return True
  4929                                           
  4930                                                           # ors two bools
  4931                                                           elif func == 'or':
  4932                                                               return self.parse(0, line, f, sp, args)[2] or self.parse(1, line, f, sp, args)[2]
  4933                                           
  4934                                                           # comparing numbers
  4935                                                           elif func == 'greater' or func == 'g':
  4936                                                               return self.parse(0, line, f, sp, args)[2] > self.parse(1, line, f, sp, args)[2]
  4937                                                           elif func == 'less' or func == 'l':
  4938                                                               return self.parse(0, line, f, sp, args)[2] < self.parse(1, line, f, sp, args)[2]
  4939                                                           elif func == 'greaterequal' or func == 'ge':
  4940                                                               return self.parse(0, line, f, sp, args)[2] >= self.parse(1, line, f, sp, args)[2]
  4941                                                           elif func == 'lessequal' or func == 'le':
  4942                                                               return self.parse(0, line, f, sp, args)[2] <= self.parse(1, line, f, sp, args)[2]
  4943                                           
  4944                                                           # data structure for holding multiple items
  4945                                                           elif func == 'class':
  4946                                                               # new interpreter
  4947                                                               inter = Interpreter()
  4948                                           
  4949                                                               # log self
  4950                                                               inter.parent = self
  4951                                           
  4952                                                               # extract class name
  4953                                                               name = self.parse(0, line, f, sp, args)[2]
  4954                                           
  4955                                                               # block at which the class exists
  4956                                                               block_s = args[1][0]
  4957                                           
  4958                                                               # execute the block in the private environment
  4959                                                               inter.execute(block_s)
  4960                                           
  4961                                                               # creates a variable out of the new interpreters resources
  4962                                                               obj_to_add = {}
  4963                                                               for varname in inter.vars:
  4964                                                                   val = inter.vars[varname].value
  4965                                                                   obj_to_add[varname] = Var(varname, val)
  4966                                           
  4967                                                               for methodname in inter.methods:
  4968                                                                   obj_to_add[methodname] = Var(
  4969                                                                       methodname + "#method", inter.methods[methodname])
  4970                                           
  4971                                                               self.vars[name] = Var(name, obj_to_add)
  4972                                                               return obj_to_add
  4973                                           
  4974                                                           # gets the first argument at the second argument
  4975                                                           elif func == 'get':
  4976                                                               iterable = self.parse(0, line, f, sp, args)[2]
  4977                                                               index = self.parse(1, line, f, sp, args)[2]
  4978                                                               try:
  4979                                                                   return iterable[index]
  4980                                                               except IndexError:
  4981                                                                   self.err(
  4982                                                                       'Index Error',
  4983                                                                       f'Index out of bounds: {index} (you) > {str(len(iterable))} (max)',
  4984                                                                       line,
  4985                                                                       lines_ran
  4986                                                                   )
  4987                                           
  4988                                                           # get the keys of the first argument
  4989                                                           elif func == 'keys':
  4990                                                               return self.parse(0, line, f, sp, args)[2].keys()
  4991                                           
  4992                                                           # imports resources from another location
  4993                                                           elif func == 'import' or func == 'launch' or func == 'include' or func == 'using':
  4994                                           
  4995                                                               # for each import
  4996                                                               for i in range(len(args)):
  4997                                                                   line, as_s, path = self.parse(i, line, f, sp, args)
  4998                                                                   if not path.endswith('.msn2'):
  4999                                                                       path += '.msn2'
  5000                                                                   if path in self.imports:
  5001                                                                       continue
  5002                                                                   self.imports.add(path)
  5003                                                                   contents = ''
  5004                                                                   with open(path, encoding='utf-8') as f:
  5005                                                                       contents = f.readlines()
  5006                                                                       script = ''
  5007                                                                       for line in contents:
  5008                                                                           script += line
  5009                                                                       self.logg("importing library", str(args[0][0]))
  5010                                                                       self.execute(script)
  5011                                                               return
  5012                                           
  5013                                                           # imports values from an enclosing Python script
  5014                                                           elif func == 'in':
  5015                                                               reserved_name = '_msn2_reserved_in__'
  5016                                                               if reserved_name not in self.vars:
  5017                                                                   return None
  5018                                                               inval = self.vars[reserved_name].value
  5019                                                               # if no arguments, return the value
  5020                                                               if args[0][0] == '':
  5021                                                                   return inval
  5022                                                               # if 1 argument, get index of value from input
  5023                                                               elif len(args) == 1:
  5024                                                                   return inval[self.parse(0, line, f, sp, args)[2]]
  5025                                                               # if 2 arguments, get slice of input
  5026                                                               elif len(args) == 2:
  5027                                                                   start = self.parse(0, line, f, sp, args)[2]
  5028                                                                   end = self.parse(1, line, f, sp, args)[2]
  5029                                                                   return inval[start:end]
  5030                                                               return inval
  5031                                           
  5032                                                           # exports values to an enclosing Python script
  5033                                                           elif func == 'out':
  5034                                           
  5035                                                               # variables to output
  5036                                                               outting = []
  5037                                           
  5038                                                               # for each argument
  5039                                                               for i in range(len(args)):
  5040                                                                   outting.append(self.parse(i, line, f, sp, args)[2])
  5041                                           
  5042                                                               _out = '_msn2_reserved_out__'
  5043                                                               # create a variable for the enclosing Python script
  5044                                                               # to access
  5045                                                               self.vars[_out] = Var(_out, outting)
  5046                                           
  5047                                                               # return outting
  5048                                                               return outting
  5049                                           
  5050                                                           # interpreter printing mechanism
  5051                                                           elif func == 'prnt':
  5052                                                               for i in range(len(args)):
  5053                                                                   arguments = args[i]
  5054                                                                   first = self.interpret(arguments[0])
  5055                                                                   srep = str(first)
  5056                                                                   line = line[:f + sp + arguments[1] + 1] + \
  5057                                                                       srep + line[f + sp + arguments[2] + 1:]
  5058                                                                   if i != len(args) - 1:
  5059                                                                       self.out += srep + ' '
  5060                                                                   else:
  5061                                                                       self.out += srep + '\n'
  5062                                                               return first
  5063                                           
  5064                                                           # python print
  5065                                                           elif func == 'print':
  5066                                                               ret = None
  5067                                                               for i in range(len(args)):
  5068                                                                   ret = self.parse(i, line, f, sp, args)[2]
  5069                                                                   if i != len(args) - 1:
  5070                                                                       print(ret, end=" ", flush=True)
  5071                                                                   else:
  5072                                                                       print(ret, flush=True)
  5073                                                               return ret
  5074                                           
  5075                                                           # print a box with Interpreter.bordered()
  5076                                                           # to get a string representation of the current argument
  5077                                                           # surrounded by a box
  5078                                                           elif func == 'print:box':
  5079                                                               ret = None
  5080                                                               for i in range(len(args)):
  5081                                                                   ret = self.parse(i, line, f, sp, args)[2]
  5082                                                                   if i != len(args) - 1:
  5083                                                                       print(Interpreter.bordered(
  5084                                                                           str(ret)), end=" ", flush=True)
  5085                                                                   else:
  5086                                                                       print(Interpreter.bordered(str(ret)), flush=True)
  5087                                                               return ret
  5088                                           
  5089                                                           # prints with styled colors
  5090                                                           # use self.styled_print() to print
  5091                                                           elif func == 'print:color':
  5092                                           
  5093                                                               # obtain a list of each argument
  5094                                                               print_args = [self.parse(i, line, f, sp, args)[
  5095                                                                   2] for i in range(len(args))]
  5096                                                               # print each argument
  5097                                                               return self.styled_print(print_args)
  5098                                           
  5099                                                           # sleeps the thread for the first argument amount of seconds
  5100                                                           elif func == "sleep":
  5101                                                               import time
  5102                                                               return time.sleep(self.parse(0, line, f, sp, args)[2])
  5103                                           
  5104                                                           # returns this interpreter
  5105                                                           elif func == 'me':
  5106                                                               return self.me()
  5107                                           
  5108                                                           # provides a representation of the current environment
  5109                                                           elif func == 'env':
  5110                                                               should_print_s = args[0][0]
  5111                                                               line, should_print = self.convert_arg(
  5112                                                                   should_print_s, line, f, sp, args)
  5113                                                               strenv = ''
  5114                                                               strenv += "--------- environment ---------"
  5115                                                               strenv += "\nout:\n" + self.out
  5116                                                               strenv += "\nvariables:\n"
  5117                                                               for varname, v in self.vars.items():
  5118                                                                   try:
  5119                                                                       strenv += "\t" + varname + \
  5120                                                                           " = " + str(v.value) + '\n'
  5121                                                                   except:
  5122                                                                       None
  5123                                           
  5124                                                               strenv += "\nmethods:\n"
  5125                                                               # printing methods
  5126                                                               for methodname, Method in self.methods.items():
  5127                                                                   strenv += "\t" + methodname + "("
  5128                                                                   for i in range(len(Method.args)):
  5129                                                                       arg = Method.args[i]
  5130                                                                       if i != len(Method.args) - 1:
  5131                                                                           strenv += "" + str(arg) + ", "
  5132                                                                       else:
  5133                                                                           strenv += "" + str(arg)
  5134                                                                   # add body line count
  5135                                                                   strenv += ") : " + str(len(Method.body)) + " inst\n"
  5136                                           
  5137                                                               # printing macros
  5138                                                               strenv += "\nmacros:\n\t"
  5139                                           
  5140                                                               # adding regular macros
  5141                                                               if len(macros) > 0:
  5142                                                                   strenv += "premacros:\n\t\t"
  5143                                                                   for macro in macros:
  5144                                                                       strenv += macro + "\n\t\t"
  5145                                           
  5146                                                               if len(postmacros) > 0:
  5147                                                                   strenv += "\n\tpostmacros:\n\t\t"
  5148                                                                   for macro in postmacros:
  5149                                                                       strenv += macro + "\n\t\t"
  5150                                           
  5151                                                               if len(syntax) > 0:
  5152                                                                   strenv += "\n\tsyntax:\n\t\t"
  5153                                                                   for macro in syntax:
  5154                                                                       strenv += macro + "\n\t\t"
  5155                                           
  5156                                                               if len(enclosed) > 0:
  5157                                                                   strenv += "\n\tenclosedsyntax:\n\t\t"
  5158                                                                   for macro in enclosed:
  5159                                                                       strenv += macro + "\n\t\t"
  5160                                           
  5161                                                               strenv += "\nlog:\n" + self.log
  5162                                                               strenv += "\n-------------------------------"
  5163                                                               if should_print:
  5164                                                                   print(strenv)
  5165                                                               return strenv
  5166                                           
  5167                                                           # arithmetic, equivalent to the op class
  5168                                           
  5169                                                           # executes MSNScript2 from its string representation
  5170                                           
  5171                                                           elif func == '-':
  5172                                                               if len(args) == 1:
  5173                                                                   return self.interpret(self.parse(0, line, f, sp, args)[2])
  5174                                           
  5175                                                               # subtracts all arguments from the first argument
  5176                                                               else:
  5177                                                                   ret = self.parse(0, line, f, sp, args)[2]
  5178                                                                   for i in range(1, len(args)):
  5179                                                                       ret -= self.parse(i, line, f, sp, args)[2]
  5180                                                                   return ret
  5181                                                           elif func == '+':
  5182                                                               ret = self.parse(0, line, f, sp, args)[2]
  5183                                                               for i in range(1, len(args)):
  5184                                                                   ret += self.parse(i, line, f, sp, args)[2]
  5185                                                               return ret
  5186                                                           elif func == 'x':
  5187                                                               ret = self.parse(0, line, f, sp, args)[2]
  5188                                                               for i in range(1, len(args)):
  5189                                                                   ret *= self.parse(i, line, f, sp, args)[2]
  5190                                                               return ret
  5191                                                           elif func == '/':
  5192                                                               ret = self.parse(0, line, f, sp, args)[2]
  5193                                                               for i in range(1, len(args)):
  5194                                                                   ret /= self.parse(i, line, f, sp, args)[2]
  5195                                                               return ret
  5196                                                           elif func == '//':
  5197                                                               ret = self.parse(0, line, f, sp, args)[2]
  5198                                                               for i in range(1, len(args)):
  5199                                                                   ret //= self.parse(i, line, f, sp, args)[2]
  5200                                                               return ret
  5201                                                           elif func == '%':
  5202                                                               ret = self.parse(0, line, f, sp, args)[2]
  5203                                                               for i in range(1, len(args)):
  5204                                                                   ret %= self.parse(i, line, f, sp, args)[2]
  5205                                                               return ret
  5206                                                           elif func == '^':
  5207                                                               ret = self.parse(0, line, f, sp, args)[2]
  5208                                                               for i in range(1, len(args)):
  5209                                                                   ret **= self.parse(i, line, f, sp, args)[2]
  5210                                                               return ret
  5211                                           
  5212                                                           # determines if a string is a digit
  5213                                                           elif func == 'isdigit':
  5214                                                               return self.parse(0, line, f, sp, args)[2].isdigit()
  5215                                                           # determines if a string is alpha
  5216                                                           elif func == 'isalpha':
  5217                                                               return self.parse(0, line, f, sp, args)[2].isalpha()
  5218                                           
  5219                                                           # does something with a value as a temporary
  5220                                                           # variable
  5221                                                           elif func == 'as':
  5222                                           
  5223                                                               # temporary variable name
  5224                                                               varname = self.parse(0, line, f, sp, args)[2]
  5225                                           
  5226                                                               # value to set
  5227                                                               val = self.parse(1, line, f, sp, args)[2]
  5228                                           
  5229                                                               # block to execute
  5230                                                               block = args[2][0]
  5231                                           
  5232                                                               # set the variable
  5233                                                               self.vars[varname] = Var(varname, val)
  5234                                           
  5235                                                               # execute the block
  5236                                                               ret = self.interpret(block)
  5237                                           
  5238                                                               # delete the variable
  5239                                                               del self.vars[varname]
  5240                                           
  5241                                                               return ret
  5242                                           
  5243                                                           # strips a str
  5244                                                           elif func == 'strip':
  5245                                                               return self.parse(0, line, f, sp, args)[2].strip()
  5246                                           
  5247                                                           # gets a slice
  5248                                                           elif func == 'slice':
  5249                                                               return self.parse(0, line, f, sp, args)[2][self.parse(1, line, f, sp, args)[2]:self.parse(2, line, f, sp, args)[2]]
  5250                                           
  5251                                                           # joins a str
  5252                                                           elif func == 'array:join':
  5253                                                               return self.parse(1, line, f, sp, args)[2].join(self.parse(0, line, f, sp, args)[2])
  5254                                           
  5255                                                           # returns the MSNScript2 passed as a string
  5256                                                           elif func == 'async' or func == 'script' or func == 'HTML':
  5257                                                               # inserts key tokens
  5258                                                               return self.msn2_replace(args[0][0])
  5259                                           
  5260                                                           # gets the current time
  5261                                                           elif func == 'now':
  5262                                                               import time
  5263                                                               return time.time()
  5264                                           
  5265                                                           # creates a private execution enviroment
  5266                                                           # private block will have read access to the enclosing Interpreter's
  5267                                                           # variables and methods
  5268                                                           elif func == 'private' or func == 'inherit:all':
  5269                                                               block_s = args[0][0]
  5270                                                               inter = Interpreter()
  5271                                                               inter.parent = self
  5272                                                               for vname, entry in self.vars.items():
  5273                                                                   try:
  5274                                                                       inter.vars[vname] = Var(vname, entry.value)
  5275                                                                   except:
  5276                                                                       inter.vars[vname] = Var(vname, entry)
  5277                                                               for mname, entry in self.methods.items():
  5278                                                                   inter.methods[mname] = entry
  5279                                                               return inter.interpret(block_s)
  5280                                           
  5281                                                           # breaks out of the working context
  5282                                                           elif func == 'break':
  5283                                                               self.breaking = True
  5284                                                               return
  5285                                           
  5286                                                           # reverses the first argument
  5287                                                           elif func == 'reverse':
  5288                                                               return self.parse(0, line, f, sp, args)[2][::-1]
  5289                                           
  5290                                                           # performs upper()
  5291                                                           elif func == 'upper':
  5292                                                               return self.parse(0, line, f, sp, args)[2].upper()
  5293                                           
  5294                                                           # performs lower()
  5295                                                           elif func == 'lower':
  5296                                                               return self.parse(0, line, f, sp, args)[2].lower()
  5297                                           
  5298                                                           # performs title()
  5299                                                           elif func == 'title':
  5300                                                               return self.parse(0, line, f, sp, args)[2].title()
  5301                                           
  5302                                                           # inherits methods only from the parent context
  5303                                                           elif func == 'inherit:methods':
  5304                                                               for methodname in self.parent.methods:
  5305                                                                   self.methods[methodname] = self.parent.methods[methodname]
  5306                                                               return True
  5307                                           
  5308                                                           # inherits variables from parent context
  5309                                                           elif func == 'inherit:vars':
  5310                                                               for varname in self.parent.vars:
  5311                                                                   self.vars[varname] = self.parent.vars[varname]
  5312                                                               return True
  5313                                           
  5314                                                           # inherits a single variable or function
  5315                                                           elif func == 'inherit:single':
  5316                                                               name = self.parse(0, line, f, sp, args)[2]
  5317                                                               if name in self.parent.vars:
  5318                                                                   self.vars[name] = self.parent.vars[name]
  5319                                                               elif name in self.parent.methods:
  5320                                                                   self.methods[name] = self.parent.methods[name]
  5321                                                               return True
  5322                                           
  5323                                                           # creates a new execution environment
  5324                                                           # new env is executed by a fresh interpreter
  5325                                                           # nothing is inherited from parent context
  5326                                                           elif func == 'new' or func == 'inherit:none':
  5327                                                               inter = Interpreter()
  5328                                                               inter.parent = self
  5329                                                               return inter.interpret(args[0][0])
  5330                                           
  5331                                                           # sets the python alias
  5332                                                           # until the program stops
  5333                                                           elif func == 'alias':
  5334                                                               python_alias = self.parse(0, line, f, sp, args)[2]
  5335                                                               return python_alias
  5336                                           
  5337                                                           # starts a new process with the first argument as the target
  5338                                                           elif func == 'process':
  5339                                           
  5340                                                               # path to the process to run
  5341                                                               path = self.parse(0, line, f, sp, args)[2]
  5342                                           
  5343                                                               # if windows:
  5344                                                               if os.name == 'nt':
  5345                                                                   import subprocess
  5346                                                                   # runs the process
  5347                                                                   sub = subprocess.run(
  5348                                                                       args=[python_alias, 'msn2.py', path], shell=True)
  5349                                                                   self.processes[path] = sub
  5350                                                                   return sub
  5351                                           
  5352                                                               # if linux
  5353                                                               elif os.name == 'posix':
  5354                                                                   print('[-] posix not supported yet')
  5355                                                                   return None
  5356                                                               return None
  5357                                           
  5358                                                           # starts a process via MSN2 code
  5359                                                           elif func == 'proc':
  5360                                           
  5361                                                               # name of the process
  5362                                                               name = self.parse(0, line, f, sp, args)[2]
  5363                                           
  5364                                                               # block for the process
  5365                                                               block = args[1][0]
  5366                                           
  5367                                                               # import the processes library and
  5368                                                               # create a new process
  5369                                                               return self.interpret(f"(import('lib/processes'),fork('{name}', async({block})))")
  5370                                           
  5371                                                           # gets the pid of the working process
  5372                                                           elif func == 'pid':
  5373                                                               return os.getpid()
  5374                                           
  5375                                                           # creates a new thread to execute the block, thread
  5376                                                           # starts on the same interpreter
  5377                                                           elif func == "thread":
  5378                                           
  5379                                                               # name not provided
  5380                                                               if len(args) == 1:
  5381                                                                   global thread_serial
  5382                                                                   name = f"__msn2_thread_id_{thread_serial}"
  5383                                                                   block = args[0][0]
  5384                                                               # name provided (2 arguments provided)
  5385                                                               else:
  5386                                                                   name = self.parse(0, line, f, sp, args)[2]
  5387                                                                   block = args[1][0]
  5388                                                               thread = threading.Thread(
  5389                                                                   target=self.interpret, args=(block,))
  5390                                                               thread.name = name
  5391                                                               self.threads[name] = [thread, self]
  5392                                                               thread.start()
  5393                                                               return True
  5394                                           
  5395                                                           # creates a thread pool to execute the block
  5396                                                           elif func == "threadpool":
  5397                                                               import concurrent.futures
  5398                                                               # get the amount of threads to create
  5399                                                               thread_count = self.parse(0, line, f, sp, args)[2]
  5400                                                               # get the block to execute
  5401                                                               block = args[1][0]
  5402                                                               # create the thread pool
  5403                                                               pool = concurrent.futures.ThreadPoolExecutor(thread_count)
  5404                                                               # submit the block to the pool
  5405                                                               pool.submit(self.interpret, block)
  5406                                                               return True
  5407                                           
  5408                                                           # creates or edits thread variable
  5409                                                           elif func == 'tvar':
  5410                                           
  5411                                                               # thread name
  5412                                                               name = str(self.parse(0, line, f, sp, args)[2])
  5413                                           
  5414                                                               # variable name
  5415                                                               varname = str(self.parse(1, line, f, sp, args)[2])
  5416                                           
  5417                                                               # variable value
  5418                                                               val = self.parse(2, line, f, sp, args)[2]
  5419                                           
  5420                                                               # thread var name
  5421                                                               tvarname = f"_msn2_tvar_{name}_{varname}"
  5422                                           
  5423                                                               # sets a thread specific variable
  5424                                                               self.vars[tvarname] = Var(varname, val)
  5425                                                               return val
  5426                                           
  5427                                                           # gets a thread variable
  5428                                                           elif func == 'gettvar':
  5429                                           
  5430                                                               # thread name
  5431                                                               name = str(self.parse(0, line, f, sp, args)[2])
  5432                                           
  5433                                                               # variable name
  5434                                                               varname = str(self.parse(1, line, f, sp, args)[2])
  5435                                           
  5436                                                               # thread var name
  5437                                                               tvarname = f"_msn2_tvar_{name}_{varname}"
  5438                                           
  5439                                                               # gets the variable
  5440                                                               return self.vars[tvarname].value
  5441                                           
  5442                                                           # creates a string variable name for functions
  5443                                                           # that require a string variable name
  5444                                                           elif func == 'tvarstr':
  5445                                           
  5446                                                               # thread name
  5447                                                               name = str(self.parse(0, line, f, sp, args)[2])
  5448                                           
  5449                                                               # variable name
  5450                                                               varname = str(self.parse(1, line, f, sp, args)[2])
  5451                                           
  5452                                                               # returns the string
  5453                                                               return f"_msn2_tvar_{name}_{varname}"
  5454                                           
  5455                                                           # interprets a variable by variable name
  5456                                                           # a and a variable method
  5457                                                           elif func == 'varmethod':
  5458                                           
  5459                                                               # variable name
  5460                                                               varname = str(self.parse(0, line, f, sp, args)[2])
  5461                                           
  5462                                                               # method block
  5463                                                               block = args[1][0]
  5464                                           
  5465                                                               return self.interpret(f"{varname}.{block}")
  5466                                           
  5467                                                           # acquires the global lock
  5468                                                           elif func == 'acquire':
  5469                                                               return auxlock.acquire()
  5470                                           
  5471                                                           # releases the global lock
  5472                                                           elif func == 'release':
  5473                                                               return auxlock.release()
  5474                                           
  5475                                                           # acquires the pointer lock
  5476                                                           elif func == 'acquire:pointer':
  5477                                                               return pointer_lock.acquire()
  5478                                                           elif func == 'release:pointer':
  5479                                                               return pointer_lock.release()
  5480                                           
  5481                                                           # joins the current working thread with the thread name specified
  5482                                                           elif func == 'join':
  5483                                           
  5484                                                               for i in range(len(args)):
  5485                                                                   name = self.parse(i, line, f, sp, args)[2]
  5486                                                                   thread = self.thread_by_name(name)
  5487                                                                   while thread == None:
  5488                                                                       None
  5489                                                                   thread.join()
  5490                                                               return True
  5491                                           
  5492                                                           # exits the working thread
  5493                                                           elif func == 'stop':
  5494                                                               return os._exit(0)
  5495                                           
  5496                                                           # tries the first argument, if it fails, code falls to the catch/except block
  5497                                                           # there is no finally implementation
  5498                                                           elif func == 'try':
  5499                                                               ret = None
  5500                                                               self.trying = True
  5501                                                               try:
  5502                                                                   ret = self.interpret(args[0][0])
  5503                                                               except:
  5504                                                                   self.trying = False
  5505                                                                   try:
  5506                                                                       catch_block = args[1][0]
  5507                                                                       ret = self.interpret(catch_block)
  5508                                                                   except:
  5509                                                                       ...
  5510                                                               self.trying = False
  5511                                                               return ret
  5512                                           
  5513                                                           # waits for a certain condition to be true
  5514                                                           elif func == 'wait':
  5515                                                               ret = None
  5516                                                               # no block per tick provided
  5517                                                               if len(args) == 1:
  5518                                                                   while not (ret := self.interpret(args[0][0])):
  5519                                                                       None
  5520                                           
  5521                                                               # block provided
  5522                                                               elif len(args) == 2:
  5523                                                                   while not (ret := self.interpret(args[0][0])):
  5524                                                                       self.interpret(args[1][0])
  5525                                           
  5526                                                               # block with tick provided
  5527                                                               elif len(args) == 3:
  5528                                                                   import time
  5529                                                                   s = self.parse(2, line, f, sp, args)[2]
  5530                                                                   while not (ret := self.interpret(args[0][0])):
  5531                                                                       self.interpret(args[1][0])
  5532                                                                       time.sleep(s)
  5533                                                               return ret
  5534                                           
  5535                                                           # performs a an action every certain amount of seconds
  5536                                                           # where the amount of seconds is the first argument
  5537                                                           # the block is the second argument
  5538                                                           # third argument is optional, and is the amount of seconds
  5539                                                           # the interval should last for, if not provided, the interval
  5540                                                           # will last forever
  5541                                                           if func == 'interval':
  5542                                                               import time
  5543                                           
  5544                                                               # amount of seconds
  5545                                                               seconds = self.parse(0, line, f, sp, args)[2]
  5546                                           
  5547                                                               # block to execute
  5548                                                               block = args[1][0]
  5549                                           
  5550                                                               # if the interval should last for a certain amount of seconds
  5551                                                               # should account for the first argument to correctly wait
  5552                                                               if len(args) == 3:
  5553                                           
  5554                                                                   extra = self.parse(2, line, f, sp, args)[2]
  5555                                           
  5556                                                                   # if time is negative, we set it to infinity
  5557                                                                   if extra == -1:
  5558                                                                       extra = float('inf')
  5559                                           
  5560                                                                   end = time.time() + extra
  5561                                                                   while time.time() < end:
  5562                                                                       time.sleep(seconds)
  5563                                                                       self.interpret(block)
  5564                                           
  5565                                                               else:
  5566                                                                   while True:
  5567                                                                       time.sleep(seconds)
  5568                                                                       self.interpret(block)
  5569                                           
  5570                                                           # exports a quantity of variables or methods from the working context to the parent context,
  5571                                                           # ex private context -> boot context
  5572                                                           elif func == 'export':
  5573                                           
  5574                                                               # if last argument is True,
  5575                                                               # we add the variables to the parent context's variable
  5576                                                               last_arg = self.parse(len(args) - 1, line, f, sp, args)[2]
  5577                                           
  5578                                                               for i in range(len(args)):
  5579                                                                   varname = self.parse(i, line, f, sp, args)[2]
  5580                                                                   if varname in self.vars:
  5581                                                                       if isinstance(last_arg, bool):
  5582                                                                           # if self.vars[varname].value is any type of number
  5583                                                                           if isinstance(self.vars[varname].value, (int, float, complex)):
  5584                                                                               self.parent.vars[varname].value += self.vars[varname].value
  5585                                                                           # otherwise add every element to the parent context's variable
  5586                                                                           elif isinstance(self.vars[varname].value, list):
  5587                                                                               for element in self.vars[varname].value:
  5588                                                                                   self.parent.vars[varname].value.append(
  5589                                                                                       element)
  5590                                                                       else:
  5591                                                                           self.parent.vars[varname] = self.vars[varname]
  5592                                                                   elif varname in self.methods:
  5593                                                                       self.parent.methods[varname] = self.methods[varname]
  5594                                                               return True
  5595                                           
  5596                                                           # exports a single value as the variable name
  5597                                                           # first argument is the new variable name
  5598                                                           # second is the value to export
  5599                                                           elif func == 'exportas':
  5600                                           
  5601                                                               # variable name
  5602                                                               varname = self.parse(0, line, f, sp, args)[2]
  5603                                           
  5604                                                               # value
  5605                                                               val = self.parse(1, line, f, sp, args)[2]
  5606                                           
  5607                                                               # export to parent context
  5608                                                               self.parent.vars[varname] = Var(varname, val)
  5609                                                               return val
  5610                                           
  5611                                                           # exports all variables and methods to the parent context
  5612                                                           elif func == 'exportall':
  5613                                                               for varname in self.vars:
  5614                                                                   self.parent.vars[varname] = self.vars[varname]
  5615                                                               for methodname in self.methods:
  5616                                                                   self.parent.methods[methodname] = self.methods[methodname]
  5617                                                               return True
  5618                                           
  5619                                                           # sends a command to the console, console type depends on
  5620                                                           # executors software of course
  5621                                                           elif func == 'console':
  5622                                                               # os.system all arguments,
  5623                                                               # returns the console output
  5624                                                               # of the last argument
  5625                                                               ret = None
  5626                                                               for i in range(len(args)):
  5627                                                                   ret = os.system(self.parse(i, line, f, sp, args)[2])
  5628                                                               return ret
  5629                                                           # Execute the command and capture the output
  5630                                                           # only takes one argument
  5631                                                           elif func == 'console:read':
  5632                                                               import subprocess
  5633                                                               # returns the console output
  5634                                                               # of the last argument
  5635                                                               process = subprocess.run(self.parse(0, line, f, sp, args)[
  5636                                                                                        2], shell=True, capture_output=True, text=True, encoding='utf-8')
  5637                                                               if process.returncode == 0:
  5638                                                                   return process.stdout
  5639                                                               else:
  5640                                                                   return process.stderr
  5641                                           
  5642                                                           # performs a get request to an http server
  5643                                                           # first parameter is the URL
  5644                                                           # second parameter is a map of parameters to sent as a request
  5645                                                           elif func == 'request':
  5646                                                               import requests
  5647                                                               # get URL to request from
  5648                                                               url = self.parse(0, line, f, sp, args)[2]
  5649                                           
  5650                                                               try:
  5651                                                                   # get parameters
  5652                                                                   params = self.parse(1, line, f, sp, args)[2]
  5653                                                               except:
  5654                                                                   params = None
  5655                                           
  5656                                                               response = requests.get(url=url, params=params)
  5657                                           
  5658                                                               # return response
  5659                                                               return response.json()
  5660                                           
  5661                                                           # requires thread-safe context, see /demos/protected.msn2
  5662                                                           # simulates returning of the function currently running
  5663                                                           # should be used cautiously, if you dont know whether to use return() or var()
  5664                                                           # to return a value, use var()
  5665                                                           elif func == 'return':
  5666                                                               method = self.methods[self.loggedmethod[-1]]
  5667                                           
  5668                                                               # evaluate returning literal
  5669                                                               line, as_s, ret = self.parse(0, line, f, sp, args)
  5670                                           
  5671                                                               # set return variable
  5672                                                               ret_name = method.returns[0]
  5673                                           
  5674                                                               # if not a variable
  5675                                                               if ret_name not in self.vars:
  5676                                                                   self.vars[ret_name] = Var(ret_name, None)
  5677                                           
  5678                                                               self.vars[ret_name].value = ret
  5679                                                               return ret
  5680                                           
  5681                                                           # gets the public IP address of the machine
  5682                                                           elif func == 'pubip':
  5683                                                               import requests
  5684                                                               # asks an api server for this address
  5685                                                               return requests.get('https://api.ipify.org').text
  5686                                           
  5687                                                           # gets the private ips of this machine
  5688                                                           elif func == 'privips':
  5689                                                               import socket
  5690                                                               return socket.gethostbyname_ex(socket.gethostname())[2]
  5691                                           
  5692                                                           # starts an api endpoint
  5693                                                           elif func == 'ENDPOINT':
  5694                                           
  5695                                                               # imports
  5696                                                               from flask import Flask
  5697                                                               from flask_restful import Api
  5698                                                               import logging
  5699                                           
  5700                                                               # initial API endpoint data
  5701                                                               path = None
  5702                                                               init_data = {}
  5703                                                               port = 5000
  5704                                                               host = '127.0.0.1'
  5705                                                               last_arg = None
  5706                                           
  5707                                                               # 1 argument, defaults to 127.0.0.1:5000/path = {}
  5708                                                               if len(args) == 1:
  5709                                           
  5710                                                                   # path to endpoint
  5711                                                                   path = self.parse(0, line, f, sp, args)[2]
  5712                                                                   last_arg = path
  5713                                           
  5714                                                               # 2 arguments, defaults to 127.0.0.1:5000/path = init_data
  5715                                                               elif len(args) == 2:
  5716                                           
  5717                                                                   # path to endpoint
  5718                                                                   path = self.parse(0, line, f, sp, args)[2]
  5719                                           
  5720                                                                   # json to initialize at the endpoint
  5721                                                                   init_data = self.parse(1, line, f, sp, args)[2]
  5722                                           
  5723                                                                   last_arg = init_data
  5724                                           
  5725                                                               # 3 arguments, defaults to host:port/path = init_data
  5726                                                               else:
  5727                                           
  5728                                                                   # host to endpoint as first argument
  5729                                                                   host = self.parse(0, line, f, sp, args)[2]
  5730                                           
  5731                                                                   # port to endpoint as second argument
  5732                                                                   port = self.parse(1, line, f, sp, args)[2]
  5733                                           
  5734                                                                   # path to endpoint
  5735                                                                   path = self.parse(2, line, f, sp, args)[2]
  5736                                           
  5737                                                                   # json to initialize at the endpoint
  5738                                                                   init_data = self.parse(3, line, f, sp, args)[2]
  5739                                           
  5740                                                                   last_arg = init_data
  5741                                                                   if len(args) == 5:
  5742                                                                       last_arg = self.parse(4, line, f, sp, args)[2]
  5743                                           
  5744                                                               # prepare endpoint
  5745                                                               print('serving on http://' + host + ':' + str(port) + path)
  5746                                                               app = Flask(__name__)
  5747                                                               cors = False
  5748                                                               # if the last argument is a string with 'CORS' in it
  5749                                                               # then enable CORS
  5750                                                               if isinstance(last_arg, str) and 'CORS' in last_arg:
  5751                                                                   from flask_cors import CORS
  5752                                                                   # enable CORS
  5753                                                                   print('starting with cors')
  5754                                                                   cors = True
  5755                                                                   CORS(app)
  5756                                           
  5757                                                               # disable flask messages that aren't error-related
  5758                                                               log = logging.getLogger('werkzeug')
  5759                                                               log.disabled = True
  5760                                                               app.logger.disabled = True
  5761                                           
  5762                                                               # gets Flask Api
  5763                                                               api = Api(app)
  5764                                                               
  5765                                                               # api endpoint class
  5766                                                               class EndPoint(Resource):
  5767                                           
  5768                                                                   @classmethod
  5769                                                                   def make_api(cls, response):
  5770                                                                       cls.response = response
  5771                                                                       return cls
  5772                                           
  5773                                                                   # GET
  5774                                                                   def get(self):
  5775                                                                       return self.response
  5776                                           
  5777                                                                   # POST
  5778                                                                   def post(self):
  5779                                                                       from flask import request
  5780                                                                       # obtains current endpoint data
  5781                                                                       current_data = self.response
  5782                                           
  5783                                                                       # updates current data with data to post
  5784                                                                       current_data.update(request.get_json())
  5785                                           
  5786                                                                       # updates next response
  5787                                                                       self.make_api(current_data)
  5788                                                                       return current_data
  5789                                           
  5790                                                                   # DELETE
  5791                                                                   def delete(self):
  5792                                                                       self.make_api({})
  5793                                                                       return self.response
  5794                                                               
  5795                                                               curr_endpoint = EndPoint.make_api(init_data)
  5796                                           
  5797                                                               # logs newly created endpoint
  5798                                                               self.endpoints[path] = api
  5799                                           
  5800                                                               # adds class EndPoint as a Resource to the Api with the specific path
  5801                                                               # passes arg2 alongside
  5802                                                               api.add_resource(curr_endpoint, path)
  5803                                           
  5804                                                               # starting flask server
  5805                                                               try:
  5806                                           
  5807                                                                   # if internal
  5808                                                                   app.run(host=host, port=port,
  5809                                                                           debug=False, use_reloader=False)
  5810                                           
  5811                                                               except:
  5812                                                                   # if external
  5813                                                                   try:
  5814                                                                       if __name__ == '__main__':
  5815                                                                           app.run(host='0.0.0.0', port=port,
  5816                                                                                   debug=False, use_reloader=False)
  5817                                                                   except:
  5818                                                                       None
  5819                                                               return api
  5820                                           
  5821                                                           # posts to an api endpoint
  5822                                                           elif func == 'POST':
  5823                                                               import requests
  5824                                           
  5825                                                               # url to post to, defaults to localhost
  5826                                                               host = self.parse(0, line, f, sp, args)[2]
  5827                                           
  5828                                                               # port to post to
  5829                                                               port = self.parse(1, line, f, sp, args)[2]
  5830                                           
  5831                                                               # path after url
  5832                                                               path = self.parse(2, line, f, sp, args)[2]
  5833                                           
  5834                                                               # data to post
  5835                                                               data = self.parse(3, line, f, sp, args)[2]
  5836                                           
  5837                                                               # if local network
  5838                                                               if host == '0.0.0.0':
  5839                                                                   response = requests.post(
  5840                                                                       url=('http://127.0.0.1:' + str(port) + path), json=data)
  5841                                           
  5842                                                               # if localhost
  5843                                                               else:
  5844                                                                   # post to endpoint
  5845                                                                   response = requests.post(
  5846                                                                       url=('http://' + host + ':' + str(port) + path), json=data)
  5847                                           
  5848                                                               # get response
  5849                                                               return response.json()
  5850                                           
  5851                                                           # gets from an api endpoint
  5852                                                           elif func == 'GET':
  5853                                                               import requests
  5854                                                               # url to get from, defaults to localhost
  5855                                                               host = self.parse(0, line, f, sp, args)[2]
  5856                                           
  5857                                                               # port to get from
  5858                                                               port = self.parse(1, line, f, sp, args)[2]
  5859                                           
  5860                                                               # path after url
  5861                                                               path = self.parse(2, line, f, sp, args)[2]
  5862                                           
  5863                                                               # if local network
  5864                                                               if host == '0.0.0.0':
  5865                                                                   return requests.get(url=('http://127.0.0.1:' + str(port) + path)).json()
  5866                                           
  5867                                                               # if localhost
  5868                                                               else:
  5869                                                                   return requests.get(url=('http://' + host + ':' + str(port) + path)).json()
  5870                                           
  5871                                                           # deletes from an api endpoint
  5872                                                           elif func == 'DELETE':
  5873                                                               import requests
  5874                                                               # url to delete from, defaults to localhost
  5875                                                               host = self.parse(0, line, f, sp, args)[2]
  5876                                           
  5877                                                               # port to delete from
  5878                                                               port = self.parse(1, line, f, sp, args)[2]
  5879                                           
  5880                                                               # path after url
  5881                                                               path = self.parse(2, line, f, sp, args)[2]
  5882                                           
  5883                                                               if host == '0.0.0.0':
  5884                                                                   response = requests.delete(
  5885                                                                       url=('http://127.0.0.1:' + str(port) + path))
  5886                                                               else:
  5887                                                                   # delete from endpoint
  5888                                                                   response = requests.delete(
  5889                                                                       url=('http://' + host + ':' + str(port) + path))
  5890                                           
  5891                                                               return response.json()
  5892                                           
  5893                                                           # determines if the system is windows or not
  5894                                                           elif func == 'windows':
  5895                                                               return os.name == 'nt'
  5896                                           
  5897                                                           # determines if system is linux
  5898                                                           elif func == 'linux':
  5899                                                               return os.name == 'posix'
  5900                                           
  5901                                                           # determines if system is mac
  5902                                                           elif func == 'mac':
  5903                                                               import sys
  5904                                                               return sys.platform == 'darwin'
  5905                                           
  5906                                                           # simulates function closure
  5907                                                           elif func == 'end':
  5908                                                               method = self.methods[self.loggedmethod[-1]]
  5909                                                               self.loggedmethod.pop()
  5910                                                               method.ended = True
  5911                                                               return True
  5912                                           
  5913                                                           # gets the value from a Var object
  5914                                                           elif func == 'static':
  5915                                                               return self.parse(0, line, f, sp, args)[2].value
  5916                                           
  5917                                                           # object instance requested
  5918                                                           # if the function is in the variables
  5919                                                           # and the variable is a class
  5920                                                           elif func in self.vars and isinstance(self.vars[func].value, dict):
  5921                                           
  5922                                                               # get classname to create
  5923                                                               classname = func
  5924                                           
  5925                                                               # template Var obj to create from
  5926                                                               var_obj = self.vars[classname].value
  5927                                           
  5928                                                               # new class instance
  5929                                                               instance = {}
  5930                                           
  5931                                                               curr_arg_num = 0
  5932                                           
  5933                                                               # attributes to apply
  5934                                                               for name in var_obj:
  5935                                           
  5936                                                                   # if attribute is a method
  5937                                                                   if isinstance(var_obj[name].value, self.Method):
  5938                                           
  5939                                                                       # add the method to the instance
  5940                                                                       instance[name] = var_obj[name].value
  5941                                           
  5942                                                                       # if the method's name is 'const'
  5943                                                                       if var_obj[name].value.name == 'const':
  5944                                                                           # run the function with the argument being
  5945                                                                           # this instance
  5946                                                                           var_obj[name].value.run(
  5947                                                                               [instance], self, actual_args=args[1:])
  5948                                                                       continue
  5949                                           
  5950                                                                   # if attribute is a variable
  5951                                                                   # value can be None
  5952                                                                   try:
  5953                                                                       instance[name] = self.parse(
  5954                                                                           curr_arg_num, line, f, sp, args)[2]
  5955                                                                       if instance[name] == None:
  5956                                                                           instance[name] = self.vars[classname].value[name].value
  5957                                                                   # if not specified, field is default value
  5958                                                                   except:
  5959                                                                       try:
  5960                                                                           instance[name] = var_obj.value[name].copy()
  5961                                                                       except:
  5962                                                                           var = var_obj[name]
  5963                                                                           instance[name] = var.value
  5964                                                                   curr_arg_num += 1
  5965                                           
  5966                                                               return instance
  5967                                           
  5968                                                           # gets an attribute of an instance of a class
  5969                                                           elif func == 'getattr':
  5970                                           
  5971                                                               # name of the object to pull from
  5972                                                               name = self.parse(0, line, f, sp, args)[2]
  5973                                           
  5974                                                               # current working object
  5975                                                               o = self.vars[name].value
  5976                                           
  5977                                                               # get attribute to pull
  5978                                                               attr = self.parse(1, line, f, sp, args)[2]
  5979                                                               return o[attr]
  5980                                           
  5981                                                           # sets an attribute of an instance of a class
  5982                                                           elif func == 'setattr':
  5983                                           
  5984                                                               # name of the object to set at
  5985                                                               name = self.parse(0, line, f, sp, args)[2]
  5986                                           
  5987                                                               # current working object
  5988                                                               o = self.vars[name].value
  5989                                           
  5990                                                               # name of attribute to set
  5991                                                               attr = self.parse(1, line, f, sp, args)[2]
  5992                                           
  5993                                                               # value to set
  5994                                                               val = self.parse(2, line, f, sp, args)[2]
  5995                                           
  5996                                                               # set the value
  5997                                                               o[attr] = val
  5998                                                               return val
  5999                                           
  6000                                                           # PRACTICAL FUNCTIONALITY
  6001                                                           # started 5/20/2023
  6002                                           
  6003                                                           # starts and retrieves an instance
  6004                                                           # of an application on the local machine
  6005                                                           # only properly implemented for Windows
  6006                                                           # uses pywinauto to do all of this
  6007                                                           # one argument: path to application
  6008                                                           # any more arguments: the existing application doesn't close
  6009                                                           elif func == 'app':
  6010                                                               global timings_set
  6011                                                               # set timings if not already set
  6012                                                               if not timings_set:
  6013                                                                   from pywinauto import timings
  6014                                                                   # pywinauto defaults
  6015                                                                   timings.Timings.after_clickinput_wait = 0.001
  6016                                                                   timings.Timings.after_setcursorpos_wait = 0.001
  6017                                                                   timings.Timings.after_sendkeys_key_wait = 0.001
  6018                                                                   timings.Timings.after_menu_wait = 0.001
  6019                                           
  6020                                                               # get the path to the application
  6021                                                               path = self.parse(0, line, f, sp, args)[2]
  6022                                           
  6023                                                               # if there is not second argument, we do not kill any
  6024                                                               # existing instances of the application
  6025                                                               name = None
  6026                                                               extension = None
  6027                                                               if len(args) == 1:
  6028                                                                   # get the name and extension of the application
  6029                                                                   _sp = path.split('\\')
  6030                                                                   name = _sp[-1].split('.')[0]
  6031                                                                   extension = _sp[-1].split('.')[1]
  6032                                           
  6033                                                                   # use taskkill to kill the application
  6034                                                                   # taskkill should end the program by name, and should kill
  6035                                                                   # all child processes forcefully, it should also not print
  6036                                                                   # anything to the console
  6037                                                                   os.system(
  6038                                                                       f'taskkill /f /im {name}.{extension} >nul 2>&1')
  6039                                           
  6040                                                               # creates an App variable
  6041                                                               return self.App(path=path, name=name, extension=extension)
  6042                                           
  6043                                                           # connects to the first argument given that
  6044                                                           # the first argument is an instance of self.App
  6045                                                           elif func == 'connect':
  6046                                                               from pywinauto.application import Application
  6047                                                               # connecting to
  6048                                                               appl = self.parse(0, line, f, sp, args)[2]
  6049                                                               a = Application(backend="uia").connect(
  6050                                                                   process=appl.application.process)
  6051                                                               # connect to the application
  6052                                                               return self.App(path=appl.path)
  6053                                           
  6054                                                           # starts and retrieves an instance of an Excel workbook
  6055                                                           # using the openpyxl library
  6056                                                           #
  6057                                                           # this method works better than the app() system call
  6058                                                           # as it utilizes an Excel-specific library for stability
  6059                                                           # and speed
  6060                                                           #
  6061                                                           # creation of a workbook can be done with the 'file' msn2 class
  6062                                                           elif func == 'excel':
  6063                                                               # automating Excel
  6064                                                               import openpyxl
  6065                                                               path = self.parse(0, line, f, sp, args)[2]
  6066                                           
  6067                                                               # creates and returns a Workbook
  6068                                                               return self.Workbook(openpyxl.load_workbook(path), path)
  6069                                           
  6070                                                           # quicker conditional operator as functional prefix
  6071                                                           elif len(func) > 0 and func[0] == '?':
  6072                                                               func = func[1:]
  6073                                                               ret = None
  6074                                                               if self.interpret(func):
  6075                                                                   ret = self.interpret(args[0][0])
  6076                                                               else:
  6077                                           
  6078                                                                   # else block is optional
  6079                                                                   try:
  6080                                                                       ret = self.interpret(args[1][0])
  6081                                                                   except:
  6082                                                                       None
  6083                                                               return ret
  6084                                           
  6085                                                           # executes C code and retrieves the environment
  6086                                                           elif func == 'C':
  6087                                           
  6088                                                               # get the C code
  6089                                                               c_code = self.msn2_replace(args[0][0])
  6090                                           
  6091                                                               # create a directory for the C code
  6092                                                               # if it does not exist
  6093                                                               exec_folder_path = '_exec'
  6094                                           
  6095                                                               # if the folder does not exist, create it
  6096                                                               if not os.path.exists(exec_folder_path):
  6097                                                                   os.mkdir(exec_folder_path)
  6098                                           
  6099                                                               # create a file for the C code
  6100                                                               # and write the C code to it
  6101                                           
  6102                                                               # get the amount of files in the directory
  6103                                                               # and use that as the file name
  6104                                                               file_num = len(os.listdir(exec_folder_path))
  6105                                                               file_name = f'{exec_folder_path}/c{file_num}.c'
  6106                                                               with open(file_name, 'w') as f:
  6107                                                                   f.write(c_code)
  6108                                           
  6109                                                               # creates a new process
  6110                                                               # and executes the C code
  6111                                                               # returns the environment
  6112                                                               # including the out and variables
  6113                                           
  6114                                                               def retrieve_c_environment(c_code):
  6115                                                                   import subprocess
  6116                                           
  6117                                                                   # executable
  6118                                                                   executable = f'{exec_folder_path}/c{file_num}.exe'
  6119                                           
  6120                                                                   # create a new process
  6121                                                                   # and execute the C code
  6122                                                                   compiled_code = subprocess.run(
  6123                                                                       ['gcc', file_name, '-o', executable],
  6124                                           
  6125                                                                       # capture the output
  6126                                                                       capture_output=True,
  6127                                                                       text=True
  6128                                                                   )
  6129                                           
  6130                                                                   # if there's an error, print it
  6131                                                                   if len(compiled_code.stderr) > 0:
  6132                                                                       return {'out': '', 'err': compiled_code.stderr}
  6133                                           
  6134                                                                   # run the executable
  6135                                                                   compiled_code = subprocess.run(
  6136                                                                       [executable],
  6137                                                                       # capture the output
  6138                                                                       capture_output=True,
  6139                                                                       text=True
  6140                                                                   )
  6141                                           
  6142                                                                   # get the output and error
  6143                                                                   out = compiled_code.stdout
  6144                                                                   err = compiled_code.stderr
  6145                                           
  6146                                                                   # get the environment
  6147                                                                   # env = out.split('\n')[-2]
  6148                                                                   # env = env.replace('\'', '"')
  6149                                                                   # env = json.loads(env)
  6150                                                                   return {'out': out, 'err': err}
  6151                                           
  6152                                                               # execute the C code
  6153                                                               return retrieve_c_environment(c_code)
  6154                                           
  6155                                                           # executes JavaScript code and retrieves the environment
  6156                                                           # no compilation is needed, the code is executed via
  6157                                                           # node __filename__.js
  6158                                                           elif func == 'JS':
  6159                                           
  6160                                                               # get the JavaScript code
  6161                                                               js_code = self.msn2_replace(args[0][0])
  6162                                           
  6163                                                               # create a directory for the JavaScript code
  6164                                                               # if it does not exist
  6165                                                               exec_folder_path = '_exec'
  6166                                           
  6167                                                               # if the folder does not exist, create it
  6168                                                               if not os.path.exists(exec_folder_path):
  6169                                                                   os.mkdir(exec_folder_path)
  6170                                           
  6171                                                               # create a file for the JavaScript code
  6172                                                               # and write the JavaScript code to it
  6173                                           
  6174                                                               # get the amount of files in the directory
  6175                                                               # and use that as the file name
  6176                                                               file_num = len(os.listdir(exec_folder_path))
  6177                                                               file_name = f'{exec_folder_path}/js{file_num}.js'
  6178                                           
  6179                                                               # if JS() has two arguments, the second is the name of
  6180                                                               # the file, excluding .js
  6181                                                               if len(args) == 2:
  6182                                                                   file_name = f'{exec_folder_path}/{self.parse(1, line, f, sp, args)[2]}.js'
  6183                                           
  6184                                                               with open(file_name, 'w') as f:
  6185                                                                   f.write(js_code)
  6186                                           
  6187                                                               # creates a new process
  6188                                                               # and executes the JavaScript code
  6189                                                               # returns the environment
  6190                                                               # including the out and variables
  6191                                           
  6192                                                               def retrieve_js_environment(js_code):
  6193                                                                   import subprocess
  6194                                           
  6195                                                                   # executable
  6196                                                                   executable = file_name
  6197                                           
  6198                                                                   # create a new process
  6199                                                                   # and execute the JavaScript code
  6200                                                                   compiled_code = subprocess.run(
  6201                                                                       ['node', file_name],
  6202                                           
  6203                                                                       # capture the output
  6204                                                                       capture_output=True,
  6205                                                                       text=True
  6206                                                                   )
  6207                                           
  6208                                                                   # get the output and error
  6209                                                                   out = compiled_code.stdout
  6210                                                                   err = compiled_code.stderr
  6211                                           
  6212                                                                   # # remove '/temp.exe'
  6213                                                                   # os.remove('temp.exe')
  6214                                                                   # if there is an error, print it
  6215                                                                   if len(err) > 0:
  6216                                                                       print(err)
  6217                                           
  6218                                                                   # get the environment
  6219                                                                   # env = out.split('\n')[-2]
  6220                                                                   # env = env.replace('\'', '"')
  6221                                                                   # env = json.loads(env)
  6222                                           
  6223                                                                   # remove a succeeding newline
  6224                                                                   # if it exists
  6225                                                                   if len(out) > 0 and out[-1] == '\n':
  6226                                                                       out = out[:-1]
  6227                                           
  6228                                                                   return {'out': out, 'err': err}
  6229                                           
  6230                                                               # execute the JavaScript code
  6231                                                               return retrieve_js_environment(js_code)
  6232                                           
  6233                                                           # compiles and executes Java code and retrieves the environment
  6234                                                           elif func == 'JAVA':
  6235                                           
  6236                                                               java_code = self.msn2_replace(args[0][0])
  6237                                           
  6238                                                               # create a directory for the Java code
  6239                                                               # if it does not exist
  6240                                                               exec_folder_path = '_exec'
  6241                                           
  6242                                                               # if the folder does not exist, create it
  6243                                                               if not os.path.exists(exec_folder_path):
  6244                                                                   os.mkdir(exec_folder_path)
  6245                                           
  6246                                                               # create a file for the Java code
  6247                                                               # and write the Java code to it
  6248                                           
  6249                                                               # get the amount of files in the directory
  6250                                                               # and use that as the file name
  6251                                                               file_num = len(os.listdir(exec_folder_path))
  6252                                                               file_name = f'{exec_folder_path}/java{file_num}.java'
  6253                                           
  6254                                                               # if JAVA() has two arguments, the second is the name of
  6255                                                               # the file, excluding .java
  6256                                                               if len(args) == 2:
  6257                                                                   file_name = f'{exec_folder_path}/{self.parse(1, line, f, sp, args)[2]}.java'
  6258                                           
  6259                                                               with open(file_name, 'w') as f:
  6260                                                                   f.write(java_code)
  6261                                           
  6262                                                               # creates a new process
  6263                                                               # and executes the Java code
  6264                                                               # returns the environment
  6265                                                               # including the out and variables
  6266                                           
  6267                                                               def retrieve_java_environment(java_code):
  6268                                                                   import subprocess
  6269                                           
  6270                                                                   # create a new process
  6271                                                                   # and execute the Java code
  6272                                                                   compiled_code = subprocess.run(
  6273                                                                       ['javac', file_name],
  6274                                           
  6275                                                                       # capture the output
  6276                                                                       capture_output=True,
  6277                                                                       text=True,
  6278                                                                       shell=True
  6279                                                                   )
  6280                                           
  6281                                                                   # run the code
  6282                                                                   compiled_code = subprocess.run(
  6283                                                                       ['java', '-cp', exec_folder_path, f'{file_name}'],
  6284                                           
  6285                                                                       # capture the output
  6286                                                                       capture_output=True,
  6287                                                                       text=True,
  6288                                                                       shell=True
  6289                                                                   )
  6290                                           
  6291                                                                   # get the output and error
  6292                                                                   out = compiled_code.stdout
  6293                                                                   err = compiled_code.stderr
  6294                                           
  6295                                                                   # # remove '/temp.exe'
  6296                                                                   # os.remove('temp.exe')
  6297                                                                   # if there is an error, print it
  6298                                                                   if len(err) > 0:
  6299                                                                       print(err)
  6300                                           
  6301                                                                   # get the environment
  6302                                                                   # env = out.split('\n')[-2]
  6303                                                                   # env = env.replace('\'', '"')
  6304                                                                   # env = json.loads(env)
  6305                                           
  6306                                                                   # remove a succeeding newline
  6307                                                                   # if it exists
  6308                                                                   if len(out) > 0 and out[-1] == '\n':
  6309                                                                       out = out[:-1]
  6310                                           
  6311                                                                   return {'out': out, 'err': err}
  6312                                           
  6313                                                               # execute the Java code
  6314                                                               return retrieve_java_environment(java_code)
  6315                                           
  6316                                                           # inline function, takes any amount of instructions
  6317                                                           # returns the result of the last instruction
  6318                                                           elif func == "=>" or (func == '' and objfunc == ''):
  6319                                                               ret = None
  6320                                                               for i in range(len(args)):
  6321                                                                   arguments = args[i]
  6322                                           
  6323                                                                   # current instruction
  6324                                                                   ins_s = arguments[0]
  6325                                           
  6326                                                                   line, ret = self.convert_arg(ins_s, line, f, sp, args)
  6327                                                               return ret
  6328                                           
  6329                                                           # if the function, when parsed, is an integer,
  6330                                                           # then it is a loop that runs func times
  6331                                                           elif (_i := get_int(func)) != None:
  6332                                                               ret = None
  6333                                                               for _ in range(_i):
  6334                                                                   for arguments in args:
  6335                                                                       ins_s = arguments[0]
  6336                                                                       line, ret = self.convert_arg(
  6337                                                                           ins_s, line, f, sp, args)
  6338                                                               return ret
  6339                                           
  6340                                                           # # if the function is a variable name
  6341                                                           elif func in self.vars:
  6342                                                               # value
  6343                                                               val = self.vars[func].value
  6344                                                               # if the variable is an integer,
  6345                                                               # run the arguments as blocks inside
  6346                                                               # that many times
  6347                                                               if isinstance(val, int):
  6348                                                                   ret = None
  6349                                                                   for _ in range(val):
  6350                                                                       for arguments in args:
  6351                                                                           ins_s = arguments[0]
  6352                                                                           line, ret = self.convert_arg(
  6353                                                                               ins_s, line, f, sp, args)
  6354                                                                   return ret
  6355                                           
  6356                                                               # otherwise return the value
  6357                                                               return val
  6358                                           
  6359                                                           # mouse pointer operations
  6360                                                           elif obj.startswith('pointer'):
  6361                                                               from pywinauto import mouse
  6362                                                               # thread based action?
  6363                                                               p_thread = False
  6364                                           
  6365                                                               # return
  6366                                                               ret = '<msnint2 class>'
  6367                                           
  6368                                                               # determine if thread based pointer action has been requested
  6369                                                               if obj.endswith(':lock'):
  6370                                                                   p_thread = True
  6371                                                                   pointer_lock.acquire()
  6372                                           
  6373                                                               # gets the current position of the mouse
  6374                                                               if objfunc == 'getpos' or objfunc == 'pos' or objfunc == 'position':
  6375                                                                   # import win32api
  6376                                                                   import win32api
  6377                                                                   ret = win32api.GetCursorPos()
  6378                                           
  6379                                                               # moves the mouse to an x, y position
  6380                                                               elif objfunc == 'move' or objfunc == 'hover':
  6381                                                                   ret = mouse.move(coords=(self.parse(0, line, f, sp, args)[
  6382                                                                                    2], self.parse(1, line, f, sp, args)[2]))
  6383                                                               # right clicks the mouse
  6384                                                               elif objfunc == 'click' or objfunc == 'left_click':
  6385                                                                   # if args are provided
  6386                                                                   if len(args) == 2:
  6387                                                                       ret = mouse.click(coords=(self.parse(0, line, f, sp, args)[
  6388                                                                                         2], self.parse(1, line, f, sp, args)[2]))
  6389                                                                   # if no args are provided
  6390                                                                   else:
  6391                                                                       # import win32api
  6392                                                                       import win32api
  6393                                                                       ret = mouse.click(coords=win32api.GetCursorPos())
  6394                                           
  6395                                                               # right clicks the mouse
  6396                                                               elif objfunc == 'right_click':
  6397                                                                   # if args are provided
  6398                                                                   if len(args) == 2:
  6399                                                                       ret = mouse.right_click(coords=(self.parse(0, line, f, sp, args)[
  6400                                                                                               2], self.parse(1, line, f, sp, args)[2]))
  6401                                                                   # if no args are provided
  6402                                                                   else:
  6403                                                                       # import win32api
  6404                                                                       import win32api
  6405                                                                       ret = mouse.right_click(
  6406                                                                           coords=win32api.GetCursorPos())
  6407                                                               # double clicks the mouse
  6408                                                               elif objfunc == 'double_click':
  6409                                                                   # if args are provided
  6410                                                                   if len(args) == 2:
  6411                                                                       ret = mouse.double_click(coords=(self.parse(0, line, f, sp, args)[
  6412                                                                                                2], self.parse(1, line, f, sp, args)[2]))
  6413                                                                   # if no args are provided
  6414                                                                   else:
  6415                                                                       import win32api
  6416                                                                       ret = mouse.double_click(
  6417                                                                           coords=win32api.GetCursorPos())
  6418                                                               # scrolls the mouse wheel to the bottom of the page
  6419                                                               elif objfunc == 'scroll_bottom':
  6420                                                                   import win32api
  6421                                                                   ret = mouse.scroll(
  6422                                                                       wheel_dist=9999999, coords=win32api.GetCursorPos())
  6423                                                               # scrolls the mouse wheel to the top of the page
  6424                                                               elif objfunc == 'scroll_top':
  6425                                                                   import win32api
  6426                                                                   ret = mouse.scroll(
  6427                                                                       wheel_dist=-9999999, coords=win32api.GetCursorPos())
  6428                                                               elif objfunc == 'scroll':
  6429                                                                   import win32api
  6430                                                                   ret = mouse.scroll(wheel_dist=self.parse(0, line, f, sp, args)[
  6431                                                                                      2], coords=win32api.GetCursorPos())
  6432                                           
  6433                                                               # determines if the left mouse button is down
  6434                                                               elif objfunc == 'left_down':
  6435                                                                   import win32api
  6436                                                                   ret = win32api.GetKeyState(0x01) < 0
  6437                                                               # determines if the right mouse button is down
  6438                                                               elif objfunc == 'right_down':
  6439                                                                   import win32api
  6440                                                                   ret = win32api.GetKeyState(0x02) < 0
  6441                                                               # waits for the left button to be pressed
  6442                                                               elif objfunc == 'wait_left':
  6443                                                                   import win32api
  6444                                                                   while True:
  6445                                                                       if win32api.GetKeyState(0x01) < 0:
  6446                                                                           break
  6447                                                                   ret = True
  6448                                                               # waits for the right button to be pressed
  6449                                                               elif objfunc == 'wait_right':
  6450                                                                   import win32api
  6451                                                                   while True:
  6452                                                                       if win32api.GetKeyState(0x02) < 0:
  6453                                                                           break
  6454                                                                   ret = True
  6455                                                               # waits for a click
  6456                                                               # waits for the left button to be pressed down
  6457                                                               # then waits for it to be released
  6458                                                               elif objfunc == 'wait_left_click':
  6459                                                                   import win32api
  6460                                                                   while True:
  6461                                                                       if win32api.GetKeyState(0x01) < 0:
  6462                                                                           break
  6463                                                                   while True:
  6464                                                                       if win32api.GetKeyState(0x01) >= 0:
  6465                                                                           break
  6466                                                                   ret = True
  6467                                                               # waits for the right button to be pressed down
  6468                                                               # then waits for it to be released
  6469                                                               elif objfunc == 'wait_right_click':
  6470                                                                   import win32api
  6471                                                                   while True:
  6472                                                                       if win32api.GetKeyState(0x02) < 0:
  6473                                                                           break
  6474                                                                   while True:
  6475                                                                       if win32api.GetKeyState(0x02) >= 0:
  6476                                                                           break
  6477                                                                   ret = True
  6478                                           
  6479                                                               # DIRECTIONAL MOVEMENTS
  6480                                                               # moves the mouse down from its current location
  6481                                                               elif objfunc == 'down':
  6482                                                                   import win32api
  6483                                                                   curr_x, curr_y = win32api.GetCursorPos()
  6484                                                                   ret = mouse.move(
  6485                                                                       coords=(curr_x, curr_y + self.parse(0, line, f, sp, args)[2]))
  6486                                                               # moves the mouse up from its current location
  6487                                                               elif objfunc == 'up':
  6488                                                                   import win32api
  6489                                                                   curr_x, curr_y = win32api.GetCursorPos()
  6490                                                                   ret = mouse.move(
  6491                                                                       coords=(curr_x, curr_y - self.parse(0, line, f, sp, args)[2]))
  6492                                                               # moves the mouse left from its current location
  6493                                                               elif objfunc == 'left':
  6494                                                                   import win32api
  6495                                                                   curr_x, curr_y = win32api.GetCursorPos()
  6496                                                                   ret = mouse.move(
  6497                                                                       coords=(curr_x - self.parse(0, line, f, sp, args)[2], curr_y))
  6498                                                               # moves the mouse right from its current location
  6499                                                               elif objfunc == 'right':
  6500                                                                   import win32api
  6501                                                                   curr_x, curr_y = win32api.GetCursorPos()
  6502                                                                   ret = mouse.move(
  6503                                                                       coords=(curr_x + self.parse(0, line, f, sp, args)[2], curr_y))
  6504                                           
  6505                                                               # drags the mouse
  6506                                                               # takes 4 or 5 arguments
  6507                                                               # the first two are the starting coordinates
  6508                                                               # the second two are the ending coordinates
  6509                                                               # 5th argument is speed from 0-100
  6510                                                               elif objfunc == 'drag':
  6511                                                                   import time
  6512                                                                   start = (self.parse(0, line, f, sp, args)[2],
  6513                                                                            self.parse(1, line, f, sp, args)[2])
  6514                                                                   end = (self.parse(2, line, f, sp, args)[2],
  6515                                                                          self.parse(3, line, f, sp, args)[2])
  6516                                                                   # presses the mouse down at the coordinates
  6517                                                                   mouse.press(coords=start)
  6518                                           
  6519                                                                   # slowly moves the mouse to the end coordinates
  6520                                                                   # this is to prevent the mouse from moving too fast
  6521                                                                   # and not dragging the object
  6522                                                                   # the farther the distance, the longer it takes
  6523                                                                   # to move the mouse
  6524                                           
  6525                                                                   speed = 50
  6526                                                                   if len(args) == 5:
  6527                                                                       speed = self.parse(4, line, f, sp, args)[2]
  6528                                           
  6529                                                                   # reverse the speed, so a speed of 50 gives
  6530                                                                   # end_range of 50, and a speed of 75 gives
  6531                                                                   # end_range of 25
  6532                                                                   end_range = 100 - speed
  6533                                                                   for i in range(0, end_range):
  6534                                                                       mouse.move(coords=(int(start[0] + (end[0] - start[0]) / 100 * i),
  6535                                                                                          int(start[1] + (end[1] - start[1]) / 100 * i)))
  6536                                                                       time.sleep(0.001)
  6537                                           
  6538                                                                   # releases the mouse at the end coordinates
  6539                                                                   mouse.release(coords=end)
  6540                                                                   ret = True
  6541                                           
  6542                                                               # release the lock
  6543                                                               if p_thread:
  6544                                                                   pointer_lock.release()
  6545                                                               return ret
  6546                                           
  6547                                                           # clipboard operations
  6548                                                           # if no arguments, the clipboard
  6549                                                           # is returned
  6550                                                           #
  6551                                                           # if one argument, the text is copied
  6552                                                           # uses pyperclip
  6553                                                           elif func == 'clipboard':
  6554                                           
  6555                                                               # import pyperclip
  6556                                                               import pyperclip
  6557                                           
  6558                                                               # if no arguments
  6559                                                               if args[0][0] == '':
  6560                                                                   return pyperclip.paste()
  6561                                                               # if one argument
  6562                                                               else:
  6563                                                                   copying = self.parse(0, line, f, sp, args)[2]
  6564                                                                   pyperclip.copy(copying)
  6565                                                                   return copying
  6566                                           
  6567                                                           # functional syntax I decided to add to make loops a tiny bit faster,
  6568                                                           # cannot receive non literal arguments
  6569                                                           # syntax:     3|5|i (prnt(i))
  6570                                                           # prnts 3\n4\n5
  6571                                                           elif func.count('|') == 2:
  6572                                                               loop_args = func.split('|')
  6573                                                               start = self.interpret(loop_args[0])
  6574                                                               end = self.interpret(loop_args[1])
  6575                                                               loopvar = loop_args[2]
  6576                                           
  6577                                                               # prepare loop variable
  6578                                                               self.vars[loopvar] = Var(loopvar, start)
  6579                                           
  6580                                                               # obtain loop block
  6581                                                               block_s = args[0][0]
  6582                                           
  6583                                                               if start < end:
  6584                                                                   for i in range(start, end):
  6585                                                                       self.vars[loopvar].value = i
  6586                                                                       self.interpret(block_s)
  6587                                           
  6588                                                               # reversed iteration
  6589                                                               else:
  6590                                                                   for i in reversed(range(end, start)):
  6591                                                                       self.vars[loopvar].value = i
  6592                                                                       self.interpret(block_s)
  6593                                                               return
  6594                                           
  6595                                                           # fallback
  6596                                                           else:
  6597                                                               try:
  6598                                                                   line = self.replace_vars2(line)
  6599                                                                   return eval(line, {}, {})
  6600                                                               except:
  6601                                                                   # maybe its a variable?
  6602                                                                   try:
  6603                                                                       return self.vars[line].value
  6604                                                                   except:
  6605                                                                       # ok hopefully its a string lol
  6606                                                                       return line
  6607                                           
  6608        29          8.8      0.3      1.4              if obj != '':
  6609        11          4.1      0.4      0.6                  objfunc += c
  6610                                                       else:
  6611        18        123.7      6.9     19.5                  func += c
  6612                                           
  6613                                                   # try a variable
  6614                                                   if line in self.vars:
  6615                                                       return self.vars[line].value
  6616                                           
  6617                                                   # otherwise nothing
  6618                                                   # try replacing variables 2
  6619                                                   try:
  6620                                                       line = self.replace_vars2(line)
  6621                                                   except:
  6622                                                       None
  6623                                                   # get value of line
  6624                                                   try:
  6625                                                       return eval(line, {}, {})
  6626                                                   except:
  6627                                                       try:
  6628                                                           return eval(str(self.replace_vars(line)), {}, {})
  6629                                                       except:
  6630                                                           return None

Total time: 0.0014428 s
File: C:\Users\mason\OneDrive\Desktop\TheMsnProject\msnscript2\tests\speed\lineprofile\msnint2.py
Function: execute at line 272

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   272                                               @profile
   273                                               def execute(self, script):
   274                                           
   275                                                   # convert script to lines
   276         1          1.1      1.1      0.1          self.lines = []
   277                                           
   278                                                   # for aggregate syntax support !{}
   279         1          0.6      0.6      0.0          inmultiline = False
   280         1          0.6      0.6      0.0          multiline = ''
   281                                           
   282                                                   # for block syntax
   283         1          0.5      0.5      0.0          inblock = False
   284         1          0.5      0.5      0.0          p = 0
   285                                           
   286                                                   # whether or not to keep
   287         1          0.3      0.3      0.0          keep_space = False
   288         1          0.4      0.4      0.0          keep_space_block = ''
   289         1          0.3      0.3      0.0          skipping = False
   290                                           
   291                                                   # determines if a line is a comment or not
   292         1          0.6      0.6      0.0          def is_comment(_line):
   293                                                       return _line.startswith('#') or _line.startswith('::')
   294                                           
   295                                                   # for each line of code
   296         8          5.7      0.7      0.4          for line in script.split("\n"):
   297                                           
   298                                                       # add to list of lines
   299         7          4.0      0.6      0.3              self.lines.append(line)
   300                                           
   301                                                       # continue if this line is a comment
   302                                                       # continue if this line is not
   303         7          9.8      1.4      0.7              if not line or is_comment(line):
   304         3          0.7      0.2      0.0                  continue
   305                                           
   306                                                       # for running Python
   307         4          3.2      0.8      0.2              if not keep_space and line.endswith('\\\\'):
   308                                           
   309                                                           # determine if this script should run
   310                                                           # based on the expression at the beginning of the line
   311                                                           line = line[:-2]
   312                                                           line = line.strip()
   313                                           
   314                                                           # if there is a conditional Python execution
   315                                                           if line:
   316                                           
   317                                                               # execute the conditional line
   318                                                               # with import capabilities
   319                                                               result = self.interpret(line)
   320                                                               keep_space = True
   321                                                               # if the conditional evaluated to True
   322                                                               if result:
   323                                           
   324                                                                   # if the conditional line is true, then execute the Python
   325                                                                   skipping = False
   326                                                                   keep_space_block = ''
   327                                           
   328                                                               # otherwise, skip the Python
   329                                                               else:
   330                                                                   skipping = True
   331                                                                   keep_space_block = ''
   332                                                           else:
   333                                                               skipping = False
   334                                                               keep_space = True
   335                                                               keep_space_block = ''
   336                                           
   337                                                       # if the Python block has been ended
   338         4          1.1      0.3      0.1              elif keep_space and line.endswith('\\\\'):
   339                                           
   340                                                           # if skipping
   341                                                           if skipping:
   342                                                               skipping = False
   343                                                               keep_space_block = ''
   344                                                               keep_space = False
   345                                                               continue
   346                                           
   347                                                           # fix line
   348                                                           line = line[:-2]
   349                                                           line = line.strip()
   350                                                           # remove the trailing newline
   351                                                           # character
   352                                                           keep_space_block = keep_space_block[:-1]
   353                                           
   354                                                           # modify conditionals
   355                                                           keep_space = False
   356                                           
   357                                                           # if setting to a variable
   358                                                           if line:
   359                                                               # set variable to python block
   360                                                               self.vars[line] = Var(line, keep_space_block)
   361                                                           else:
   362                                                               # execute Python
   363                                                               self.exec_python(keep_space_block)
   364                                           
   365                                                           # reset python block and skipping flag
   366                                                           keep_space_block = ''
   367                                                           skipping = False
   368                                           
   369                                                       # skipping this Python block
   370                                                       # due to conditional
   371         4          1.1      0.3      0.1              elif keep_space and skipping:
   372                                                           continue
   373                                           
   374                                                       # if in a python block
   375         4          1.3      0.3      0.1              elif keep_space:
   376                                                           keep_space_block += line + '\n'
   377                                                           self.current_line += 1
   378                                                           continue
   379                                                       else:
   380         4          2.5      0.6      0.2                  line = line.strip()
   381         4          5.6      1.4      0.4              if is_comment(line):
   382                                                           self.current_line += 1
   383                                                           continue
   384                                                       else:
   385                                                           # aggregate syntax !{} (not recommended for most cases)
   386         4          2.1      0.5      0.1                  if line.startswith('!{') and line.endswith('}'):
   387                                                               multiline = line[2:-1]
   388                                                               self.interpret(multiline)
   389                                                               multiline = ''
   390         4          2.1      0.5      0.1                  elif not inmultiline and line.startswith("!{"):
   391                                                               inmultiline = True
   392                                                               multiline += line[2:]
   393         4          1.1      0.3      0.1                  elif inmultiline and line.endswith("}"):
   394                                                               inmultiline = False
   395                                                               multiline += line[0:len(line) - 1]
   396                                                               self.interpret(multiline)
   397                                                               multiline = ''
   398         4          0.9      0.2      0.1                  elif inmultiline:
   399                                                               multiline += line
   400                                           
   401                                                           # block syntax (recommended for most cases)
   402         4          2.1      0.5      0.1                  elif not inblock and line.endswith('('):
   403                                                               for c in line:
   404                                                                   if c == '(':
   405                                                                       p += 1
   406                                                                   if c == ')':
   407                                                                       p -= 1
   408                                                                   multiline += c
   409                                                               inblock = True
   410         4          1.1      0.3      0.1                  elif inblock:
   411                                                               for i in range(len(line)):
   412                                                                   c = line[i]
   413                                                                   if c == '(':
   414                                                                       p += 1
   415                                                                   if c == ')':
   416                                                                       p -= 1
   417                                           
   418                                                                   # end of syntax met
   419                                                                   if p == 0:
   420                                                                       multiline += line[i:]
   421                                                                       inter = multiline
   422                                                                       multiline = ''
   423                                                                       inblock = False
   424                                                                       self.interpret(inter, keep_space=keep_space)
   425                                                                       break
   426                                                                   multiline += c
   427                                                           else:
   428         4       1387.9    347.0     96.2                      self.interpret(line, keep_space=keep_space)
   429                                           
   430         4          5.3      1.3      0.4              self.current_line += 1
   431         1          0.3      0.3      0.0          return self.out

  0.00 seconds - C:\Users\mason\OneDrive\Desktop\TheMsnProject\msnscript2\tests\speed\lineprofile\msnint2.py:7128 - interpret_msnscript_1
  0.00 seconds - C:\Users\mason\OneDrive\Desktop\TheMsnProject\msnscript2\tests\speed\lineprofile\msnint2.py:443 - interpret
  0.00 seconds - C:\Users\mason\OneDrive\Desktop\TheMsnProject\msnscript2\tests\speed\lineprofile\msnint2.py:272 - execute
